{"version":3,"file":"_id_.vue3.mjs","sources":["../../../../../../pages/admin/users/[id].vue"],"sourcesContent":["<template>\r\n  <div v-if=\"pending\" class=\"flex justify-center items-center min-h-[60vh]\">\r\n    <LoadingSpinner class=\"w-10 h-10 text-indigo-600\" />\r\n  </div>\r\n\r\n  <div v-else-if=\"fetchError || !userData\" class=\"container mx-auto px-4 py-8 text-center\">\r\n    <div class=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative\" role=\"alert\">\r\n      <strong class=\"font-bold\">خطأ!</strong>\r\n      <span class=\"block sm:inline\">\r\n        {{ fetchError ? `فشل تحميل بيانات المستخدم: ${fetchError.message}` : 'لم يتم العثور على المستخدم المطلوب.' }}\r\n      </span>\r\n    </div>\r\n    <NuxtLink to=\"/admin/users\" class=\"mt-6 inline-block text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300\">\r\n      ← العودة إلى قائمة المستخدمين\r\n    </NuxtLink>\r\n  </div>\r\n\r\n  <div v-else class=\"container mx-auto px-4 lg:px-8 py-8 space-y-8\">\r\n    <!-- Header: User Info & Back Button -->\r\n    <div class=\"flex flex-col sm:flex-row justify-between items-start gap-4 pb-4 border-b dark:border-gray-700\">\r\n      <div class=\"flex items-center gap-4\">\r\n        <UserAvatar :src=\"userData.profile.avatar_url || undefined\" :alt=\"userData.profile.full_name || 'مستخدم'\" size=\"lg\" />\r\n        <div>\r\n          <h1 class=\"text-2xl font-semibold text-gray-800 dark:text-gray-100\">{{ userData.profile.full_name || 'لم يحدد اسم' }}</h1>\r\n          <p class=\"text-sm text-gray-500 dark:text-gray-400\">{{ userData.auth.email }}</p>\r\n          <div class=\"mt-1 flex flex-wrap gap-2 text-xs\">\r\n             <span :class=\"['px-2 py-0.5 rounded-full', userData.profile.role === 'admin' ? 'bg-purple-100 text-purple-800 dark:bg-purple-900/50 dark:text-purple-300' : 'bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300']\">\r\n               {{ userData.profile.role === 'admin' ? 'مشرف' : 'مستخدم' }}\r\n             </span>\r\n              <span v-if=\"userData.profile.is_banned\" class=\"px-2 py-0.5 rounded-full bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300\">محظور</span>\r\n              <span v-else-if=\"isCommentSuspended(userData.profile.comment_suspended_until)\" class=\"px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300\">تعليق موقوف</span>\r\n              <span v-else class=\"px-2 py-0.5 rounded-full bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300\">نشط</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <NuxtLink to=\"/admin/users\" class=\"flex-shrink-0 text-sm text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300 flex items-center gap-1 mt-2 sm:mt-0\">\r\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" fill=\"currentColor\" class=\"w-4 h-4\"><path fill-rule=\"evenodd\" d=\"M14 8a.75.75 0 0 1-.75.75H4.56l3.22 3.22a.75.75 0 1 1-1.06 1.06l-4.5-4.5a.75.75 0 0 1 0-1.06l4.5-4.5a.75.75 0 0 1 1.06 1.06L4.56 7.25H13.25A.75.75 0 0 1 14 8Z\" clip-rule=\"evenodd\" /></svg>\r\n        العودة للقائمة\r\n      </NuxtLink>\r\n    </div>\r\n\r\n    <!-- Action Buttons / Status Area -->\r\n     <!-- Loading overlay for actions -->\r\n     <div v-if=\"isLoadingAction\" class=\"fixed inset-0 bg-white/50 dark:bg-gray-900/50 flex items-center justify-center z-50\">\r\n         <LoadingSpinner class=\"w-8 h-8 text-indigo-600\" />\r\n         <span class=\"ml-2 text-gray-700 dark:text-gray-300\">جاري تنفيذ الإجراء...</span>\r\n     </div>\r\n\r\n    <AdminUserActions\r\n        v-if=\"userData?.profile\"\r\n        :user-profile=\"userData.profile\"\r\n        :is-loading=\"isLoadingAction\"  \r\n        @action-start=\"handleActionStart\"\r\n        @action-complete=\"handleActionComplete\"\r\n        @send-message=\"openSendMessageModal(userData.profile)\"\r\n        @suspend-comments=\"openSuspendModal(userData.profile)\"\r\n    />\r\n\r\n\r\n    <!-- Main Content Grid -->\r\n    <div class=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n\r\n      <!-- Left Column: User Details -->\r\n      <div class=\"lg:col-span-1 space-y-6\">\r\n         <BaseCard>\r\n             <template #title>معلومات إضافية</template>\r\n             <template #content>\r\n                 <dl class=\"space-y-3 text-sm\">\r\n                   <div class=\"flex justify-between\">\r\n                     <dt class=\"font-medium text-gray-500 dark:text-gray-400\">تاريخ الانضمام:</dt> \r\n                     <dd class=\"text-gray-700 dark:text-gray-200\">{{ formatDate(userData.profile.created_at) }}</dd>\r\n                   </div>\r\n                   <div class=\"flex justify-between\">\r\n                     <dt class=\"font-medium text-gray-500 dark:text-gray-400\">آخر تحديث للبروفايل:</dt>\r\n                     <dd class=\"text-gray-700 dark:text-gray-200\">{{ formatDate(userData.profile.updated_at) }}</dd>\r\n                   </div>\r\n                    <div class=\"flex justify-between\">\r\n                     <dt class=\"font-medium text-gray-500 dark:text-gray-400\">آخر تسجيل دخول:</dt>\r\n                     <dd class=\"text-gray-700 dark:text-gray-200\">{{ formatDate(userData.auth.last_sign_in_at) || 'غير متاح' }}</dd>\r\n                   </div>\r\n                    <div class=\"flex justify-between\">\r\n                     <dt class=\"font-medium text-gray-500 dark:text-gray-400\">النقاط:</dt>\r\n                     <dd class=\"text-gray-700 dark:text-gray-200 font-semibold\">{{ userData.profile.points ?? 0 }}</dd>\r\n                   </div>\r\n                   <div v-if=\"isCommentSuspended(userData.profile.comment_suspended_until)\">\r\n                       <dt class=\"font-medium text-gray-500 dark:text-gray-400\">انتهاء إيقاف التعليق:</dt>\r\n                       <dd class=\"text-yellow-600 dark:text-yellow-400\">{{ formatDate(userData.profile.comment_suspended_until) }}</dd>\r\n                   </div>\r\n                   <div class=\"pt-2\">\r\n                     <dt class=\"font-medium text-gray-500 dark:text-gray-400 mb-1\">النبذة الشخصية:</dt>\r\n                     <dd class=\"text-gray-700 dark:text-gray-200 whitespace-pre-wrap bg-gray-50 dark:bg-gray-700/50 p-2 rounded border dark:border-gray-600 min-h-[50px]\">{{ userData.profile.bio || 'لم يكتب نبذة.' }}</dd>\r\n                   </div>\r\n                 </dl>\r\n             </template>\r\n         </BaseCard>\r\n\r\n           <BaseCard v-if=\"userEnrolledCourses.length > 0\">\r\n             <template #title>الدورات المسجل بها ({{ userEnrolledCourses.length }})</template>\r\n             <template #content>\r\n                 <div v-if=\"isLoadingCourses\" class=\"text-center p-4\"><LoadingSpinner/></div>\r\n                  <ul v-else class=\"space-y-2 max-h-60 overflow-y-auto text-sm pr-1\">\r\n                     <li v-for=\"enrollment in userEnrolledCourses\" :key=\"enrollment.course_id\" class=\"flex justify-between items-center hover:bg-gray-100 dark:hover:bg-gray-700 p-1 rounded\">\r\n                         <NuxtLink :to=\"`/study/courses/${enrollment.course_id}`\" class=\"hover:underline text-gray-700 dark:text-gray-200 flex-grow truncate mr-2\">\r\n                             {{ enrollment.study_courses?.title || 'دورة غير معروفة' }}\r\n                         </NuxtLink>\r\n                         <span class=\"text-xs text-gray-400 flex-shrink-0\">{{ formatDateShort(enrollment.enrolled_at) }}</span>\r\n                     </li>\r\n                 </ul>\r\n             </template>\r\n         </BaseCard>\r\n          <div v-else-if=\"!isLoadingCourses\" class=\"text-sm text-center text-gray-400 dark:text-gray-500 italic py-4\">\r\n              المستخدم غير مسجل في أي دورات.\r\n          </div>\r\n      </div>\r\n\r\n      <!-- Right Column: Messages -->\r\n      <div class=\"lg:col-span-2 space-y-6\">\r\n         <BaseCard>\r\n             <template #title>\r\n                 <div class=\"flex justify-between items-center\">\r\n                     <span>المراسلات مع المستخدم</span>\r\n                      <button @click=\"openSendMessageModal(userData.profile)\" :disabled=\"isLoadingAction === 'send'\" class=\"text-sm bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300 hover:bg-indigo-200 dark:hover:bg-indigo-900 px-3 py-1 rounded-md flex items-center gap-1 disabled:opacity-50\">\r\n                         <LoadingSpinner v-if=\"isLoadingAction === 'send'\" class=\"w-4 h-4\"/>\r\n                         <svg v-else xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" fill=\"currentColor\" class=\"w-4 h-4\"><path d=\"M2.5 3A1.5 1.5 0 0 0 1 4.5v7A1.5 1.5 0 0 0 2.5 13h11a1.5 1.5 0 0 0 1.5-1.5v-7A1.5 1.5 0 0 0 13.5 3h-11ZM2 4.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 .5.5v1.145l-5.426 3.05a1.75 1.75 0 0 1-1.93.066L2 5.96V4.5Zm11.5 8h-11a.5.5 0 0 1-.5-.5v-4.318l3.924 2.207a3.25 3.25 0 0 0 3.552-.122L14 7.764V11.5a.5.5 0 0 1-.5.5Z\" /></svg>\r\n                         <span>رسالة جديدة</span>\r\n                      </button>\r\n                 </div>\r\n             </template>\r\n             <template #content>\r\n                <div v-if=\"isLoadingMessages\" class=\"text-center py-10\"><LoadingSpinner /></div>\r\n                <div v-else-if=\"userMessages.length === 0\" class=\"text-center py-10 text-gray-500 dark:text-gray-400\">لا توجد رسائل متبادلة.</div>\r\n                <div v-else class=\"space-y-6 max-h-[70vh] overflow-y-auto pr-2 custom-scrollbar\">\r\n                   <div v-for=\"message in userMessages\" :key=\"message.id\" class=\"border-b dark:border-gray-700 pb-4 last:border-b-0\">\r\n          \r\n                      <div class=\"p-3 rounded-lg bg-gray-100 dark:bg-gray-700/80 shadow-sm\">\r\n                          <div class=\"flex justify-between items-start mb-1.5\">\r\n                            <h4 class=\"font-semibold text-gray-800 dark:text-gray-100\">{{ message.title }}</h4>\r\n                            <span class=\"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap\">\r\n                              {{ formatDate(message.created_at) }}\r\n                            </span>\r\n                          </div>\r\n                          <p class=\"text-sm text-gray-700 dark:text-gray-200 whitespace-pre-wrap\">{{ message.content }}</p>\r\n                           <p class=\"text-xs text-gray-400 dark:text-gray-500 mt-1\">\r\n                               <span class=\"font-medium\">المصدر:</span> {{ message.source === 'ask_sheikh_reply' ? 'رد على سؤال' : (message.source === 'admin_direct_message' ? 'رسالة مباشرة' : 'غير محدد') }}\r\n                                <NuxtLink v-if=\"message.related_question_id\" :to=\"`/admin/ask-sheikh?question=${message.related_question_id}`\" class=\"mr-1 text-indigo-600 dark:text-indigo-400 hover:underline\">(#{{ message.related_question_id }})</NuxtLink>\r\n                           </p>\r\n                      </div>\r\n\r\n                     \r\n                      <div v-if=\"message.user_reply_text\" class=\"mt-3 mr-4 rtl:mr-0 rtl:ml-4 p-3 rounded-lg bg-yellow-50 dark:bg-yellow-900/30 border-l-4 border-yellow-400 dark:border-yellow-600 shadow-sm\">\r\n                          <div class=\"flex justify-between items-start mb-1.5\">\r\n                             <p class=\"text-sm font-semibold text-yellow-800 dark:text-yellow-200\">رد المستخدم:</p>\r\n                              <span class=\"text-xs text-yellow-700 dark:text-yellow-300 whitespace-nowrap\">\r\n                                {{ formatDate(message.user_replied_at) }}\r\n                              </span>\r\n                          </div>\r\n                          <p class=\"text-sm text-gray-700 dark:text-gray-200 whitespace-pre-wrap\">{{ message.user_reply_text }}</p>\r\n                           <div class=\"mt-2 text-right\">\r\n                               <button v-if=\"!message.admin_read_reply\"\r\n                                      @click=\"markReplyAsReadByAdmin(message.id)\"\r\n                                      :disabled=\"isLoadingAction === `read-${message.id}`\"\r\n                                      class=\"text-xs text-blue-600 dark:text-blue-400 hover:underline disabled:opacity-50 flex items-center justify-end gap-1 ml-auto\">\r\n                                  <LoadingSpinner v-if=\"isLoadingAction === `read-${message.id}`\" class=\"w-3 h-3\"/>\r\n                                  <span>{{ isLoadingAction === `read-${message.id}` ? 'جارٍ...' : 'تمييز كمقروء' }}</span>\r\n                               </button>\r\n                                <span v-else class=\"text-xs text-green-600 dark:text-green-400 font-medium\">(تمت القراءة)</span>\r\n                           </div>\r\n                      </div>\r\n                       <div v-else class=\"mt-3 mr-4 rtl:mr-0 rtl:ml-4 text-xs text-gray-400 italic\">\r\n                           لم يرد المستخدم على هذه الرسالة بعد.\r\n                       </div>\r\n                   </div>\r\n                </div>\r\n             </template>\r\n         </BaseCard>\r\n      </div>\r\n\r\n    </div>\r\n\r\n     <!-- Modals -->\r\n    <LazyAdminSendMessageModal v-model=\"showSendMessageModal\" :user=\"modalUser\" @sent=\"handleMessageSent\" />\r\n    <LazyAdminSuspendCommentModal v-model=\"showSuspendModal\" :user=\"modalUser\" @suspended=\"handleUserSuspended\" />\r\n   \r\n    \r\n\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, onMounted, watch } from 'vue';\r\nimport type { Database, Tables } from '~/types/database.types';\r\nimport LoadingSpinner from '~/components/LoadingSpinner.vue';\r\nimport UserAvatar from '~/components/UserAvatar.vue';\r\nimport BaseCard from '~/components/BaseCard.vue';\r\nconst AdminSendMessageModal = resolveComponent('LazyAdminSendMessageModal');\r\nconst AdminSuspendCommentModal = resolveComponent('LazyAdminSuspendCommentModal');\r\n// Confirmation is now likely inside AdminUserActions\r\n// const AdminConfirmationModal = resolveComponent('LazyAdminConfirmationModal');\r\nimport AdminUserActions from '~/components/admin/AdminUserActions.vue';\r\n// import { type ConfirmationConfig } from '~/components/admin/ConfirmationModal.vue'; // Type might still be needed if passed through\r\nimport { useSupabaseClient, definePageMeta, useNuxtApp, useRoute, navigateTo } from '#imports';\r\nimport type { PostgrestError, User } from '@supabase/supabase-js';\r\n\r\n// --- Define Types ---\r\ntype Profile = Tables<'profiles'>;\r\ntype AuthUser = Pick<User, 'id' | 'email' | 'created_at' | 'last_sign_in_at'>;\r\ntype PrivateMessage = Tables<'user_private_messages'>;\r\ntype CourseEnrollment = Tables<'course_enrollments'> & {\r\n    study_courses: Pick<Tables<'study_courses'>, 'title'> | null;\r\n};\r\ntype UserDetailData = { profile: Profile; auth: AuthUser; } | null;\r\n\r\n// --- Page Meta ---\r\ndefinePageMeta({ layout: 'admin', middleware: 'admin' });\r\n\r\n// --- Composables ---\r\nconst supabase = useSupabaseClient<Database>();\r\nconst { $toast } = useNuxtApp();\r\nconst route = useRoute();\r\nconst userId = computed(() => route.params.id as string);\r\n\r\n// --- State ---\r\nconst pending = ref(true);\r\nconst fetchError = ref<PostgrestError | { message: string } | null>(null);\r\nconst userData = ref<UserDetailData>(null);\r\nconst userMessages = ref<PrivateMessage[]>([]);\r\nconst isLoadingMessages = ref(false);\r\nconst userEnrolledCourses = ref<CourseEnrollment[]>([]);\r\nconst isLoadingCourses = ref(false);\r\nconst isLoadingAction = ref<string | boolean>(false); // Can be boolean or string like `read-${id}`\r\n\r\n// Modal State\r\nconst showSendMessageModal = ref(false);\r\nconst showSuspendModal = ref(false);\r\n// Confirmation modal state is now likely managed within AdminUserActions\r\n// const showConfirmModal = ref(false);\r\n// const confirmConfig = ref<ConfirmationConfig | null>(null);\r\n// let actionToConfirm: { type: 'ban' | 'unban' | 'unsuspend', user: Profile } | null = null;\r\nconst modalUser = computed(() => userData.value?.profile ?? null);\r\n\r\n\r\n// --- Fetch Data ---\r\nconst fetchData = async () => {\r\n  pending.value = true; fetchError.value = null; userData.value = null;\r\n  userMessages.value = []; userEnrolledCourses.value = [];\r\n  isLoadingMessages.value = true; isLoadingCourses.value = true; // Start loading indicators\r\n\r\n  if (!userId.value) {\r\n    fetchError.value = { message: \"معرف المستخدم غير موجود.\" }; pending.value = false; return;\r\n  }\r\n\r\n  try {\r\n    const profilePromise = supabase.from('profiles').select('*').eq('id', userId.value).single();\r\n    const authPromise = supabase.auth.admin.getUserById(userId.value); // Requires admin\r\n    const messagesPromise = supabase.from('user_private_messages').select('*').eq('user_id', userId.value).order('created_at', { ascending: false });\r\n    const coursesPromise = supabase.from('course_enrollments').select(`course_id, enrolled_at, study_courses (title)`).eq('user_id', userId.value).order('enrolled_at', { ascending: false });\r\n\r\n    const [profileResult, authResult, messagesResult, coursesResult] = await Promise.allSettled([\r\n        profilePromise, authPromise, messagesPromise, coursesPromise\r\n    ]);\r\n\r\n    // Process Profile\r\n    if (profileResult.status === 'rejected' || !profileResult.value.data) throw profileResult.status === 'rejected' ? profileResult.reason : new Error('لم يتم العثور على ملف المستخدم.');\r\n    const profileData = profileResult.value.data as Profile;\r\n\r\n    // Process Auth\r\n    let authData: AuthUser;\r\n    if (authResult.status === 'fulfilled' && authResult.value.data.user) {\r\n       const fetchedAuthUser = authResult.value.data.user;\r\n       authData = { id: fetchedAuthUser.id, email: fetchedAuthUser.email ?? 'غير متوفر', created_at: fetchedAuthUser.created_at, last_sign_in_at: fetchedAuthUser.last_sign_in_at }\r\n    } else {\r\n      console.warn(\"فشل جلب بيانات المصادقة:\", authResult.status === 'rejected' ? authResult.reason : 'لا يوجد بيانات');\r\n      authData = { id: profileData.id, email: 'غير متاح (خطأ تحميل)', created_at: undefined, last_sign_in_at: undefined }\r\n    }\r\n    userData.value = { profile: profileData, auth: authData };\r\n\r\n    // Process Messages\r\n    if (messagesResult.status === 'fulfilled') userMessages.value = (messagesResult.value.data as PrivateMessage[]) ?? [];\r\n    else console.error(\"Error fetching messages:\", messagesResult.reason);\r\n    isLoadingMessages.value = false;\r\n\r\n    // Process Courses\r\n    if (coursesResult.status === 'fulfilled') userEnrolledCourses.value = (coursesResult.value.data as CourseEnrollment[]) ?? [];\r\n    else console.error(\"Error fetching enrolled courses:\", coursesResult.reason);\r\n    isLoadingCourses.value = false;\r\n\r\n  } catch (err: any) {\r\n    console.error(\"Error fetching user detail:\", err); fetchError.value = (err as PostgrestError) ?? { message: 'خطأ غير معروف.' }; userData.value = null;\r\n    isLoadingMessages.value = false; isLoadingCourses.value = false; // Ensure loading stops on error\r\n  } finally { pending.value = false; }\r\n};\r\n\r\n// --- Action Handlers ---\r\nconst handleActionStart = (actionType: string) => {\r\n    // Use boolean for general loading, specific string for 'read' action\r\n    isLoadingAction.value = (actionType === 'ban' || actionType === 'unban' || actionType === 'unsuspend' || actionType === 'role');\r\n    console.log(`Action started: ${actionType}`);\r\n};\r\n\r\nconst handleActionComplete = (success: boolean, message: string, updatedProfile?: Partial<Profile>) => {\r\n    isLoadingAction.value = false;\r\n    if (success && userData.value && updatedProfile) {\r\n        Object.assign(userData.value.profile, updatedProfile);\r\n        showToast(message, 'success');\r\n    } else if (!success) {\r\n        showToast(message, 'error');\r\n    }\r\n};\r\n\r\nconst markReplyAsReadByAdmin = async (messageId: number) => {\r\n    if (isLoadingAction.value) return;\r\n    isLoadingAction.value = `read-${messageId}`;\r\n    try {\r\n        const { error } = await supabase.from('user_private_messages').update({ admin_read_reply: true }).eq('id', messageId);\r\n        if (error) throw error;\r\n        const msgIndex = userMessages.value?.findIndex(m => m.id === messageId);\r\n        if (msgIndex !== undefined && msgIndex !== -1 && userMessages.value) userMessages.value[msgIndex].admin_read_reply = true;\r\n        showToast('تم تمييز الرد كمقروء.', 'success');\r\n    } catch (err: any) { console.error(\"Error marking reply as read by admin:\", err); showToast('فشل تمييز الرد كمقروء.', 'error'); }\r\n    finally { if(isLoadingAction.value === `read-${messageId}`) isLoadingAction.value = false; } // Reset only if it matches\r\n};\r\n\r\nconst openSendMessageModal = (userProfile: Profile | null) => { if (!userProfile) return; showSendMessageModal.value = true; };\r\nconst openSuspendModal = (userProfile: Profile | null) => { if (!userProfile) return; showSuspendModal.value = true; };\r\n\r\nconst handleMessageSent = (success: boolean, errorMsg?: string) => {\r\n    showSendMessageModal.value = false;\r\n    if (success) { showToast('تم إرسال الرسالة الخاصة بنجاح.', 'success'); fetchMessages(); } // Refresh messages on success\r\n    else { showToast(`فشل إرسال الرسالة الخاصة: ${errorMsg || 'خطأ غير معروف'}`, 'error'); }\r\n};\r\n\r\nconst fetchMessages = async () => { // Function to refresh messages list\r\n    if (!userId.value) return; isLoadingMessages.value = true;\r\n    try {\r\n        const { data, error } = await supabase.from('user_private_messages').select('*').eq('user_id', userId.value).order('created_at', { ascending: false });\r\n        if (error) throw error; userMessages.value = data ?? [];\r\n    } catch (err: any) { console.error(\"Error refreshing messages:\", err); showToast(\"فشل تحديث قائمة الرسائل.\", \"error\"); }\r\n    finally { isLoadingMessages.value = false; }\r\n};\r\n\r\nconst handleUserSuspended = (userIdParam: string, suspended: boolean, suspended_until: string | null) => {\r\n    if (userData.value?.profile.id === userIdParam) {\r\n        userData.value.profile.comment_suspended_until = suspended_until;\r\n        const userName = userData.value.profile.full_name || userData.value.auth.email;\r\n        if (suspended) { showToast(`تم إيقاف تعليقات المستخدم ${userName} حتى ${formatDate(suspended_until)}.`, 'success'); }\r\n        else { showToast(`تم إلغاء إيقاف تعليقات المستخدم ${userName}.`, 'success'); }\r\n    }\r\n    showSuspendModal.value = false;\r\n};\r\n\r\n// Confirmation logic is now likely handled within AdminUserActions\r\n// const confirmAction = ...\r\n// const executeConfirmedAction = ...\r\n\r\n// --- Helper Functions ---\r\nconst formatDate = (dateString: string | null | undefined): string => {\r\n  if (!dateString) return '--';\r\n  try { const date = new Date(dateString); if (isNaN(date.getTime())) return 'تاريخ غير صالح'; return date.toLocaleString('ar-EG', { dateStyle: 'medium', timeStyle: 'short', hour12: true }); }\r\n  catch (e) { return 'خطأ تنسيق'; }\r\n};\r\nconst formatDateShort = (dateString: string | null | undefined): string => {\r\n  if (!dateString) return '--';\r\n  try { const date = new Date(dateString); if (isNaN(date.getTime())) return 'تاريخ غير صالح'; return date.toLocaleDateString('ar-EG', { year: 'numeric', month: 'short', day: 'numeric'}); }\r\n  catch (e) { return 'خطأ تنسيق'; }\r\n};\r\n\r\nconst isCommentSuspended = (suspendedUntil: string | null | undefined): boolean => {\r\n    if (!suspendedUntil) return false;\r\n    try { return new Date(suspendedUntil) > new Date(); } catch { return false; }\r\n};\r\n\r\nconst showToast = (message: string, type: 'success' | 'error' | 'info' = 'info') => {\r\n    if ($toast && typeof $toast[type] === 'function') $toast[type](message);\r\n    else console.log(`[${type.toUpperCase()}] ${message}`);\r\n};\r\n\r\n// --- Watchers ---\r\nwatch(userId, (newId) => { if (newId) fetchData(); }, { immediate: true });\r\n\r\n// --- Lifecycle Hooks ---\r\n// onMounted(() => { // Fetch data is called by the watcher });\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.custom-scrollbar::-webkit-scrollbar { width: 6px; }\r\n.custom-scrollbar::-webkit-scrollbar-thumb { background-color: rgba(156, 163, 175, 0.5); border-radius: 3px; }\r\n.custom-scrollbar:hover::-webkit-scrollbar-thumb { background-color: rgba(156, 163, 175, 0.8); }\r\n.custom-scrollbar::-webkit-scrollbar-track { background: transparent; }\r\n.whitespace-pre-wrap { white-space: pre-wrap; word-wrap: break-word; }\r\n.min-h-\\[50px\\] { min-height: 50px; }\r\n</style>"],"names":[],"mappings":"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"}