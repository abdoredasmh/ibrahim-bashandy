{"file":"categories.vue3.mjs","mappings":";;;;;;;;;;;AAwHA,UAAM,WAAW,kBAA4B;AAGvC,UAAA,UAAU,IAAI,IAAI;AAClB,UAAA,aAAa,IAAS,IAAI;AAC1B,UAAA,aAAa,IAAuB,IAAI;AACxC,UAAA,YAAY,IAAI,KAAK;AACrB,UAAA,mBAAmB,IAAqB,IAAI;AAC5C,UAAA,eAAe,IAAmB,IAAI;AACtC,UAAA,iBAAiB,IAAmB,IAAI;AACxC,UAAA,cAAc,IAAmB,IAAI;AAI3C,UAAM,kBAAkB,YAAY;AAClC,cAAQ,QAAQ;AAChB,iBAAW,QAAQ;AACf,UAAA;AACF,cAAM,EAAE,MAAM,MAAA,IAAU,MAAM,SAC3B,KAAK,YAAY,EACjB,OAAO,GAAG,EACV,MAAM,cAAc,EAAE,WAAW,OAAO;AAC3C,YAAI,MAAa,OAAA;AACjB,mBAAW,QAAQ;AAAA,eACZ,KAAU;AACT,gBAAA,MAAM,8BAA8B,GAAG;AAC/C,mBAAW,QAAQ;AACnB,mBAAW,QAAQ;AAAA,MAAA,UACnB;AACA,gBAAQ,QAAQ;AAAA,MAAA;AAAA,IAEpB;AASA,UAAM,aAAa,MAAM;AACvB,gBAAU,QAAQ;AAClB,uBAAiB,QAAQ;AAAA,IAC3B;AAEA,UAAM,aAAa,YAAY;AAClB,iBAAA;AACX,wBAAkB,qBAAqB;AACvC,YAAM,gBAAgB;AAAA,IACxB;AAwBM,UAAA,aAAa,CAAC,eAAsC;AACpD,UAAA,CAAC,WAAmB,QAAA;AACpB,UAAA;AACI,cAAA,OAAO,IAAI,KAAK,UAAU;AAChC,YAAI,MAAM,KAAK,QAAQ,CAAC,GAAG;AAChB,iBAAA;AAAA,QAAA;AAEJ,eAAA,KAAK,mBAAmB,SAAS,EAAE,MAAM,WAAW,OAAO,QAAQ,KAAK,WAAW;AAAA,eACnF,GAAG;AACA,gBAAA,MAAM,0BAA0B,YAAY,CAAC;AAC9C,eAAA;AAAA,MAAA;AAAA,IAEb;AAEM,UAAA,oBAAoB,CAAC,QAAgB;AACvC,qBAAe,QAAQ;AACvB,kBAAY,QAAQ;AACpB,iBAAW,MAAM;AAAE,uBAAe,QAAQ;AAAA,SAAS,GAAI;AAAA,IAC3D;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":[],"sources":["../../../../../pages/admin/categories.vue"],"sourcesContent":["<!-- pages/admin/categories.vue -->\r\n<template>\r\n  <div>\r\n    <div class=\"flex justify-between items-center mb-6\">\r\n      <h1 class=\"text-2xl font-semibold text-gray-700 dark:text-gray-200\">إدارة الفئات</h1>\r\n      <button\r\n        @click=\"openModal(null)\"\r\n        class=\"px-4 py-2 bg-primary-500 text-white rounded hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50 transition duration-150 ease-in-out\"\r\n        :disabled=\"pending || isProcessing\"\r\n      >\r\n        <span class=\"mr-2\">+</span> إضافة فئة جديدة\r\n      </button>\r\n    </div>\r\n\r\n    <!-- مؤشر التحميل الأولي -->\r\n    <div v-if=\"pending\" class=\"text-center py-10\">\r\n      <LoadingSpinner />\r\n      <p class=\"mt-2 text-gray-500 dark:text-gray-400\">جاري تحميل الفئات...</p>\r\n    </div>\r\n\r\n    <!-- رسالة خطأ الجلب -->\r\n    <div v-else-if=\"fetchError\" class=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4\" role=\"alert\">\r\n      <strong class=\"font-bold\">خطأ!</strong>\r\n      <span class=\"block sm:inline\"> حدث خطأ أثناء جلب الفئات: {{ fetchError.message }}</span>\r\n    </div>\r\n\r\n     <!-- رسائل الحالة للعمليات -->\r\n     <div v-if=\"successMessage\" class=\"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4\" role=\"alert\">\r\n       {{ successMessage }}\r\n     </div>\r\n     <div v-if=\"actionError\" class=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4\" role=\"alert\">\r\n       {{ actionError }}\r\n     </div>\r\n\r\n    <!-- جدول الفئات -->\r\n    <div v-else-if=\"categories && categories.length > 0\" class=\"bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg\">\r\n      <table class=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\r\n        <thead class=\"bg-gray-50 dark:bg-gray-700\">\r\n          <tr>\r\n            <th scope=\"col\" class=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n              الاسم\r\n            </th>\r\n            <th scope=\"col\" class=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n              الوصف\r\n            </th>\r\n            <th scope=\"col\" class=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n              النوع\r\n            </th>\r\n             <th scope=\"col\" class=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n              تاريخ الإنشاء\r\n            </th>\r\n            <th scope=\"col\" class=\"relative px-6 py-3\">\r\n              <span class=\"sr-only\">الإجراءات</span>\r\n            </th>\r\n          </tr>\r\n        </thead>\r\n        <tbody class=\"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700\">\r\n          <tr v-for=\"category in categories\" :key=\"category.id\">\r\n            <td class=\"px-6 py-4 whitespace-nowrap\">\r\n              <div class=\"text-sm font-medium text-gray-900 dark:text-gray-100\">{{ category.name }}</div>\r\n            </td>\r\n            <td class=\"px-6 py-4\"> \r\n              <div class=\"text-sm text-gray-500 dark:text-gray-400 truncate max-w-xs\" :title=\"category.description || ''\">\r\n                {{ category.description || '-' }}\r\n              </div>\r\n            </td>\r\n             <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400\">\r\n              {{ category.type || '-' }}\r\n            </td>\r\n             <td class=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400\">\r\n              {{ formatDate(category.created_at) }}\r\n            </td>\r\n            <td class=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2 space-x-reverse\">\r\n              <button\r\n                 @click=\"openModal(category)\"\r\n                 class=\"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 disabled:opacity-50\"\r\n                 :disabled=\"isProcessing === category.id\"\r\n              >\r\n                تعديل\r\n              </button>\r\n              <button\r\n                @click=\"confirmDelete(category)\"\r\n                class=\"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 disabled:opacity-50\"\r\n                 :disabled=\"isProcessing === category.id\"\r\n               >\r\n                <span v-if=\"isProcessing === category.id\">جاري...</span>\r\n                <span v-else>حذف</span>\r\n              </button>\r\n            </td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n\r\n     <!-- رسالة عند عدم وجود فئات -->\r\n    <div v-else class=\"text-center py-10 text-gray-500 dark:text-gray-400\">\r\n      لا توجد فئات لعرضها حالياً. قم بإضافة فئة جديدة.\r\n    </div>\r\n\r\n    <!-- === Modal الإضافة والتعديل للفئات === -->\r\n    <CategoryModal\r\n      :show=\"showModal\"\r\n      :category-data=\"selectedCategory\"\r\n      @close=\"closeModal\"\r\n      @saved=\"handleSave\"\r\n    />\r\n\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, onMounted } from 'vue';\r\nimport type { Database, Tables } from '~/types/database.types';\r\nimport LoadingSpinner from '~/components/LoadingSpinner.vue';\r\nimport CategoryModal from '~/components/admin/CategoryModal.vue'; // <-- مودال جديد للفئات\r\n\r\ntype Category = Tables<'categories'>;\r\n\r\ndefinePageMeta({ layout: 'admin', middleware: 'admin' });\r\n\r\nconst supabase = useSupabaseClient<Database>();\r\n\r\n// State\r\nconst pending = ref(true);\r\nconst fetchError = ref<any>(null);\r\nconst categories = ref<Category[] | null>(null);\r\nconst showModal = ref(false);\r\nconst selectedCategory = ref<Category | null>(null);\r\nconst isProcessing = ref<number | null>(null); // لتتبع الحذف أو الحفظ\r\nconst successMessage = ref<string | null>(null);\r\nconst actionError = ref<string | null>(null);\r\n\r\n// --- Functions ---\r\n\r\nconst fetchCategories = async () => {\r\n  pending.value = true;\r\n  fetchError.value = null;\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('categories')\r\n      .select('*') // جلب كل الأعمدة\r\n      .order('created_at', { ascending: false });\r\n    if (error) throw error;\r\n    categories.value = data;\r\n  } catch (err: any) {\r\n    console.error(\"Error fetching categories:\", err);\r\n    fetchError.value = err;\r\n    categories.value = null;\r\n  } finally {\r\n    pending.value = false;\r\n  }\r\n};\r\n\r\nconst openModal = (category: Category | null) => {\r\n  if (isProcessing.value) return;\r\n  selectedCategory.value = category ? { ...category } : null; // Pass copy or null\r\n  showModal.value = true;\r\n  clearMessages();\r\n};\r\n\r\nconst closeModal = () => {\r\n  showModal.value = false;\r\n  selectedCategory.value = null;\r\n};\r\n\r\nconst handleSave = async () => {\r\n  closeModal();\r\n  setSuccessMessage('تم حفظ الفئة بنجاح.');\r\n  await fetchCategories(); // أعد جلب القائمة\r\n};\r\n\r\nconst confirmDelete = async (category: Category) => {\r\n   if (isProcessing.value) return;\r\n   if (window.confirm(`هل أنت متأكد أنك تريد حذف الفئة \"${category.name}\"؟ قد يؤثر هذا على الدروس أو الدورات المرتبطة بها.`)) {\r\n      isProcessing.value = category.id;\r\n      clearMessages();\r\n      try {\r\n         const { error } = await supabase.from('categories').delete().eq('id', category.id);\r\n         if (error) throw error;\r\n         setSuccessMessage('تم حذف الفئة بنجاح.');\r\n         categories.value = categories.value?.filter(c => c.id !== category.id) ?? null;\r\n         // await fetchCategories(); // اختياري\r\n      } catch (err: any) {\r\n         console.error(\"Error deleting category:\", err);\r\n         setActionError(`فشل حذف الفئة: ${err.message}. تحقق مما إذا كانت مرتبطة ببيانات أخرى.`);\r\n      } finally {\r\n         isProcessing.value = null;\r\n      }\r\n   }\r\n};\r\n\r\n// Helper Functions (formatDate, setSuccessMessage, setActionError, clearMessages - انسخها من lessons.vue أو أعد كتابتها)\r\n// تنسيق التاريخ\r\nconst formatDate = (dateString: string | null): string => {\r\n  if (!dateString) return '-';\r\n  try {\r\n    const date = new Date(dateString);\r\n    if (isNaN(date.getTime())) {\r\n        return 'تاريخ غير صالح';\r\n    }\r\n    return date.toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' });\r\n  } catch (e) {\r\n      console.error(\"Error formatting date:\", dateString, e);\r\n      return 'خطأ في التنسيق';\r\n  }\r\n};\r\n// تعيين رسالة نجاح مؤقتة\r\nconst setSuccessMessage = (msg: string) => {\r\n    successMessage.value = msg;\r\n    actionError.value = null; // مسح أي خطأ قديم\r\n    setTimeout(() => { successMessage.value = null; }, 4000); // إخفاء الرسالة بعد 4 ثوان\r\n};\r\n\r\n// تعيين رسالة خطأ عملية مؤقتة\r\nconst setActionError = (msg: string) => {\r\n    actionError.value = msg;\r\n    successMessage.value = null; // مسح أي نجاح قديم\r\n    setTimeout(() => { actionError.value = null; }, 6000); // إخفاء الرسالة بعد 6 ثوان\r\n};\r\n\r\n// مسح رسائل الحالة\r\nconst clearMessages = () => {\r\n    successMessage.value = null;\r\n    actionError.value = null;\r\n};\r\n// Initial fetch\r\nonMounted(() => {\r\n  fetchCategories();\r\n});\r\n\r\n</script>\r\n\r\n<style scoped>\r\n/* Add styles if needed */\r\n</style>"],"version":3}