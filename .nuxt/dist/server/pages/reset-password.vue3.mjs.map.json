{"file":"reset-password.vue3.mjs","mappings":";;;;;;;;;AA4De,sBAAkB;AAC3B,UAAA,WAAW,IAAI,EAAE;AACjB,UAAA,kBAAkB,IAAI,EAAE;AACxB,UAAA,UAAU,IAAI,EAAE;AAChB,UAAA,UAAU,IAAI,KAAK;AACnB,UAAA,UAAU,IAAI,KAAK;AACnB,UAAA,WAAW,IAAI,KAAK;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":[],"sources":["../../../../pages/reset-password.vue"],"sourcesContent":["<template>\r\n  <div class=\"flex items-center justify-center min-h-[calc(100vh-200px)] py-12 px-4 sm:px-6 lg:px-8\">\r\n    <div class=\"w-full max-w-md space-y-8 bg-white p-8 md:p-10 rounded-lg shadow border border-cream-gray\">\r\n      <div>\r\n        <h2 class=\"mt-6 text-center text-3xl font-bold tracking-tight text-brown-dark\">\r\n          إعادة تعيين كلمة المرور\r\n        </h2>\r\n        <p v-if=\"!showForm && !message\" class=\"mt-2 text-center text-sm text-gray-600\"> {/* تعديل شرط الرسالة */}\r\n          جارٍ التحقق من الرابط...\r\n        </p>\r\n      </div>\r\n\r\n      <!-- رسائل الخطأ أو النجاح -->\r\n       <div v-if=\"message\" :class=\"isError ? 'text-red-600' : 'text-green-600'\" class=\"text-center text-sm mb-4 p-2 bg-opacity-10 rounded\" :style=\"{ backgroundColor: isError ? 'rgba(239, 68, 68, 0.1)' : 'rgba(34, 197, 94, 0.1)' }\">\r\n          {{ message }}\r\n        </div>\r\n\r\n      <form v-if=\"showForm\" class=\"mt-8 space-y-6\" @submit.prevent=\"handleResetPassword\">\r\n        <input type=\"hidden\" name=\"remember\" value=\"true\">\r\n        <div class=\"rounded-md shadow-sm -space-y-px\">\r\n           <div>\r\n            <label for=\"password\" class=\"sr-only\">كلمة المرور الجديدة</label>\r\n            <input id=\"password\" name=\"password\" type=\"password\" v-model=\"password\" autocomplete=\"new-password\" required\r\n                   class=\"relative block w-full appearance-none rounded-none rounded-t-md border border-cream-gray px-3 py-2 text-brown-dark placeholder-gray-500 focus:z-10 focus:border-olive-green focus:outline-none focus:ring-olive-green sm:text-sm\"\r\n                   placeholder=\"كلمة المرور الجديدة (8+ حروف، رموز، إلخ)\">\r\n          </div>\r\n           <div>\r\n            <label for=\"confirm-password\" class=\"sr-only\">تأكيد كلمة المرور الجديدة</label>\r\n            <input id=\"confirm-password\" name=\"confirm-password\" type=\"password\" v-model=\"confirmPassword\" autocomplete=\"new-password\" required\r\n                   class=\"relative block w-full appearance-none rounded-none rounded-b-md border border-cream-gray px-3 py-2 text-brown-dark placeholder-gray-500 focus:z-10 focus:border-olive-green focus:outline-none focus:ring-olive-green sm:text-sm\"\r\n                   placeholder=\"تأكيد كلمة المرور الجديدة\">\r\n          </div>\r\n        </div>\r\n\r\n        <div>\r\n          <button type=\"submit\" :disabled=\"loading\"\r\n                  class=\"group relative flex w-full justify-center rounded-md border border-transparent bg-olive-green py-2 px-4 text-sm font-medium text-white hover:bg-opacity-85 focus:outline-none focus:ring-2 focus:ring-olive-green focus:ring-offset-2 disabled:opacity-50\">\r\n            <span v-if=\"loading\" class=\"absolute inset-y-0 left-0 flex items-center pl-3\">\r\n               <svg class=\"animate-spin h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                  <circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\r\n                  <path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                </svg>\r\n            </span>\r\n            <span :class=\"{ 'opacity-0': loading }\">تحديث كلمة المرور</span>\r\n          </button>\r\n        </div>\r\n      </form>\r\n        <div v-if=\"!showForm && !loading && !isError\" class=\"text-sm text-center mt-4\"> {/* تعديل الشرط */}\r\n          <NuxtLink to=\"/login\" class=\"font-medium text-olive-green hover:underline\">\r\n            العودة لتسجيل الدخول\r\n          </NuxtLink>\r\n        </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, onMounted } from 'vue'\r\nimport { useSupabaseClient, navigateTo } from '#imports' // لا نحتاج route هنا بالضرورة\r\n\r\nconst client = useSupabaseClient()\r\nconst password = ref('')\r\nconst confirmPassword = ref('')\r\nconst message = ref('')\r\nconst isError = ref(false)\r\nconst loading = ref(false)\r\nconst showForm = ref(false)\r\n\r\nonMounted(() => {\r\n  // ننتظر قليلاً للتأكد من معالجة الـ fragment بواسطة Supabase listener\r\n  setTimeout(async () => {\r\n      const { data: { session } } = await client.auth.getSession();\r\n      if (session) {\r\n          // يوجد جلسة صالحة (تم التحقق من الرمز بنجاح)، أظهر نموذج تغيير كلمة المرور\r\n          showForm.value = true;\r\n      } else {\r\n          // لا يوجد جلسة صالحة، الرابط غير صالح أو منتهي الصلاحية\r\n          message.value = 'الرابط المستخدم غير صالح أو انتهت صلاحيته. يرجى طلب رابط جديد.';\r\n          isError.value = true;\r\n          showForm.value = false;\r\n      }\r\n  }, 500);\r\n});\r\n\r\nconst handleResetPassword = async () => {\r\n  if (password.value !== confirmPassword.value) {\r\n    message.value = 'كلمتا المرور غير متطابقتين.'\r\n    isError.value = true\r\n    return\r\n  }\r\n  // يمكنك إضافة التحقق من قوة كلمة المرور هنا أيضًا\r\n\r\n  loading.value = true\r\n  message.value = ''\r\n  isError.value = false\r\n\r\n  const { error } = await client.auth.updateUser({\r\n    password: password.value\r\n  })\r\n\r\n  loading.value = false\r\n\r\n  if (error) {\r\n    console.error('Reset Password Error:', error.message)\r\n    message.value = error.message || 'حدث خطأ أثناء تحديث كلمة المرور.'\r\n    isError.value = true\r\n  } else {\r\n    message.value = 'تم تحديث كلمة المرور بنجاح! سيتم تسجيل خروجك الآن. يمكنك تسجيل الدخول بكلمة المرور الجديدة.'\r\n    isError.value = false\r\n    showForm.value = false // إخفاء النموذج بعد النجاح\r\n    // تسجيل الخروج لإنهاء الجلسة المؤقتة بشكل واضح\r\n    await client.auth.signOut();\r\n    // يمكنك توجيه المستخدم لصفحة الدخول بعد لحظات\r\n    setTimeout(() => navigateTo('/login'), 3000);\r\n  }\r\n}\r\n\r\n// تحديد التخطيط الافتراضي\r\ndefinePageMeta({\r\n  layout: 'default'\r\n})\r\n</script>\r\n\r\n<style scoped>\r\nbutton:disabled span:first-child {\r\n    left: 0.75rem;\r\n}\r\n</style>"],"version":3}