{"file":"confirm.vue3.mjs","mappings":";;;;;;;;;;;AAsDA,UAAM,OAAO,gBAAgB;AACd,sBAAkB;AACnB,aAAS;AAGjB,UAAA,UAAU,IAAI,EAAE;AAChB,UAAA,UAAU,IAAI,KAAK;AACnB,UAAA,iBAAiB,IAAI,IAAI;AACzB,UAAA,mBAAmB,IAAI,KAAK;AAG5B,UAAA,iBAAiB,IAAI,EAAE;AACvB,UAAA,gBAAgB,IAAI,KAAK;AACzB,UAAA,gBAAgB,IAAI,EAAE;AACtB,UAAA,cAAc,IAAI,KAAK;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":[],"sources":["../../../../pages/confirm.vue"],"sourcesContent":["<template>\r\n  <div class=\"flex items-center justify-center min-h-[calc(100vh-200px)] py-12 px-4 sm:px-6 lg:px-8\">\r\n    <div class=\"w-full max-w-md space-y-8 bg-white p-8 md:p-10 rounded-lg shadow border border-cream-gray\">\r\n      <h1 class=\"text-2xl md:text-3xl font-semibold text-center text-brown-dark mb-4\"> \r\n        تأكيد البريد الإلكتروني\r\n      </h1>\r\n\r\n      <!-- حالة التحميل الأولي -->\r\n      <div v-if=\"initialLoading\" class=\"py-6 text-center\"> \r\n        <p class=\"text-gray-600 mb-4\">جارٍ التحقق من حالة الحساب...</p>\r\n        <div class=\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-olive-green\"></div>\r\n      </div>\r\n\r\n      <!-- عرض الرسائل بعد التحميل -->\r\n      <div v-else class=\"text-center\"> \r\n        <div v-if=\"message\" :class=\"isError ? 'text-red-600' : 'text-green-600'\" class=\"text-lg mb-6 p-3 bg-opacity-10 rounded\" :style=\"{ backgroundColor: isError ? 'rgba(239, 68, 68, 0.1)' : 'rgba(34, 197, 94, 0.1)' }\">\r\n          {{ message }}\r\n        </div>\r\n\r\n        <!-- زر إعادة الإرسال (يظهر إذا لم يتم التأكيد أو حدث خطأ) -->\r\n        <div v-if=\"showResendButton && emailForResend\" class=\"mt-6\">\r\n           <p class=\"text-sm text-gray-600 mb-2\">لم تستلم الإيميل أو انتهت صلاحية الرابط؟</p>\r\n           <button @click=\"resendConfirmation\" :disabled=\"resendLoading\"\r\n                   class=\"text-sm bg-gray-200 text-brown-dark px-4 py-2 rounded-md hover:bg-gray-300 disabled:opacity-50 disabled:cursor-wait\">\r\n             <span v-if=\"resendLoading\">جارٍ الإرسال...</span>\r\n             <span v-else>إعادة إرسال رابط التأكيد</span>\r\n           </button>\r\n           <p v-if=\"resendMessage\" class=\"mt-2 text-xs\" :class=\"resendError ? 'text-red-500' : 'text-green-500'\">\r\n             {{ resendMessage }}\r\n           </p>\r\n        </div>\r\n\r\n         <!-- رابط العودة (يظهر دائمًا بعد التحميل الأولي) -->\r\n         <div class=\"mt-8\">\r\n            <NuxtLink to=\"/\" class=\"inline-block text-olive-green hover:underline font-medium\">\r\n                <Icon name=\"mdi:arrow-right\" class=\"inline-block ml-1\" /> \r\n                العودة إلى الصفحة الرئيسية\r\n            </NuxtLink>\r\n            <NuxtLink v-if=\"user\" to=\"/profile\" class=\"inline-block text-olive-green hover:underline font-medium mr-4\">\r\n                 الذهاب للملف الشخصي\r\n                <Icon name=\"mdi:account-circle-outline\" class=\"inline-block ml-1\" />\r\n            </NuxtLink>\r\n         </div>\r\n\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, onMounted } from 'vue'\r\nimport { useSupabaseUser, useSupabaseClient, navigateTo, useRoute } from '#imports'\r\n\r\nconst user = useSupabaseUser()\r\nconst client = useSupabaseClient()\r\nconst route = useRoute()\r\n\r\n// حالة التحميل والرسائل الأساسية\r\nconst message = ref('')\r\nconst isError = ref(false)\r\nconst initialLoading = ref(true) // للتحميل الأولي عند فتح الصفحة\r\nconst showResendButton = ref(false) // للتحكم بظهور زر إعادة الإرسال\r\n\r\n// حالة زر إعادة الإرسال\r\nconst emailForResend = ref('') // سنحصل عليه من URL أو المستخدم\r\nconst resendLoading = ref(false)\r\nconst resendMessage = ref('')\r\nconst resendError = ref(false)\r\n\r\nonMounted(() => {\r\n  // 1. حاول الحصول على البريد الإلكتروني من الـ URL (إذا تم التوجيه من signup)\r\n  if (route.query.email) {\r\n    emailForResend.value = route.query.email.toString();\r\n  }\r\n\r\n  // 2. انتظر قليلاً ثم تحقق من حالة المستخدم\r\n  setTimeout(() => {\r\n    initialLoading.value = false // انتهى التحميل الأولي\r\n    if (user.value) {\r\n      // المستخدم سُجل دخوله (إما تم التأكيد الآن أو كان مسجلاً بالفعل)\r\n      if (user.value.email_confirmed_at) {\r\n         message.value = 'تم تأكيد حسابك بنجاح! يمكنك الآن استخدام جميع ميزات الموقع.'\r\n         isError.value = false\r\n         showResendButton.value = false\r\n      } else {\r\n         message.value = 'حسابك موجود ولكن لم يتم تأكيد بريدك الإلكتروني بعد. يرجى التحقق من بريدك الوارد (والـ Spam) والنقر على رابط التأكيد.'\r\n         isError.value = true\r\n         showResendButton.value = true\r\n         if (!emailForResend.value && user.value.email) {\r\n             emailForResend.value = user.value.email;\r\n         }\r\n      }\r\n\r\n    } else {\r\n      // المستخدم غير مسجل دخوله\r\n      message.value = 'لإكمال عملية التسجيل أو التأكيد، يرجى التحقق من بريدك الإلكتروني والنقر على الرابط المُرسل. إذا لم تستلم الإيميل، يمكنك طلب إعادة إرساله.'\r\n      isError.value = true\r\n      showResendButton.value = true\r\n      if (!emailForResend.value) {\r\n          console.warn(\"Email not found in URL for resend functionality.\");\r\n          message.value += \"\\n(لم نتمكن من تحديد بريدك لإعادة الإرسال تلقائيًا.)\";\r\n      }\r\n    }\r\n  }, 1500);\r\n})\r\n\r\n// دالة إعادة إرسال إيميل التأكيد\r\nconst resendConfirmation = async () => {\r\n  if (!emailForResend.value) {\r\n      resendMessage.value = 'لا يمكن تحديد البريد الإلكتروني لإعادة الإرسال.';\r\n      resendError.value = true;\r\n      return;\r\n  }\r\n  resendLoading.value = true;\r\n  resendMessage.value = '';\r\n  resendError.value = false;\r\n\r\n  const { error } = await client.auth.resend({\r\n    type: 'signup',\r\n    email: emailForResend.value,\r\n  });\r\n\r\n  resendLoading.value = false;\r\n  if (error) {\r\n    console.error(\"Resend Error:\", error);\r\n    resendMessage.value = error.message || 'فشل إرسال الإيميل. حاول مرة أخرى لاحقًا.';\r\n    resendError.value = true;\r\n  } else {\r\n    resendMessage.value = 'تم إعادة إرسال إيميل التأكيد بنجاح. يرجى التحقق من بريدك.';\r\n    resendError.value = false;\r\n  }\r\n};\r\n\r\n// تحديد التخطيط الافتراضي\r\ndefinePageMeta({\r\n  layout: 'default'\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n/* أنماط إضافية إذا لزم الأمر */\r\n</style>"],"version":3}