{"version":3,"file":"_lessonId_.vue2.mjs","sources":["../../../../../../../../pages/study/courses/[courseId]/lessons/[lessonId].vue"],"sourcesContent":["<template>\r\n  <div class=\"container mx-auto px-4 py-8\">\r\n\r\n    <!-- 1. Loading State -->\r\n    <div v-if=\"pending\" class=\"text-center py-20\">\r\n      <LoadingSpinner />\r\n      <p class=\"mt-4 text-gray-600 dark:text-gray-400\">جارٍ تحميل بيانات الدرس...</p>\r\n    </div>\r\n\r\n    <!-- 2. Error State -->\r\n    <div v-else-if=\"error || !lesson\" class=\"text-center py-20 max-w-2xl mx-auto\">\r\n       <h2 class=\"text-2xl font-semibold text-red-600 dark:text-red-400 mb-4\">\r\n        {{ error?.data?.statusMessage || error?.message || 'خطأ في الوصول للدرس' }}\r\n      </h2>\r\n      <p class=\"text-gray-600 dark:text-gray-400 mb-6\">\r\n        لم نتمكن من العثور على الدرس المطلوب ضمن هذه الدورة، أو أن الدورة غير نشطة، أو أنك لا تملك صلاحية الوصول إليه. يرجى التأكد من الرابط أو العودة للدورة.\r\n      </p>\r\n      <NuxtLink\r\n        :to=\"courseIdParam ? `/study/courses/${courseIdParam}` : '/study'\"\r\n        class=\"inline-flex items-center justify-center px-6 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-olive-green hover:bg-opacity-80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-olive-green\"\r\n      >\r\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-5 h-5 ms-2\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.25-7.25a.75.75 0 0 0 0-1.5H8.66l2.1-1.95a.75.75 0 1 0-1.02-1.1l-3.5 3.25a.75.75 0 0 0 0 1.1l3.5 3.25a.75.75 0 0 0 1.02-1.1l-2.1-1.95h4.59Z\" clip-rule=\"evenodd\" /></svg>\r\n        <span>العودة للدورة</span>\r\n      </NuxtLink>\r\n    </div>\r\n\r\n    <!-- 3. Lesson Details Display -->\r\n    <div v-else class=\"lesson-details max-w-5xl mx-auto space-y-6\">\r\n\r\n      <!-- Course Context Header -->\r\n      <div v-if=\"courseInfo\" class=\"mb-4 text-sm text-center md:text-right\">\r\n        <NuxtLink :to=\"`/study/courses/${courseInfo.id}`\" class=\"text-gray-600 dark:text-gray-400 hover:text-olive-green transition-colors duration-200\">\r\n          دورة: {{ courseInfo.title }}\r\n        </NuxtLink>\r\n      </div>\r\n\r\n      <!-- Lesson Title -->\r\n      <h1 class=\"text-3xl font-bold text-brown-dark dark:text-brown-dark text-center sm:text-right\">\r\n        {{ lesson.title || 'درس بدون عنوان' }}\r\n      </h1>\r\n\r\n      <!-- Video Section with Integrated Navigation (Corrected) -->\r\n      <div class=\"video-section flex items-center gap-2 sm:gap-4\">\r\n        <!-- Previous Lesson Button -->\r\n        <div class=\"flex-shrink-0\">\r\n          <NuxtLink v-if=\"previousLesson && courseIdParam\" :to=\"`/study/courses/${courseIdParam}/lessons/${previousLesson.id}`\" class=\"nav-button\" :title=\"`الدرس السابق: ${previousLesson.title}`\" aria-label=\"الدرس السابق\">\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"nav-icon\" aria-hidden=\"true\"> <path fill-rule=\"evenodd\" d=\"M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z\" clip-rule=\"evenodd\" /></svg>\r\n          </NuxtLink>\r\n          <div v-else class=\"nav-placeholder\" aria-hidden=\"true\"></div>\r\n        </div>\r\n\r\n        <!-- Video Player Container -->\r\n        <div class=\"flex-grow min-w-0\">\r\n          <div v-if=\"youtubeVideoId\" class=\"relative w-full rounded-lg overflow-hidden shadow-lg bg-black aspect-video\">\r\n            <iframe\r\n              :src=\"`https://www.youtube.com/embed/${youtubeVideoId}`\"\r\n              frameborder=\"0\"\r\n              allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\"\r\n              referrerpolicy=\"strict-origin-when-cross-origin\"\r\n              allowfullscreen\r\n              class=\"absolute inset-0 w-full h-full\"\r\n              title=\"مشغل فيديو الدرس\"\r\n              aria-label=\"مشغل فيديو الدرس\"\r\n            ></iframe>\r\n          </div>\r\n          <div v-else-if=\"lesson.youtube_url\" class=\"video-error-box p-4 bg-yellow-100 dark:bg-yellow-900 border border-yellow-300 dark:border-yellow-700 text-yellow-800 dark:text-yellow-200 rounded-md\">\r\n             <p class=\"font-semibold\">رابط يوتيوب غير صالح أو غير متوفر.</p>\r\n             <p class=\"mt-1 text-sm\">الرجاء التأكد من أن الرابط في قاعدة البيانات هو رابط يوتيوب صحيح (مثل youtube.com/watch?v=... أو youtu.be/... أو youtube.com/embed/... أو youtube.com/shorts/...).</p>\r\n             <p class=\"mt-1 text-sm\">الرابط المسجل حالياً:</p>\r\n             <code class=\"block break-all mt-1 text-xs bg-yellow-200 dark:bg-yellow-800 px-1 rounded\">{{ lesson.youtube_url }}</code>\r\n          </div>\r\n          <div v-else class=\"video-error-box p-4 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 rounded-md\">\r\n            <p>لا يوجد رابط فيديو متاح لهذا الدرس.</p>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Next Lesson Button -->\r\n        <div class=\"flex-shrink-0\">\r\n          <NuxtLink v-if=\"nextLesson && courseIdParam\" :to=\"`/study/courses/${courseIdParam}/lessons/${nextLesson.id}`\" class=\"nav-button\" :title=\"`الدرس التالي: ${nextLesson.title}`\" aria-label=\"الدرس التالي\">\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"nav-icon\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z\" clip-rule=\"evenodd\" /></svg>\r\n          </NuxtLink>\r\n          <div v-else class=\"nav-placeholder\" aria-hidden=\"true\"></div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Action Buttons Section (Completion & Quiz) -->\r\n      <ClientOnly>\r\n        <div class=\"action-buttons-section text-center mt-6 space-y-4\">\r\n\r\n            <!-- Case 1: Logged in AND Enrolled -->\r\n            <div v-if=\"isLoggedIn && isEnrolledInCourse\">\r\n              <!-- Mark as Complete / Completed Status -->\r\n              <div class=\"completion-status\">\r\n                  <button v-if=\"!isLessonCompleted\" @click=\"markLessonComplete\" :disabled=\"completeLoading\" class=\"button-complete\">\r\n                    <span v-if=\"completeLoading\">\r\n                      <LoadingSpinner class=\"w-5 h-5 inline me-2 animate-spin\" aria-hidden=\"true\" />\r\n                      جاري التحديث...\r\n                    </span>\r\n                    <span v-else class=\"inline-flex items-center\">\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-5 h-5 me-1\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z\" clip-rule=\"evenodd\" /></svg>\r\n                      تمييز الدرس كمكتمل\r\n                    </span>\r\n                  </button>\r\n                  <div v-else class=\"inline-flex items-center px-4 py-2 border border-green-300 dark:border-green-700 rounded-md text-sm font-medium text-green-700 dark:text-green-300 bg-green-50 dark:bg-green-900/30\">\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-5 h-5 me-2\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M16.403 12.652a3 3 0 0 0 0-5.304 3 3 0 0 0-3.75-3.751 3 3 0 0 0-5.305 0 3 3 0 0 0-3.751 3.75 3 3 0 0 0 0 5.305 3 3 0 0 0 3.75 3.751 3 3 0 0 0 5.305 0 3 3 0 0 0 3.751-3.75Zm-2.546-4.46a.75.75 0 0 0-1.214-.883l-3.48 4.774L6.52 10.91a.75.75 0 1 0-1.04 1.08l2.18 2.108a.75.75 0 0 0 1.076-.015l4.145-5.682Z\" clip-rule=\"evenodd\" /></svg>\r\n                    تم إكمال هذا الدرس\r\n                  </div>\r\n                  <p v-if=\"completeError\" class=\"text-xs text-red-500 dark:text-red-400 mt-2\">{{ completeError }}</p>\r\n              </div>\r\n\r\n              <!-- **** START: Lesson Quiz Button **** -->\r\n              <div v-if=\"lessonQuiz\" class=\"quiz-link mt-4\">\r\n                 <NuxtLink\r\n                   :to=\"`/quizzes/${lessonQuiz.id}`\"\r\n                   class=\"button-quiz inline-flex items-center justify-center px-5 py-2.5 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-muted hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-muted dark:bg-blue-muted dark:hover:opacity-90 dark:focus:ring-offset-gray-800 dark:text-gray-900 transition-opacity duration-150 ease-in-out\"\r\n                 >\r\n                   <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-5 h-5 me-1\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M15.962 2.61a.75.75 0 0 0-.61-.21L4.04 4.357a.75.75 0 0 0-.61.846l.727 3.474a.75.75 0 0 0 .756.623H6.75V13a.75.75 0 0 0 .75.75h5.5a.75.75 0 0 0 .75-.75V9.3H15.5a.75.75 0 0 0 .756-.623l.727-3.474a.75.75 0 0 0-.021-.592Zm-1.02 4.04-.484 2.31H7.5v-2.7l7.958-1.307.484 2.31Z\" clip-rule=\"evenodd\" /><path d=\"M4.5 10.5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5a.75.75 0 0 1 .75-.75Z\" /><path d=\"M15.5 10.5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5a.75.75 0 0 1 .75-.75Z\" /></svg>\r\n                   <span>ابدأ اختبار الدرس</span>\r\n                 </NuxtLink>\r\n              </div>\r\n              <!-- **** END: Lesson Quiz Button **** -->\r\n\r\n            </div>\r\n            <!-- Case 2: Logged in BUT NOT Enrolled -->\r\n            <div v-else-if=\"isLoggedIn && !isEnrolledInCourse && courseIdParam\" class=\"enroll-prompt p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg max-w-md mx-auto\">\r\n              <p class=\"text-sm text-yellow-800 dark:text-yellow-200\">يجب الانتساب للدورة أولاً لتتمكن من تتبع تقدمك وتقديم الاختبارات.</p>\r\n              <button @click=\"handleEnroll(courseIdParam)\" :disabled=\"enrollLoading\" class=\"button-enroll mt-3\">\r\n                <span v-if=\"enrollLoading\">\r\n                  <LoadingSpinner class=\"w-5 h-5 inline me-2 animate-spin\" aria-hidden=\"true\" />\r\n                  جاري الانتساب...\r\n                </span>\r\n                <span v-else>انتسب للدورة الآن</span>\r\n              </button>\r\n              <p v-if=\"enrollError\" class=\"text-xs text-red-500 dark:text-red-400 mt-1\">{{ enrollError }}</p>\r\n            </div>\r\n            <!-- Case 3: Not Logged In -->\r\n            <div v-else-if=\"!isLoggedIn\" class=\"login-prompt p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg max-w-md mx-auto\">\r\n              <p class=\"text-sm text-blue-800 dark:text-blue-200 mb-3\">سجل الدخول أو أنشئ حساباً لتتمكن من الانتساب لهذه الدورة وتتبع تقدمك.</p>\r\n              <NuxtLink :to=\"`/login?redirect=${route.fullPath}`\" class=\"button-login\">\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-5 h-5 me-1\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M3 4.25A2.25 2.25 0 0 1 5.25 2h5.5A2.25 2.25 0 0 1 13 4.25v2a.75.75 0 0 1-1.5 0v-2a.75.75 0 0 0-.75-.75h-5.5a.75.75 0 0 0-.75.75v11.5c0 .414.336.75.75.75h5.5a.75.75 0 0 0 .75-.75v-2a.75.75 0 0 1 1.5 0v2A2.25 2.25 0 0 1 10.75 18h-5.5A2.25 2.25 0 0 1 3 15.75V4.25Z\" clip-rule=\"evenodd\" /><path fill-rule=\"evenodd\" d=\"M6 10a.75.75 0 0 1 .75-.75h9.546l-1.048-.943a.75.75 0 1 1 1.004-1.114l2.5 2.25a.75.75 0 0 1 0 1.114l-2.5 2.25a.75.75 0 1 1-1.004-1.114l1.048-.943H6.75A.75.75 0 0 1 6 10Z\" clip-rule=\"evenodd\" /></svg>\r\n                تسجيل الدخول / إنشاء حساب\r\n              </NuxtLink>\r\n            </div>\r\n\r\n        </div>\r\n        <template #fallback>\r\n          <div class=\"text-center mt-6 h-16 bg-gray-100 dark:bg-gray-800 animate-pulse rounded-md max-w-xs mx-auto\"></div>\r\n        </template>\r\n      </ClientOnly>\r\n\r\n      <!-- Description Section -->\r\n      <div class=\"description-section pt-6 border-t border-gray-200 dark:border-gray-700\" v-if=\"lesson.description\">\r\n           <h2 class=\"text-2xl font-semibold text-brown-dark dark:text-beige-light mb-3\">عن الدرس:</h2>\r\n           <div class=\"prose prose-lg dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 whitespace-pre-wrap\">\r\n             {{ lesson.description }}\r\n           </div>\r\n      </div>\r\n      <div v-else class=\"description-section pt-6 border-t border-gray-200 dark:border-gray-700 text-gray-500 dark:text-gray-400 italic\">لا يوجد وصف متاح لهذا الدرس.</div>\r\n\r\n      <!-- Downloads & Linked Books Section -->\r\n      <div v-if=\"linkedBooks && linkedBooks.length > 0\" class=\"downloads-section p-5 bg-beige-light dark:bg-cream-gray rounded-lg shadow-sm border border-cream-gray dark:border-gray-700\">\r\n         <h3 class=\"text-lg font-semibold text-brown-dark dark:text-brown-dark mb-4\">ملفات وكتب مرتبطة:</h3>\r\n         <div class=\"flex flex-col sm:flex-row items-start sm:items-center gap-3 flex-wrap\">\r\n           <div v-for=\"book in linkedBooks\" :key=\"book.id\">\r\n             <button v-if=\"book.storage_path\" @click=\"openPdfModal(book.storage_path, book.title)\" class=\"button-secondary inline-flex items-center gap-2 text-sm\">\r\n               <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-5 h-5\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M4.5 2A1.5 1.5 0 0 0 3 3.5v13A1.5 1.5 0 0 0 4.5 18h11a1.5 1.5 0 0 0 1.5-1.5V7.621a1.5 1.5 0 0 0-.44-1.06l-4.12-4.122A1.5 1.5 0 0 0 11.378 2H4.5Zm4.75 8.75a.75.75 0 0 1 .75.75v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 .75-.75Z\" clip-rule=\"evenodd\" /><path fill-rule=\"evenodd\" d=\"M9 3.5a.5.5 0 0 0-.5.5v2.75A1.75 1.75 0 0 0 10.25 8.5h2.75a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 0-.5-.5h-3ZM11 5.75v1.75a.25.25 0 0 0 .25.25h1.75a.25.25 0 0 0 .25-.25V5.75H11Z\" clip-rule=\"evenodd\" /></svg>\r\n               <span>عرض: {{ book.title }} <span class=\"text-xs opacity-75\">({{ getBookType(book) }})</span></span>\r\n             </button>\r\n             <span v-else class=\"inline-flex items-center gap-1 text-xs text-gray-400 dark:text-gray-500 italic px-4 py-2\">\r\n               <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-4 h-4 opacity-50\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0ZM8.28 7.22a.75.75 0 0 0-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 1 0 1.06 1.06L10 11.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L11.06 10l1.72-1.72a.75.75 0 0 0-1.06-1.06L10 8.94 8.28 7.22Z\" clip-rule=\"evenodd\" /></svg>\r\n               <span>{{ book.title }} (لا يوجد ملف مرفق)</span>\r\n             </span>\r\n           </div>\r\n         </div>\r\n      </div>\r\n\r\n      <!-- Comments Section -->\r\n      <ClientOnly>\r\n        <CommentSection v-if=\"lesson?.id\" :lesson-id=\"lesson.id\" class=\"pt-6 border-t border-gray-200 dark:border-gray-700\"/>\r\n        <template #fallback>\r\n            <div class=\"pt-6 border-t border-gray-200 dark:border-gray-700\">\r\n              <div class=\"h-8 w-32 bg-gray-200 dark:bg-gray-700 rounded animate-pulse mb-4\"></div>\r\n              <div class=\"h-20 bg-gray-100 dark:bg-gray-800 rounded animate-pulse\"></div>\r\n            </div>\r\n        </template>\r\n      </ClientOnly>\r\n\r\n    </div>\r\n\r\n    <!-- PDF Viewer Modal -->\r\n    <ClientOnly>\r\n      <LazyPdfViewerModal\r\n        :show=\"showPdfModal\"\r\n        :storage-path=\"selectedPdfPath\"\r\n        :book-title=\"selectedBookTitle\"\r\n        @close=\"closePdfModal\"\r\n      />\r\n       <template #fallback>\r\n         <div></div>\r\n      </template>\r\n    </ClientOnly>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\n// --- Imports ---\r\nimport { ref, computed, watch, shallowRef, defineAsyncComponent } from 'vue';\r\nimport { useRoute, useSupabaseClient, useAsyncData, useHead, showError, navigateTo, createError } from '#imports';\r\nimport type { Database, Tables, Enums } from '~/types/database.types';\r\nimport { useUserStore } from '~/stores/user';\r\nimport { storeToRefs } from 'pinia';\r\nimport LoadingSpinner from '~/components/LoadingSpinner.vue';\r\nimport CommentSection from '~/components/CommentSection.vue';\r\nconst LazyPdfViewerModal = defineAsyncComponent(() => import('~/components/PdfViewerModal.vue'));\r\n\r\n// --- Composables & Store ---\r\nconst route = useRoute();\r\nconst supabase = useSupabaseClient<Database>();\r\nconst userStore = useUserStore();\r\nconst { profile, isLoggedIn } = storeToRefs(userStore);\r\n\r\nconsole.log(`--- LESSON PAGE [${route.params.lessonId}] SETUP STARTED ---`);\r\n\r\n// --- Types ---\r\ntype Lesson = Tables<'lessons'>;\r\ntype Book = Tables<'books'>;\r\ntype NavLessonInfo = Pick<Tables<'lessons'>, 'id' | 'title'> | null;\r\ntype CourseInfo = Pick<Tables<'study_courses'>, 'id' | 'title'> | null;\r\ntype LessonCompletion = Pick<Tables<'lesson_completions'>, 'lesson_id'>;\r\ntype CourseEnrollment = Tables<'course_enrollments'>;\r\ntype LessonQuizInfo = Pick<Tables<'quizzes'>, 'id' | 'title' | 'is_active'> | null;\r\n\r\n// --- Route Params with Validation ---\r\nconst courseIdParam = computed<number | null>(() => {\r\n    const rawParam = route.params.courseId as string;\r\n    if (!rawParam) {\r\n        showError({ statusCode: 400, statusMessage: 'معرف الدورة مفقود من الرابط.', fatal: true });\r\n        return null;\r\n    }\r\n    const id = parseInt(rawParam, 10);\r\n    if (isNaN(id) || id <= 0) {\r\n        showError({ statusCode: 400, statusMessage: `معرف الدورة غير صالح: \"${rawParam}\"`, fatal: true });\r\n        return null;\r\n    }\r\n    return id;\r\n});\r\nconst lessonIdParam = computed<number | null>(() => {\r\n    const rawParam = route.params.lessonId as string;\r\n     if (!rawParam) {\r\n        showError({ statusCode: 400, statusMessage: 'معرف الدرس مفقود من الرابط.', fatal: true });\r\n        return null;\r\n    }\r\n    const id = parseInt(rawParam, 10);\r\n    if (isNaN(id) || id <= 0) {\r\n        showError({ statusCode: 400, statusMessage: `معرف الدرس غير صالح: \"${rawParam}\"`, fatal: true });\r\n        return null;\r\n    }\r\n    return id;\r\n});\r\n\r\n// --- State ---\r\nconst lesson = shallowRef<Lesson | null>(null);\r\nconst linkedBooks = shallowRef<Book[]>([]);\r\nconst previousLesson = shallowRef<NavLessonInfo>(null);\r\nconst nextLesson = shallowRef<NavLessonInfo>(null);\r\nconst courseInfo = shallowRef<CourseInfo>(null);\r\nconst lessonCompletion = shallowRef<LessonCompletion | null>(null);\r\nconst enrollment = shallowRef<CourseEnrollment | null>(null);\r\nconst lessonQuiz = shallowRef<LessonQuizInfo>(null);\r\n\r\nconst completeLoading = ref(false);\r\nconst completeError = ref<string | null>(null);\r\nconst enrollLoading = ref(false);\r\nconst enrollError = ref<string | null>(null);\r\nconst showPdfModal = ref(false);\r\nconst selectedPdfPath = ref<string | null>(null);\r\nconst selectedBookTitle = ref<string | null>(null);\r\n\r\nif (courseIdParam.value === null || lessonIdParam.value === null) {\r\n     console.error(\"Lesson Page Setup: Halting due to invalid route parameters detected earlier.\");\r\n}\r\n\r\n// --- Data Fetching with useAsyncData ---\r\nconst { data, pending, error, refresh } = await useAsyncData(\r\n  `lessonData-${courseIdParam.value}-${lessonIdParam.value}-${profile.value?.id ?? 'guest'}`,\r\n  async () => {\r\n    const currentLessonId = lessonIdParam.value;\r\n    const currentCourseId = courseIdParam.value;\r\n    const currentUserId = profile.value?.id;\r\n\r\n    if (currentCourseId === null || currentLessonId === null) {\r\n      console.error(\"Fetcher Error: Invalid course or lesson ID at fetch time.\");\r\n      throw createError({ statusCode: 400, statusMessage: 'المعرفات المطلوبة غير صالحة لجلب البيانات.', fatal: true });\r\n    }\r\n    console.log(`--- Fetching lesson data for Course ${currentCourseId}, Lesson ${currentLessonId}, User ${currentUserId || 'Guest'} ---`);\r\n\r\n    try {\r\n      // 1. Fetch Primary Lesson Data\r\n      const { data: lessonCourseData, error: lessonCourseError } = await supabase\r\n        .from('lessons')\r\n        .select(`*, course:study_courses!inner (id, title, is_active)`)\r\n        .eq('id', currentLessonId)\r\n        .eq('course_id', currentCourseId)\r\n        .eq('course.is_active', true)\r\n        .maybeSingle();\r\n\r\n      if (lessonCourseError) {\r\n        console.error(\"DB Error fetching lesson/course:\", lessonCourseError);\r\n        throw createError({ statusCode: 500, statusMessage: `خطأ في جلب بيانات الدرس الرئيسية: ${lessonCourseError.message}`, fatal: true });\r\n      }\r\n      if (!lessonCourseData) {\r\n        console.warn(`Lesson ${currentLessonId} not found in active course ${currentCourseId}, or course inactive.`);\r\n        throw createError({ statusCode: 404, statusMessage: 'الدرس المطلوب غير موجود أو لا ينتمي لدورة نشطة.', fatal: true });\r\n      }\r\n\r\n      const fetchedLesson: Lesson = lessonCourseData;\r\n      const fetchedCourseInfo: CourseInfo = lessonCourseData.course as CourseInfo;\r\n      const currentOrder: number | null = fetchedLesson.lesson_order;\r\n\r\n      // 2. Fetch Secondary Data in Parallel\r\n      const fetchPromises = [\r\n        supabase.from('books').select('*').eq('linked_lesson_id', currentLessonId),\r\n        currentOrder !== null ? supabase.from('lessons').select('id, title').eq('course_id', currentCourseId).lt('lesson_order', currentOrder).order('lesson_order', { ascending: false }).limit(1).maybeSingle() : Promise.resolve({ data: null, error: null }),\r\n        currentOrder !== null ? supabase.from('lessons').select('id, title').eq('course_id', currentCourseId).gt('lesson_order', currentOrder).order('lesson_order', { ascending: true }).limit(1).maybeSingle() : Promise.resolve({ data: null, error: null }),\r\n        isLoggedIn.value && currentUserId ? supabase.from('lesson_completions').select('lesson_id').eq('user_id', currentUserId).eq('lesson_id', currentLessonId).maybeSingle() : Promise.resolve({ data: null, error: null }),\r\n        isLoggedIn.value && currentUserId ? supabase.from('course_enrollments').select('*').eq('user_id', currentUserId).eq('course_id', currentCourseId).maybeSingle() : Promise.resolve({ data: null, error: null }),\r\n        supabase.from('quizzes')\r\n            .select('id, title, is_active')\r\n            .eq('lesson_id', currentLessonId)\r\n            .eq('type', 'lesson' as Enums<'quiz_type'>)\r\n            .eq('is_active', true)\r\n            .maybeSingle()\r\n      ];\r\n\r\n      const results = await Promise.allSettled(fetchPromises);\r\n\r\n      const processResult = <T>(index: number, name: string, defaultValue: T): T => {\r\n        const result = results[index];\r\n        if (result.status === 'fulfilled') {\r\n            if (result.value.error) {\r\n                 console.error(`Supabase Error fetching ${name}:`, result.value.error.message);\r\n                 return defaultValue;\r\n            }\r\n            return result.value.data ?? defaultValue;\r\n        } else {\r\n            console.error(`Failed fetching ${name} (Promise rejected):`, result.reason);\r\n            return defaultValue;\r\n        }\r\n      };\r\n\r\n      const fetchedBooks = processResult<Book[]>(0, 'linked books', []);\r\n      const fetchedPreviousLesson = processResult<NavLessonInfo>(1, 'previous lesson', null);\r\n      const fetchedNextLesson = processResult<NavLessonInfo>(2, 'next lesson', null);\r\n      const fetchedCompletion = processResult<LessonCompletion | null>(3, 'completion status', null);\r\n      const fetchedEnrollment = processResult<CourseEnrollment | null>(4, 'enrollment status', null);\r\n      const fetchedLessonQuiz = processResult<LessonQuizInfo>(5, 'lesson quiz', null);\r\n\r\n      // 3. Update Last Accessed Lesson\r\n      if (fetchedEnrollment?.id && fetchedLesson.id) {\r\n          console.log(`Attempting to update last accessed lesson for enrollment ${fetchedEnrollment.id} to lesson ${fetchedLesson.id}`);\r\n          supabase\r\n            .from('course_enrollments')\r\n            .update({ last_accessed_lesson_id: fetchedLesson.id, updated_at: new Date().toISOString() })\r\n            .eq('id', fetchedEnrollment.id)\r\n            .then(({ error: updateError }) => {\r\n                if (updateError) console.error('Failed to update last_accessed_lesson_id:', updateError.message);\r\n                else console.log(`Successfully updated last_accessed_lesson_id.`);\r\n            });\r\n      } else if (isLoggedIn.value && fetchedLesson.id) {\r\n           console.log('User is logged in but not enrolled in this course, skipping last_accessed_lesson update.');\r\n      }\r\n\r\n      console.log('--- Lesson data fetch successful ---');\r\n      // 4. Return the combined data structure\r\n      return {\r\n          lesson: fetchedLesson,\r\n          linkedBooks: fetchedBooks,\r\n          previousLesson: fetchedPreviousLesson,\r\n          nextLesson: fetchedNextLesson,\r\n          courseInfo: fetchedCourseInfo,\r\n          lessonCompletion: fetchedCompletion,\r\n          enrollment: fetchedEnrollment,\r\n          lessonQuiz: fetchedLessonQuiz\r\n      };\r\n\r\n    } catch (err: any) {\r\n        console.error('!!! CRITICAL ERROR in useAsyncData lesson fetch !!!:', err);\r\n        if (err.statusCode && err.fatal) {\r\n            throw err;\r\n        }\r\n        throw createError({\r\n          statusCode: err.statusCode || 500,\r\n          statusMessage: `حدث خطأ غير متوقع أثناء تحميل بيانات الدرس: ${err.message || 'خطأ غير معروف'}`,\r\n          fatal: true\r\n        });\r\n    }\r\n  }, {\r\n    default: () => ({\r\n        lesson: null, linkedBooks: [], previousLesson: null, nextLesson: null,\r\n        courseInfo: null, lessonCompletion: null, enrollment: null,\r\n        lessonQuiz: null\r\n    }),\r\n    watch: [() => profile.value?.id, () => route.params.lessonId, () => route.params.courseId]\r\n  }\r\n);\r\n\r\n// --- Update Local State when Async Data Changes ---\r\n watch(data, (newData) => {\r\n    console.log(\"Lesson page useAsyncData watcher triggered. New data received:\", !!newData);\r\n    if (newData) {\r\n        lesson.value = newData.lesson;\r\n        linkedBooks.value = newData.linkedBooks;\r\n        previousLesson.value = newData.previousLesson;\r\n        nextLesson.value = newData.nextLesson;\r\n        courseInfo.value = newData.courseInfo;\r\n        lessonCompletion.value = newData.lessonCompletion;\r\n        enrollment.value = newData.enrollment;\r\n        lessonQuiz.value = newData.lessonQuiz;\r\n    } else if (!pending.value && !error.value) {\r\n        lesson.value = null;\r\n        linkedBooks.value = [];\r\n        previousLesson.value = null;\r\n        nextLesson.value = null;\r\n        courseInfo.value = null;\r\n        lessonCompletion.value = null;\r\n        enrollment.value = null;\r\n        lessonQuiz.value = null;\r\n    }\r\n }, { immediate: true });\r\n\r\n// --- Computed Properties ---\r\nconst isEnrolledInCourse = computed(() => !!enrollment.value);\r\nconst isLessonCompleted = computed(() => !!lessonCompletion.value);\r\nconst youtubeVideoId = computed<string | null>(() => {\r\n   const url = lesson.value?.youtube_url;\r\n   if (!url) return null;\r\n   try {\r\n     const regex = /(?:https?:\\/\\/)?(?:www\\.)?(?:youtube\\.com\\/(?:watch\\?v=|embed\\/|v\\/|shorts\\/)|youtu\\.be\\/)([a-zA-Z0-9_-]{11})(?:\\S+)?/;\r\n     const match = url.match(regex);\r\n     return (match && match[1]) ? match[1] : null;\r\n   } catch (e) {\r\n     console.error(\"Error parsing YouTube URL:\", url, e);\r\n     return null;\r\n   }\r\n});\r\n\r\n// --- Actions ---\r\nasync function markLessonComplete() {\r\n     if (!isLoggedIn.value || !profile.value?.id || !lesson.value?.id || isLessonCompleted.value || completeLoading.value) return;\r\n     completeLoading.value = true;\r\n     completeError.value = null;\r\n     console.log(`Attempting to mark lesson ${lesson.value.id} as complete for user ${profile.value.id}`);\r\n     try {\r\n         const { data: newCompletion, error: insertError } = await supabase\r\n             .from('lesson_completions')\r\n             .insert({ user_id: profile.value.id, lesson_id: lesson.value.id })\r\n             .select('lesson_id')\r\n             .single();\r\n         if (insertError) {\r\n            if (insertError.code === '23505') {\r\n               console.warn('Lesson already marked complete in DB, syncing local state.');\r\n               if (!lessonCompletion.value) { lessonCompletion.value = { lesson_id: lesson.value.id }; }\r\n            } else { throw insertError; }\r\n         } else if (newCompletion) {\r\n            lessonCompletion.value = newCompletion;\r\n            console.log(\"Lesson successfully marked complete!\");\r\n         }\r\n     } catch (err: any) {\r\n         console.error(\"Error marking lesson complete:\", err);\r\n         completeError.value = `فشل تحديث الحالة: ${err.message || 'حدث خطأ غير متوقع.'}`;\r\n     } finally {\r\n         completeLoading.value = false;\r\n     }\r\n}\r\nasync function handleEnroll(id: number | null) {\r\n     if (id === null || !isLoggedIn.value || !profile.value?.id || isEnrolledInCourse.value || enrollLoading.value) return;\r\n     enrollLoading.value = true;\r\n     enrollError.value = null;\r\n     console.log(`Attempting to enroll user ${profile.value.id} in course ${id}`);\r\n     try {\r\n       const { data: newEnrollment, error: enrollSupabaseError } = await supabase\r\n         .from('course_enrollments')\r\n         .insert({ user_id: profile.value.id, course_id: id })\r\n         .select('*')\r\n         .single();\r\n       if (enrollSupabaseError) {\r\n           if (enrollSupabaseError.code === '23505') {\r\n                console.warn(\"Enrollment conflict detected. Refreshing data.\");\r\n                await refresh();\r\n           } else { throw enrollSupabaseError; }\r\n       } else if (newEnrollment) {\r\n           enrollment.value = newEnrollment;\r\n           console.log(\"Enrollment successful!\");\r\n           alert('تم الانتساب بنجاح!');\r\n       }\r\n     } catch (err:any) {\r\n         console.error(\"Enrollment error on lesson page:\", err);\r\n         enrollError.value = `فشل الانتساب: ${err.message || 'حدث خطأ غير متوقع.'}`;\r\n         alert(enrollError.value);\r\n     } finally {\r\n         enrollLoading.value = false;\r\n     }\r\n}\r\n\r\n// --- PDF Modal Functions ---\r\nfunction openPdfModal(path: string | null | undefined, title: string | null | undefined) {\r\n   if (path) {\r\n     selectedPdfPath.value = path;\r\n     selectedBookTitle.value = title || 'ملف مرتبط';\r\n     showPdfModal.value = true;\r\n     console.log(`Opening PDF modal for path: ${path}`);\r\n   } else {\r\n     console.warn(\"Attempted to open PDF modal with no path for book:\", title);\r\n   }\r\n}\r\nfunction closePdfModal() {\r\n  showPdfModal.value = false;\r\n  selectedPdfPath.value = null;\r\n  selectedBookTitle.value = null;\r\n  console.log(\"PDF modal closed.\");\r\n}\r\n\r\n// --- Utility Functions ---\r\nfunction getBookType(book: Book): string {\r\n     if (book?.is_research && book?.is_transcript) return 'بحث وتفريغ';\r\n     if (book?.is_research) return 'بحث';\r\n     if (book?.is_transcript) return 'تفريغ';\r\n     return 'كتاب';\r\n}\r\n\r\n// --- SEO Meta Tags ---\r\n watch([lesson, courseInfo, pending, error], ([newLesson, newCourse, loadingState, errorState]) => {\r\n    let pageTitle = 'تفاصيل الدرس';\r\n    let description = 'عرض تفاصيل الدرس والمحتوى المرتبط به ضمن دورات الشيخ.';\r\n    if (loadingState) {\r\n        pageTitle = 'جارٍ تحميل الدرس...';\r\n        description = 'يتم الآن تحميل بيانات الدرس.';\r\n    } else if (errorState || !newLesson) {\r\n        pageTitle = 'الدرس غير متاح';\r\n        description = errorState?.data?.statusMessage || errorState?.message || 'لم يتم العثور على الدرس المطلوب أو حدث خطأ.';\r\n    } else {\r\n        const lessonTitle = newLesson.title || 'درس بدون عنوان';\r\n        const courseTitle = newCourse?.title;\r\n        pageTitle = courseTitle ? `${lessonTitle} - ${courseTitle}` : lessonTitle;\r\n        const lessonDesc = newLesson.description;\r\n        if (lessonDesc) {\r\n            description = lessonDesc.substring(0, 160).trim() + (lessonDesc.length > 160 ? '...' : '');\r\n        } else {\r\n            description = `شاهد درس \"${lessonTitle}\"${courseTitle ? ` ضمن دورة \"${courseTitle}\"` : ''}.`;\r\n        }\r\n    }\r\n     useHead({\r\n         title: pageTitle,\r\n         meta: [\r\n            { name: 'description', content: description },\r\n            { property: 'og:title', content: pageTitle },\r\n            { property: 'og:description', content: description },\r\n            { property: 'og:type', content: 'video.other' },\r\n            { property: 'og:url', content: route.fullPath },\r\n            { name: 'twitter:card', content: 'summary_large_image' },\r\n            { name: 'twitter:title', content: pageTitle },\r\n            { name: 'twitter:description', content: description },\r\n         ]\r\n     });\r\n }, { immediate: true });\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.nav-button {\r\n  @apply p-2 sm:p-3 rounded-full text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-900;\r\n}\r\n.nav-icon {\r\n  @apply w-5 h-5 sm:w-6 sm:h-6;\r\n}\r\n.nav-placeholder {\r\n  @apply p-2 sm:p-3 w-[36px] h-[36px] sm:w-[44px] sm:h-[44px];\r\n}\r\n.video-error-box {\r\n  @apply p-4 border rounded-md text-sm;\r\n}\r\n.button-complete {\r\n  @apply inline-flex items-center justify-center px-5 py-2.5 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-60 disabled:cursor-not-allowed transition-colors duration-150 ease-in-out;\r\n}\r\n.button-enroll {\r\n  @apply inline-flex items-center justify-center px-5 py-2.5 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-olive-green hover:bg-opacity-80 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-olive-green disabled:opacity-60 disabled:cursor-not-allowed transition-colors duration-150 ease-in-out;\r\n}\r\n.button-login {\r\n  @apply inline-flex items-center justify-center px-5 py-2.5 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-60 disabled:cursor-not-allowed transition-colors duration-150 ease-in-out;\r\n}\r\n.button-secondary {\r\n  @apply inline-flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-900 transition-colors duration-150 ease-in-out;\r\n}\r\n.button-quiz {\r\n   @apply bg-blue-muted hover:opacity-90 focus:ring-blue-muted dark:bg-blue-muted dark:hover:opacity-90 dark:focus:ring-offset-gray-800 dark:text-gray-900;\r\n   @apply inline-flex items-center justify-center px-5 py-2.5 border border-transparent text-sm font-medium rounded-md shadow-sm text-white focus:outline-none focus:ring-2 focus:ring-offset-2 transition-opacity duration-150 ease-in-out;\r\n}\r\n\r\n.prose :where(p):not(:where([class~=\"not-prose\"] *)) { margin-top: 0.75em; margin-bottom: 0.75em; line-height: 1.7; }\r\ncode { word-break: break-all; font-size: 0.875em; background-color: rgba(0,0,0,0.05); padding: 0.1em 0.3em; border-radius: 0.25rem; }\r\n.dark code { background-color: rgba(255,255,255,0.1); }\r\n.button-complete .animate-spin, .button-enroll .animate-spin { width: 1.25rem; height: 1.25rem; }\r\n.aspect-video { position: relative; width: 100%; padding-bottom: 56.25%; }\r\n.aspect-video iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }\r\n</style>"],"names":["_withAsyncContext","_a"],"mappings":"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"}