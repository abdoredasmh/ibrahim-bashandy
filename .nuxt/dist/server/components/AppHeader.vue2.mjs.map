{"version":3,"file":"AppHeader.vue2.mjs","sources":["../../../../components/AppHeader.vue"],"sourcesContent":["<template>\r\n  <header class=\"bg-white dark:bg-gray-900 shadow-md sticky top-0 z-50\">\r\n    <nav class=\"container mx-auto px-4 py-5 flex items-center justify-between\">\r\n      <NuxtLink to=\"/\" class=\"text-xl font-bold text-olive-green dark:text-yellow-400 hover:opacity-80 transition-opacity\">\r\n        الشيخ إبراهيم بشندي\r\n      </NuxtLink>\r\n\r\n      <!-- روابط سطح المكتب - استخدام v-for -->\r\n      <ul class=\"hidden md:flex items-center gap-x-6 lg:gap-x-8 text-brown-dark dark:text-gray-300\">\r\n        <li v-for=\"link in navLinks\" :key=\"link.to\">\r\n          <NuxtLink :to=\"link.to\" class=\"hover:text-olive-green dark:hover:text-yellow-400 transition-colors\">{{ link.text }}</NuxtLink>\r\n        </li>\r\n        <li v-if=\"isAdmin\">\r\n          <NuxtLink to=\"/admin\" class=\"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 font-semibold transition-colors admin-link\">\r\n             لوحة التحكم\r\n          </NuxtLink>\r\n        </li>\r\n      </ul>\r\n\r\n      <!-- أيقونات الهيدر -->\r\n      <div class=\"flex items-center gap-x-4\">\r\n\r\n        <button class=\"text-brown-dark dark:text-gray-300 hover:text-olive-green dark:hover:text-yellow-400 transition-colors\" aria-label=\"بحث\">\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\" aria-hidden=\"true\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\r\n          </svg>\r\n        </button>\r\n\r\n        <NuxtLink to=\"/\" class=\"relative text-brown-dark dark:text-gray-300 hover:text-olive-green dark:hover:text-yellow-400 transition-colors\" aria-label=\"الإشعارات\">\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\" aria-hidden=\"true\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9\" />\r\n          </svg>\r\n          <!-- استخدام unreadNotifications من ref -->\r\n          <span v-if=\"unreadNotifications > 0\" class=\"absolute -top-1.5 -right-1.5 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white ring-2 ring-white dark:ring-gray-900\">\r\n            {{ unreadNotifications > 9 ? '9+' : unreadNotifications }}\r\n          </span>\r\n        </NuxtLink>\r\n\r\n        <button @click=\"toggleTheme\" class=\"text-brown-dark dark:text-gray-300 hover:text-olive-green dark:hover:text-yellow-400 transition-colors\" aria-label=\"تبديل الوضع الداكن\">\r\n           <!-- SVG للوضع الفاتح (يظهر عندما isDark = false) -->\r\n           <svg v-if=\"!isDark\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class=\"w-6 h-6\" aria-hidden=\"true\">\r\n             <path fill-rule=\"evenodd\" d=\"M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.981A10.503 10.503 0 0 1 18 19.5a10.5 10.5 0 0 1-10.5-10.5 10.503 10.503 0 0 1 2.028-6.282.75.75 0 0 1 .819-.162Z\" clip-rule=\"evenodd\" />\r\n           </svg>\r\n           <!-- SVG للوضع الداكن (يظهر عندما isDark = true) -->\r\n           <svg v-else xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class=\"w-6 h-6\" aria-hidden=\"true\">\r\n              <path d=\"M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.5 12a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM18.894 6.166a.75.75 0 0 0-1.06-1.06l-1.591 1.59a.75.75 0 1 0 1.06 1.061l1.591-1.59ZM21.75 12a.75.75 0 0 1-.75.75h-2.25a.75.75 0 0 1 0-1.5h2.25a.75.75 0 0 1 .75.75ZM17.834 18.894a.75.75 0 0 0 1.06-1.06l-1.59-1.591a.75.75 0 1 0-1.061 1.06l1.59 1.591ZM12 18a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0v-2.25A.75.75 0 0 1 12 18ZM7.758 17.303a.75.75 0 0 0-1.06 1.06l-1.591 1.59a.75.75 0 0 0 1.06 1.061l1.591-1.59ZM6.166 7.758a.75.75 0 0 0 1.06-1.06l-1.59-1.591a.75.75 0 0 0-1.061 1.06l1.59 1.591ZM12 4.5a.75.75 0 0 1-.75.75h-2.25a.75.75 0 0 1 0-1.5h2.25a.75.75 0 0 1 .75.75Z\" />\r\n           </svg>\r\n        </button>\r\n\r\n        <!-- حالة تسجيل الدخول -->\r\n        <ClientOnly>\r\n          <div v-if=\"isLoggedIn\">\r\n            <!-- إضافة ref=\"dropdownRef\" لحاوية القائمة المنسدلة -->\r\n            <div class=\"relative\" ref=\"dropdownRef\">\r\n              <!-- إضافة ref=\"userMenuButtonRef\" لزر فتح القائمة -->\r\n              <button @click=\"toggleDropdown\" ref=\"userMenuButtonRef\" class=\"flex items-center gap-x-2 hover:opacity-80 transition-opacity\" aria-expanded=\"isDropdownOpen.toString()\" aria-controls=\"user-menu\">\r\n                <div class=\"w-8 h-8 rounded-full overflow-hidden bg-olive-green text-white flex items-center justify-center text-sm font-semibold\">\r\n                  <img v-if=\"userAvatar\" :src=\"userAvatar\" alt=\"Avatar\" class=\"w-full h-full object-cover\">\r\n                  <span v-else>{{ displayName.charAt(0).toUpperCase() }}</span>\r\n                </div>\r\n                <span class=\"hidden sm:inline text-sm text-brown-dark dark:text-gray-300\">{{ displayName }}</span>\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4 text-brown-dark dark:text-gray-300 transition-transform duration-200\" :class=\"{'rotate-180': isDropdownOpen}\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\" aria-hidden=\"true\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M19 9l-7 7-7-7\" />\r\n                </svg>\r\n              </button>\r\n\r\n              <transition name=\"dropdown-fade\">\r\n                <div\r\n                    id=\"user-menu\"\r\n                    v-show=\"isDropdownOpen\"\r\n                    @click.stop=\"closeDropdown\"\r\n                    class=\"absolute left-0 rtl:left-auto rtl:right-0 mt-2 w-48 origin-top-left rtl:origin-top-right bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-50 border border-cream-gray dark:border-gray-700 focus:outline-none\"\r\n                    role=\"menu\" aria-orientation=\"vertical\" tabindex=\"-1\"\r\n                 >\r\n                   <!-- إضافة ref لأول عنصر قابل للتركيز (رابط لوحة التحكم إذا كان مشرفاً) -->\r\n                   <NuxtLink v-if=\"isAdmin\" :ref=\"isAdmin ? 'firstDropdownItemRef' : undefined\" to=\"/admin\" role=\"menuitem\" tabindex=\"-1\" class=\"flex items-center gap-2 px-4 py-2 text-sm text-right text-red-600 dark:text-red-400 hover:bg-beige-light dark:hover:bg-gray-700 font-semibold admin-link\">\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-4 h-4\" aria-hidden=\"true\">\r\n                        <path fill-rule=\"evenodd\" d=\"M7.84 1.804A1 1 0 0 1 8.82 1h2.36a1 1 0 0 1 .98.804l.307 1.227a4.99 4.99 0 0 1 5.734 3.313l1.072.268a1 1 0 0 1 .877.97l.03.298a1 1 0 0 1-.627 1.04l-1.14.57a4.995 4.995 0 0 1 0 4.194l1.14.57a1 1 0 0 1 .627 1.04l-.03.298a1 1 0 0 1-.877.97l-1.072.268a4.99 4.99 0 0 1-5.734 3.313l-.307 1.227a1 1 0 0 1-.98.804H8.82a1 1 0 0 1-.98-.804l-.307-1.227a4.99 4.99 0 0 1-5.734-3.313l-1.072-.268a1 1 0 0 1-.877-.97l-.03-.298a1 1 0 0 1 .627-1.04l1.14-.57a4.995 4.995 0 0 1 0-4.194l-1.14-.57a1 1 0 0 1-.627-1.04l.03-.298a1 1 0 0 1 .877-.97l1.072-.268a4.99 4.99 0 0 1 5.734-3.313l.307-1.227ZM10 8a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z\" clip-rule=\"evenodd\" />\r\n                      </svg>\r\n                      <span>لوحة التحكم</span>\r\n                   </NuxtLink>\r\n                   <!-- إضافة ref لرابط الملف الشخصي إذا لم يكن المستخدم مشرفاً (ليكون هو العنصر الأول للتركيز) -->\r\n                   <NuxtLink :ref=\"!isAdmin ? 'firstDropdownItemRef' : undefined\" to=\"/profile\" role=\"menuitem\" tabindex=\"-1\" class=\"flex items-center gap-2 px-4 py-2 text-sm text-right text-brown-dark dark:text-gray-200 hover:bg-beige-light dark:hover:bg-gray-700\">\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-4 h-4\" aria-hidden=\"true\">\r\n                         <path fill-rule=\"evenodd\" d=\"M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-5.5-2.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0ZM10 12a5.99 5.99 0 0 0-4.793 2.39A6.483 6.483 0 0 0 10 16.5a6.483 6.483 0 0 0 4.793-2.11A5.99 5.99 0 0 0 10 12Z\" clip-rule=\"evenodd\" />\r\n                      </svg>\r\n                      <span>الملف الشخصي</span>\r\n                   </NuxtLink>\r\n                   <hr class=\"border-gray-200 dark:border-gray-700 my-1\">\r\n                   <button @click=\"logoutAndClose\" role=\"menuitem\" tabindex=\"-1\" class=\"w-full flex items-center gap-2 px-4 py-2 text-sm text-right text-red-600 dark:text-red-400 hover:bg-beige-light dark:hover:bg-gray-700\">\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" class=\"w-4 h-4\" aria-hidden=\"true\">\r\n                        <path fill-rule=\"evenodd\" d=\"M3 4.25A2.25 2.25 0 0 1 5.25 2h5.5A2.25 2.25 0 0 1 13 4.25v2a.75.75 0 0 1-1.5 0v-2A.75.75 0 0 0 10.75 3.5h-5.5A.75.75 0 0 0 4.5 4.25v11.5c0 .414.336.75.75.75h5.5a.75.75 0 0 0 .75-.75v-2a.75.75 0 0 1 1.5 0v2A2.25 2.25 0 0 1 10.75 18h-5.5A2.25 2.25 0 0 1 3 15.75V4.25Z\" clip-rule=\"evenodd\" />\r\n                        <path fill-rule=\"evenodd\" d=\"M19 10a.75.75 0 0 0-.75-.75H8.75a.75.75 0 0 0 0 1.5h9.5a.75.75 0 0 0 .75-.75Z\" clip-rule=\"evenodd\" />\r\n                        <path fill-rule=\"evenodd\" d=\"M15.28 12.28a.75.75 0 0 0 1.06-1.06l-3-3a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06L12 9.81v8.44a.75.75 0 0 0 1.5 0V9.81l1.78 1.77Z\" clip-rule=\"evenodd\" />\r\n                     </svg>\r\n                      <span>تسجيل الخروج</span>\r\n                   </button>\r\n                </div>\r\n              </transition>\r\n            </div>\r\n          </div>\r\n\r\n          <div v-else class=\"flex items-center gap-x-2\">\r\n            <NuxtLink to=\"/login\" class=\"text-sm bg-olive-green text-white px-3 py-1.5 rounded-md hover:bg-opacity-80 transition-colors\">دخول</NuxtLink>\r\n            <NuxtLink to=\"/signup\" class=\"text-sm border border-olive-green text-olive-green dark:border-yellow-400 dark:text-yellow-400 px-3 py-1.5 rounded-md hover:bg-olive-green hover:text-white dark:hover:bg-yellow-400 dark:hover:text-gray-900 transition-colors\">إنشاء حساب</NuxtLink>\r\n          </div>\r\n        </ClientOnly>\r\n\r\n        <!-- زر القائمة الجانبية للموبايل - إضافة ref -->\r\n        <button @click=\"toggleMobileMenu\" ref=\"mobileMenuButtonRef\" class=\"md:hidden text-brown-dark dark:text-gray-300 hover:text-olive-green dark:hover:text-yellow-400 transition-colors\" aria-label=\"فتح القائمة\">\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\" aria-hidden=\"true\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M4 6h16M4 12h16m-7 6h7\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n    </nav>\r\n  </header>\r\n\r\n  <!-- خلفية القائمة الجانبية -->\r\n  <div\r\n    v-show=\"isSidebarOpen\"\r\n    @click=\"closeSidebar\"\r\n    class=\"fixed inset-0 bg-black bg-opacity-40 z-40 md:hidden transition-opacity duration-300 ease-in-out\"\r\n    :class=\"{ 'opacity-100': isSidebarOpen, 'opacity-0 pointer-events-none': !isSidebarOpen }\"\r\n    aria-hidden=\"true\"\r\n  ></div>\r\n\r\n  <!-- القائمة الجانبية للموبايل -->\r\n  <transition name=\"slide-fade\">\r\n    <aside\r\n      v-show=\"isSidebarOpen\"\r\n      class=\"fixed top-0 right-0 w-64 h-full bg-white dark:bg-gray-800 shadow-lg z-50 md:hidden px-4 py-6 space-y-4 overflow-y-auto\"\r\n      role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"sidebar-title\"\r\n    >\r\n      <div class=\"flex items-center justify-between mb-4\">\r\n        <span id=\"sidebar-title\" class=\"text-lg font-bold text-olive-green dark:text-yellow-400\">القائمة</span>\r\n        <!-- إضافة ref لزر إغلاق القائمة الجانبية -->\r\n        <button @click=\"closeSidebar\" ref=\"sidebarCloseButtonRef\" class=\"text-brown-dark dark:text-gray-300 hover:text-olive-green dark:hover:text-yellow-400\" aria-label=\"إغلاق القائمة\">\r\n          <svg class=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" aria-hidden=\"true\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n\r\n      <!-- استخدام v-for لعرض الروابط -->\r\n      <ul class=\"space-y-3 text-brown-dark dark:text-gray-300\">\r\n        <li v-for=\"link in navLinks\" :key=\"link.to\">\r\n          <NuxtLink :to=\"link.to\" @click=\"closeSidebar\" class=\"block hover:text-olive-green dark:hover:text-yellow-400\">{{ link.text }}</NuxtLink>\r\n        </li>\r\n         <li v-if=\"isAdmin\">\r\n           <NuxtLink to=\"/admin\" @click=\"closeSidebar\" class=\"block text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 font-semibold admin-link\">\r\n             لوحة التحكم\r\n           </NuxtLink>\r\n         </li>\r\n      </ul>\r\n\r\n      <div class=\"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700\">\r\n        <ClientOnly>\r\n          <div v-if=\"isLoggedIn\">\r\n            <NuxtLink to=\"/profile\" @click=\"closeSidebar\" class=\"block mb-3 text-brown-dark dark:text-gray-300 hover:text-olive-green dark:hover:text-yellow-400\">الملف الشخصي</NuxtLink>\r\n            <button @click=\"logoutAndClose\" class=\"w-full text-right text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300\">تسجيل الخروج</button>\r\n          </div>\r\n          <div v-else class=\"flex gap-x-2\">\r\n            <NuxtLink to=\"/login\" @click=\"closeSidebar\" class=\"text-sm bg-olive-green text-white px-3 py-1.5 rounded-md hover:bg-opacity-80\">دخول</NuxtLink>\r\n            <NuxtLink to=\"/signup\" @click=\"closeSidebar\" class=\"text-sm border border-olive-green text-olive-green dark:border-yellow-400 dark:text-yellow-400 px-3 py-1.5 rounded-md hover:bg-olive-green hover:text-white dark:hover:bg-yellow-400 dark:hover:text-gray-900\">إنشاء حساب</NuxtLink>\r\n          </div>\r\n        </ClientOnly>\r\n      </div>\r\n    </aside>\r\n  </transition>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, onMounted, onBeforeUnmount, watch, nextTick } from 'vue'; // استيراد watch و nextTick\r\nimport { useUserStore } from '~/stores/user';\r\nimport { storeToRefs } from 'pinia';\r\nimport { useColorMode } from '#imports';\r\n\r\nconst userStore = useUserStore();\r\nconst { isLoggedIn, displayName, userAvatar, isAdmin } = storeToRefs(userStore);\r\n\r\n// --- حالة الواجهة ---\r\nconst isDropdownOpen = ref(false);\r\nconst isSidebarOpen = ref(false);\r\nconst unreadNotifications = ref(0); // سيتم تحديثها من fetchNotifications\r\n\r\n// --- Refs للعناصر لإدارة التركيز والـ dropdown ---\r\nconst dropdownRef = ref<HTMLDivElement | null>(null); // Ref لحاوية القائمة المنسدلة\r\nconst userMenuButtonRef = ref<HTMLButtonElement | null>(null); // Ref لزر فتح القائمة المنسدلة\r\nconst firstDropdownItemRef = ref<HTMLElement | null>(null); // Ref لأول عنصر في القائمة المنسدلة\r\nconst mobileMenuButtonRef = ref<HTMLButtonElement | null>(null); // Ref لزر فتح القائمة الجانبية\r\nconst sidebarCloseButtonRef = ref<HTMLButtonElement | null>(null); // Ref لزر إغلاق القائمة الجانبية\r\nconst previouslyFocusedElement = ref<HTMLElement | null>(null); // لتخزين العنصر المركز عليه قبل فتح قائمة\r\n\r\n// --- تعريف روابط التنقل مرة واحدة ---\r\nconst navLinks = ref([\r\n  { text: 'الرئيسية', to: '/' },\r\n  { text: 'الدروس', to: '/lessons' },\r\n  { text: 'الكتب', to: '/books' },\r\n  { text: 'الدراسة', to: '/study' },\r\n  { text: 'اسأل الشيخ', to: '/ask' },\r\n  { text: 'عن الشيخ', to: '/about' },\r\n]);\r\n\r\n// --- منطق الوضع الداكن ---\r\nconst isDark = ref(false);\r\nconst colorMode = useColorMode();\r\n\r\nonMounted(() => {\r\n  isDark.value = colorMode.value === 'dark';\r\n  window.addEventListener('storage', handleStorageChange);\r\n  document.addEventListener('click', handleClickOutside);\r\n  fetchNotifications(); // جلب الإشعارات عند تحميل المكون\r\n});\r\n\r\nonBeforeUnmount(() => {\r\n   window.removeEventListener('storage', handleStorageChange);\r\n   document.removeEventListener('click', handleClickOutside);\r\n});\r\n\r\nconst toggleTheme = () => {\r\n  const newPreference = isDark.value ? 'light' : 'dark';\r\n  colorMode.preference = newPreference;\r\n  isDark.value = newPreference === 'dark';\r\n}\r\n\r\nfunction handleStorageChange(event: StorageEvent) {\r\n  if (event.key === 'nuxt-color-mode') {\r\n    const newMode = event.newValue as 'light' | 'dark' | 'system' | null;\r\n    if (newMode) {\r\n        isDark.value = newMode === 'dark';\r\n        if (colorMode.value !== newMode) {\r\n           colorMode.preference = newMode; // مزامنة الحالة الحالية إذا تغيرت من تبويب آخر\r\n        }\r\n    }\r\n  }\r\n}\r\n// --- نهاية منطق الوضع الداكن ---\r\n\r\n// --- وظائف فتح/إغلاق القوائم مع إدارة التركيز ---\r\nconst toggleDropdown = async () => {\r\n  if (!isDropdownOpen.value) {\r\n    previouslyFocusedElement.value = document.activeElement as HTMLElement;\r\n    isDropdownOpen.value = true;\r\n    await nextTick(); // انتظر حتى يتم رسم القائمة\r\n    // حاول التركيز على أول عنصر تم تعيين ref له\r\n    const firstItem = dropdownRef.value?.querySelector<HTMLElement>('[ref=\"firstDropdownItemRef\"]');\r\n    if (firstItem) {\r\n        firstItem.focus();\r\n    } else {\r\n        // إذا لم يتم العثور على العنصر المحدد بـ ref، ركز على القائمة نفسها للسماح بالتنقل\r\n        (dropdownRef.value?.querySelector('[role=\"menuitem\"]') as HTMLElement)?.focus();\r\n    }\r\n  } else {\r\n    closeDropdown(); // الإغلاق سيعيد التركيز\r\n  }\r\n};\r\n\r\nconst closeDropdown = (refocus = true) => {\r\n  if (isDropdownOpen.value) {\r\n      isDropdownOpen.value = false;\r\n      if (refocus && previouslyFocusedElement.value && document.body.contains(previouslyFocusedElement.value)) {\r\n          previouslyFocusedElement.value.focus();\r\n      }\r\n  }\r\n};\r\n\r\nconst toggleMobileMenu = async () => {\r\n  if (!isSidebarOpen.value) {\r\n    previouslyFocusedElement.value = document.activeElement as HTMLElement;\r\n    isSidebarOpen.value = true;\r\n    await nextTick();\r\n    sidebarCloseButtonRef.value?.focus(); // ركز على زر الإغلاق\r\n  } else {\r\n    closeSidebar(); // الإغلاق سيعيد التركيز\r\n  }\r\n};\r\n\r\nconst closeSidebar = (refocus = true) => {\r\n  if (isSidebarOpen.value) {\r\n      isSidebarOpen.value = false;\r\n      if (refocus && previouslyFocusedElement.value && document.body.contains(previouslyFocusedElement.value)) {\r\n          previouslyFocusedElement.value.focus();\r\n      }\r\n  }\r\n};\r\n// --- نهاية وظائف القوائم ---\r\n\r\n// --- إغلاق القائمة المنسدلة عند النقر خارجها ---\r\nconst handleClickOutside = (e: MouseEvent) => {\r\n  // أغلق القائمة المنسدلة فقط إذا كانت مفتوحة والنقرة خارجها\r\n  if (isDropdownOpen.value && dropdownRef.value && !dropdownRef.value.contains(e.target as Node)) {\r\n    // لا نعيد التركيز هنا لأن المستخدم نقر في مكان آخر\r\n    closeDropdown(false);\r\n  }\r\n  // لا حاجة لإغلاق القائمة الجانبية هنا لأن الخلفية تقوم بذلك وتعيد التركيز\r\n}\r\n\r\n// --- جلب الإشعارات (مثال وهمي) ---\r\nasync function fetchNotifications() {\r\n  if (isLoggedIn.value) {\r\n    console.log(\"Fetching notifications...\");\r\n    // استبدل هذا باستدعاء API حقيقي\r\n    await new Promise(resolve => setTimeout(resolve, 500)); // محاكاة تأخير الشبكة\r\n    try {\r\n      // const count = await getNotificationCountAPI();\r\n      // unreadNotifications.value = count;\r\n      unreadNotifications.value = 3; // قيمة وهمية للتجربة\r\n      console.log(\"Notifications fetched:\", unreadNotifications.value);\r\n    } catch (error) {\r\n      console.error(\"Failed to fetch notifications:\", error);\r\n      unreadNotifications.value = 0;\r\n    }\r\n  } else {\r\n    unreadNotifications.value = 0; // لا إشعارات للمستخدم غير المسجل\r\n  }\r\n}\r\n\r\n// --- مراقبة حالة تسجيل الدخول لجلب/مسح الإشعارات ---\r\nwatch(isLoggedIn, (newValue, oldValue) => {\r\n   // جلب الإشعارات فقط عند تسجيل الدخول (وليس عند التحميل الأولي إذا كان مسجلاً بالفعل)\r\n   if (newValue === true && oldValue === false) {\r\n     fetchNotifications();\r\n   } else if (newValue === false) {\r\n     unreadNotifications.value = 0; // مسح الإشعارات عند تسجيل الخروج\r\n     closeDropdown(false); // أغلق القائمة المنسدلة إذا كانت مفتوحة\r\n     closeSidebar(false); // أغلق القائمة الجانبية إذا كانت مفتوحة\r\n   }\r\n});\r\n\r\n// --- تسجيل الخروج ---\r\nconst logoutAndClose = async () => {\r\n  const wasDropdownOpen = isDropdownOpen.value;\r\n  const wasSidebarOpen = isSidebarOpen.value;\r\n\r\n  closeDropdown(false); // أغلق القائمة المنسدلة دون إعادة التركيز فوراً\r\n  closeSidebar(false); // أغلق القائمة الجانبية دون إعادة التركيز فوراً\r\n\r\n  try {\r\n    await userStore.logout();\r\n    // بعد تسجيل الخروج الناجح، قد يتم توجيه المستخدم أو تحديث الواجهة\r\n    // لا حاجة لإعادة التركيز هنا لأن الواجهة قد تتغير بالكامل\r\n    // يمكنك إضافة رسالة نجاح إذا أردت\r\n  } catch (error) {\r\n    console.error(\"Logout failed:\", error);\r\n    // أظهر رسالة خطأ للمستخدم\r\n    alert('حدث خطأ أثناء تسجيل الخروج. يرجى المحاولة مرة أخرى.');\r\n    // أعد فتح القوائم إذا كانت مفتوحة قبل المحاولة الفاشلة (اختياري)\r\n    // if (wasDropdownOpen) isDropdownOpen.value = true;\r\n    // if (wasSidebarOpen) isSidebarOpen.value = true;\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n<style scoped>\r\n/* تحسين active class ليشمل الوضع الداكن ويستثني رابط الأدمن إذا أردت */\r\n.router-link-exact-active:not(.admin-link) {\r\n  @apply text-olive-green dark:text-yellow-400 font-semibold;\r\n}\r\n/* تنسيق خاص لرابط الأدمن النشط */\r\n.admin-link.router-link-exact-active {\r\n   @apply text-red-700 dark:text-red-500 font-bold;\r\n}\r\n\r\n/* Transition للقائمة المنسدلة */\r\n.dropdown-fade-enter-active,\r\n.dropdown-fade-leave-active {\r\n  transition: opacity 0.2s ease-out, transform 0.2s ease-out;\r\n}\r\n.dropdown-fade-enter-from,\r\n.dropdown-fade-leave-to {\r\n  opacity: 0;\r\n  transform: translateY(-10px);\r\n}\r\n\r\n/* Transition للقائمة الجانبية */\r\n.slide-fade-enter-active,\r\n.slide-fade-leave-active {\r\n  transition: transform 0.3s ease-in-out;\r\n}\r\n/* اتجاه الانزلاق لـ RTL (من اليمين إلى اليسار) */\r\nhtml[dir=\"rtl\"] .slide-fade-enter-from,\r\nhtml[dir=\"rtl\"] .slide-fade-leave-to {\r\n   transform: translateX(100%); /* تنزلق من اليمين */\r\n}\r\n/* اتجاه الانزلاق الافتراضي لـ LTR (من اليسار إلى اليمين) */\r\nhtml:not([dir=\"rtl\"]) .slide-fade-enter-from,\r\nhtml:not([dir=\"rtl\"]) .slide-fade-leave-to {\r\n   transform: translateX(-100%); /* تنزلق من اليسار - قد تحتاج لتعديل حسب التصميم */\r\n}\r\n\r\n/* يمكنك إضافة كلاسات مجمعة هنا باستخدام @apply إذا أردت */\r\n/* مثال:\r\n.nav-link-base {\r\n  @apply transition-colors duration-200;\r\n}\r\n.nav-link-hover {\r\n  @apply hover:text-olive-green dark:hover:text-yellow-400;\r\n}\r\n*/\r\n</style>"],"names":[],"mappings":";;;;;;;;;;;AAkLA,UAAM,YAAY,aAAa;AAC/B,UAAM,EAAE,YAAY,aAAa,YAAY,QAAQ,IAAI,YAAY,SAAS;AAGxE,UAAA,iBAAiB,IAAI,KAAK;AAC1B,UAAA,gBAAgB,IAAI,KAAK;AACzB,UAAA,sBAAsB,IAAI,CAAC;AAGb,QAA2B,IAAI;AACzB,QAA8B,IAAI;AAC/B,QAAwB,IAAI;AAC7B,QAA8B,IAAI;AAChC,QAA8B,IAAI;AAC1D,UAAA,2BAA2B,IAAwB,IAAI;AAG7D,UAAM,WAAW,IAAI;AAAA,MACnB,EAAE,MAAM,YAAY,IAAI,IAAI;AAAA,MAC5B,EAAE,MAAM,UAAU,IAAI,WAAW;AAAA,MACjC,EAAE,MAAM,SAAS,IAAI,SAAS;AAAA,MAC9B,EAAE,MAAM,WAAW,IAAI,SAAS;AAAA,MAChC,EAAE,MAAM,cAAc,IAAI,OAAO;AAAA,MACjC,EAAE,MAAM,YAAY,IAAI,SAAS;AAAA,IAAA,CAClC;AAGK,UAAA,SAAS,IAAI,KAAK;AACN,iBAAa;AAoDzB,UAAA,gBAAgB,CAAC,UAAU,SAAS;AACxC,UAAI,eAAe,OAAO;AACtB,uBAAe,QAAQ;AACnB,YAAA,WAAW,yBAAyB,SAAS,SAAS,KAAK,SAAS,yBAAyB,KAAK,GAAG;AACrG,mCAAyB,MAAM,MAAM;AAAA,QAAA;AAAA,MACzC;AAAA,IAEN;AAaM,UAAA,eAAe,CAAC,UAAU,SAAS;AACvC,UAAI,cAAc,OAAO;AACrB,sBAAc,QAAQ;AAClB,YAAA,WAAW,yBAAyB,SAAS,SAAS,KAAK,SAAS,yBAAyB,KAAK,GAAG;AACrG,mCAAyB,MAAM,MAAM;AAAA,QAAA;AAAA,MACzC;AAAA,IAEN;AAcA,mBAAe,qBAAqB;AAClC,UAAI,WAAW,OAAO;AACpB,gBAAQ,IAAI,2BAA2B;AAEvC,cAAM,IAAI,QAAQ,CAAA,YAAW,WAAW,SAAS,GAAG,CAAC;AACjD,YAAA;AAGF,8BAAoB,QAAQ;AACpB,kBAAA,IAAI,0BAA0B,oBAAoB,KAAK;AAAA,iBACxD,OAAO;AACN,kBAAA,MAAM,kCAAkC,KAAK;AACrD,8BAAoB,QAAQ;AAAA,QAAA;AAAA,MAC9B,OACK;AACL,4BAAoB,QAAQ;AAAA,MAAA;AAAA,IAC9B;AAII,UAAA,YAAY,CAAC,UAAU,aAAa;AAEnC,UAAA,aAAa,QAAQ,aAAa,OAAO;AACxB,2BAAA;AAAA,MAAA,WACV,aAAa,OAAO;AAC7B,4BAAoB,QAAQ;AAC5B,sBAAc,KAAK;AACnB,qBAAa,KAAK;AAAA,MAAA;AAAA,IACpB,CACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}