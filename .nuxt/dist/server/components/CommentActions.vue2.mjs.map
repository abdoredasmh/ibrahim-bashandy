{"version":3,"file":"CommentActions.vue2.mjs","sources":["../../../../components/CommentActions.vue"],"sourcesContent":["<template>\r\n  <div v-if=\"canShowActions\" class=\"relative\">\r\n    <button\r\n      @click.stop=\"toggleDropdown\"\r\n      :aria-label=\"`إجراءات ${itemType === 'comment' ? 'التعليق' : 'الرد'}`\"\r\n      aria-haspopup=\"true\"\r\n      :aria-expanded=\"isOpen.toString()\"\r\n      class=\"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-white focus:outline-none p-1 -m-1 rounded-full\"\r\n    >\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n        <path d=\"M10 6a1.5 1.5 0 110-3 1.5 1.5 0 010 3zM10 11.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zM10 17a1.5 1.5 0 110-3 1.5 1.5 0 010 3z\" />\r\n      </svg>\r\n    </button>\r\n\r\n    <!-- القائمة المنسدلة -->\r\n    <transition\r\n      enter-active-class=\"transition ease-out duration-100\"\r\n      enter-from-class=\"transform opacity-0 scale-95\"\r\n      enter-to-class=\"transform opacity-100 scale-100\"\r\n      leave-active-class=\"transition ease-in duration-75\"\r\n      leave-from-class=\"transform opacity-100 scale-100\"\r\n      leave-to-class=\"transform opacity-0 scale-95\"\r\n    >\r\n      <div\r\n        v-if=\"isOpen\"\r\n        ref=\"dropdownMenuRef\"\r\n        class=\"origin-top-right rtl:origin-top-left absolute right-0 rtl:right-auto rtl:left-0 mt-2 w-32 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none dark:bg-gray-800 dark:ring-gray-700 z-20\"\r\n      >\r\n        <div class=\"py-1\" role=\"menu\" aria-orientation=\"vertical\">\r\n          <!-- زر الرد (فقط للتعليقات الرئيسية، وللمستخدم المسجل وغير الموقوف) -->\r\n          <button\r\n            v-if=\"itemType === 'comment' && user\"\r\n            @click=\"emitAndClose('reply')\"\r\n            :disabled=\"isCommentingSuspended\" \r\n            class=\"flex items-center gap-2 w-full text-right rtl:text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            role=\"menuitem\"\r\n             :title=\"isCommentingSuspended ? 'التعليق موقوف حاليًا' : 'الرد على هذا التعليق'\"\r\n          >\r\n             <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n               <path fill-rule=\"evenodd\" d=\"M7.707 3.293a1 1 0 010 1.414L5.414 7H11a7 7 0 017 7v2a1 1 0 11-2 0v-2a5 5 0 00-5-5H5.414l2.293 2.293a1 1 0 11-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z\" clip-rule=\"evenodd\" />\r\n            </svg>\r\n            <span>رد</span>\r\n          </button>\r\n\r\n          <!-- أزرار التعديل والحذف (فقط للمالك) -->\r\n          <template v-if=\"isOwner\">\r\n            <button\r\n              @click=\"emitAndClose('edit')\"\r\n              class=\"flex items-center gap-2 w-full text-right rtl:text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900 dark:text-gray-200 dark:hover:bg-gray-700\"\r\n              role=\"menuitem\"\r\n            >\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path d=\"M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z\" /><path fill-rule=\"evenodd\" d=\"M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z\" clip-rule=\"evenodd\" /></svg>\r\n              <span>تعديل</span>\r\n            </button>\r\n            <button\r\n              @click=\"emitAndClose('delete')\"\r\n              class=\"flex items-center gap-2 w-full text-right rtl:text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 hover:text-red-700 dark:text-red-400 dark:hover:bg-red-900/50 dark:hover:text-red-300\"\r\n              role=\"menuitem\"\r\n            >\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fill-rule=\"evenodd\" d=\"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z\" clip-rule=\"evenodd\" /></svg>\r\n              <span>حذف</span>\r\n            </button>\r\n          </template>\r\n        </div>\r\n      </div>\r\n    </transition>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, onMounted, onUnmounted, watch, type PropType } from 'vue' // Import PropType\r\nimport type { Database } from '~/types/database.types' // تأكد من المسار الصحيح\r\n\r\ntype CommentOrReply = Database['public']['Tables']['comments']['Row']\r\n\r\nconst props = defineProps({\r\n  item: {\r\n      type: Object as PropType<CommentOrReply>,\r\n      required: true\r\n  },\r\n  itemType: {\r\n      type: String as PropType<'comment' | 'reply'>,\r\n      required: true\r\n  },\r\n  isCommentingSuspended: { // Add the new prop\r\n      type: Boolean,\r\n      default: false\r\n  }\r\n})\r\n\r\nconst emit = defineEmits(['edit', 'delete', 'reply'])\r\n\r\nconst user = useSupabaseUser()\r\nconst isOpen = ref(false)\r\nconst dropdownMenuRef = ref<HTMLElement | null>(null)\r\n\r\nconst isOwner = computed(() => user.value && user.value.id === props.item.user_id)\r\n\r\n// تحديد ما إذا كان يجب إظهار زر النقاط الثلاث أصلاً\r\nconst canShowActions = computed(() => {\r\n    if (!user.value && !isOwner.value) return false;\r\n    if (isOwner.value) return true;\r\n    // Show only if user is logged in AND it's a comment (for reply button) AND commenting is NOT suspended\r\n    if (user.value && props.itemType === 'comment' && !props.isCommentingSuspended) {\r\n        return true;\r\n    }\r\n    // Otherwise hide\r\n    return false;\r\n})\r\n\r\nconst toggleDropdown = () => { isOpen.value = !isOpen.value }\r\n\r\nconst handleClickOutside = (event: MouseEvent) => { /* ... as before ... */\r\n  if (dropdownMenuRef.value && !dropdownMenuRef.value.contains(event.target as Node)) {\r\n    const toggleButton = dropdownMenuRef.value.parentElement?.querySelector('button');\r\n    if (!toggleButton || !toggleButton.contains(event.target as Node)) { isOpen.value = false }\r\n  }\r\n}\r\n\r\nconst handleEscapeKey = (event: KeyboardEvent) => { /* ... as before ... */\r\n  if (event.key === 'Escape') { isOpen.value = false; }\r\n};\r\n\r\nwatch(isOpen, (newValue) => { /* ... as before ... */\r\n  if (newValue) { document.addEventListener('click', handleClickOutside, true); document.addEventListener('keydown', handleEscapeKey); }\r\n  else { document.removeEventListener('click', handleClickOutside, true); document.removeEventListener('keydown', handleEscapeKey); }\r\n});\r\n\r\nonUnmounted(() => { /* ... as before ... */\r\n  document.removeEventListener('click', handleClickOutside, true); document.removeEventListener('keydown', handleEscapeKey);\r\n})\r\n\r\nconst emitAndClose = (action: 'edit' | 'delete' | 'reply') => { /* ... as before ... */\r\n  // Prevent emitting reply if suspended (extra safety)\r\n  if (action === 'reply' && props.isCommentingSuspended) {\r\n      isOpen.value = false;\r\n      return;\r\n  }\r\n  emit(action); isOpen.value = false\r\n}\r\n</script>"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AA2EA,UAAM,QAAQ;AAiBd,UAAM,OAAO,gBAAgB;AACvB,UAAA,SAAS,IAAI,KAAK;AAClB,UAAA,kBAAkB,IAAwB,IAAI;AAE9C,UAAA,UAAU,SAAS,MAAM,KAAK,SAAS,KAAK,MAAM,OAAO,MAAM,KAAK,OAAO;AAG3E,UAAA,iBAAiB,SAAS,MAAM;AAClC,UAAI,CAAC,KAAK,SAAS,CAAC,QAAQ,MAAc,QAAA;AACtC,UAAA,QAAQ,MAAc,QAAA;AAE1B,UAAI,KAAK,SAAS,MAAM,aAAa,aAAa,CAAC,MAAM,uBAAuB;AACrE,eAAA;AAAA,MAAA;AAGJ,aAAA;AAAA,IAAA,CACV;AAIK,UAAA,qBAAqB,CAAC,UAAsB;;AAC5C,UAAA,gBAAgB,SAAS,CAAC,gBAAgB,MAAM,SAAS,MAAM,MAAc,GAAG;AAClF,cAAM,gBAAe,qBAAgB,MAAM,kBAAtB,mBAAqC,cAAc;AACxE,YAAI,CAAC,gBAAgB,CAAC,aAAa,SAAS,MAAM,MAAc,GAAG;AAAE,iBAAO,QAAQ;AAAA,QAAA;AAAA,MAAM;AAAA,IAE9F;AAEM,UAAA,kBAAkB,CAAC,UAAyB;AAC5C,UAAA,MAAM,QAAQ,UAAU;AAAE,eAAO,QAAQ;AAAA,MAAA;AAAA,IAC/C;AAEM,UAAA,QAAQ,CAAC,aAAa;AAC1B,UAAI,UAAU;AAAW,QAAA,SAAA,iBAAiB,SAAS,oBAAoB,IAAI;AAAY,QAAA,SAAA,iBAAiB,WAAW,eAAe;AAAA,MAAA,OAC7H;AAAW,QAAA,SAAA,oBAAoB,SAAS,oBAAoB,IAAI;AAAY,QAAA,SAAA,oBAAoB,WAAW,eAAe;AAAA,MAAA;AAAA,IAAG,CACnI;;;;;;;;;;;;;;;;;;;;;;;;;;;"}