{"file":"AdminUserActions.vue2.mjs","mappings":";;;;;;;;;;;;;;;;;;;;;AA0FA,UAAM,QAAQ;AAkBG,sBAA4B;AAGvC,UAAA,gBAAgB,IAAmD,IAAI;AAC7E,UAAM,cAAc,IAAI,MAAM,YAAY,IAAI;AAGxC,UAAA,cAAc,IAAI,KAAK;AACvB,UAAA,qBAAqB,IAA+B,IAAI;AAKxD,UAAA,uBAAuB,SAAS,MAAM;AACxC,UAAI,CAAC,MAAM,YAAY,wBAAgC,QAAA;AACnD,UAAA;AAAE,eAAO,IAAI,KAAK,MAAM,YAAY,uBAAuB,wBAAQ,KAAK;AAAA,MAAA,QACtE;AAAS,eAAA;AAAA,MAAA;AAAA,IAAO,CACzB;AAGD,UAAM,MAAM,MAAM,aAAa,CAAC,eAAe;AAC3C,kBAAY,QAAQ,WAAW;AAAA,IAAA,GAChC,EAAE,MAAM,MAAM;AA2FjB,UAAM,yBAAyB,MAAM;AACX;AAAA,IAO1B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":[],"sources":["../../../../../components/admin/AdminUserActions.vue"],"sourcesContent":["<template>\r\n  <div class=\"p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg border dark:border-gray-700 flex flex-wrap items-center justify-start gap-3\">\r\n    <!-- Change Role Dropdown -->\r\n    <div class=\"flex items-center gap-2\">\r\n        <label :for=\"`role-select-${userProfile.id}`\" class=\"text-sm font-medium text-gray-700 dark:text-gray-300\">تغيير الدور:</label>\r\n        <select\r\n            :id=\"`role-select-${userProfile.id}`\"\r\n            :value=\"currentRole\"\r\n            @change=\"updateUserRole($event.target.value as 'user' | 'admin')\"\r\n            :disabled=\"isLoading || pendingAction === 'role'\"\r\n            class=\"text-sm rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-indigo-500 focus:border-indigo-500 disabled:opacity-70\"\r\n            >\r\n            <option value=\"user\">مستخدم</option>\r\n            <option value=\"admin\">مشرف</option>\r\n        </select>\r\n         <LoadingSpinner v-if=\"pendingAction === 'role'\" class=\"w-4 h-4 inline-block ml-1 animate-spin text-indigo-500\"/>\r\n    </div>\r\n\r\n    <!-- Ban/Unban Button -->\r\n    <button\r\n        v-if=\"!userProfile.is_banned\"\r\n        @click=\"confirmAction('ban')\"\r\n        :disabled=\"isLoading || pendingAction === 'ban'\"\r\n        class=\"px-3 py-1.5 text-sm rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 flex items-center gap-1\"\r\n    >\r\n        <LoadingSpinner v-if=\"pendingAction === 'ban'\" class=\"w-4 h-4\"/>\r\n        <svg v-else xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" fill=\"currentColor\" class=\"w-4 h-4\"><path fill-rule=\"evenodd\" d=\"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14Zm3.84-10.73a.75.75 0 1 0-1.18-.94l-1.66 2.08-.94-1.18a.75.75 0 1 0-.94 1.18l1.5 1.875a.75.75 0 0 0 1.18 0l2-2.5Z\" clip-rule=\"evenodd\" /></svg> -->\r\n         <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" fill=\"currentColor\" class=\"w-4 h-4\"><path fill-rule=\"evenodd\" d=\"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14ZM4.75 7.25A.75.75 0 0 1 5.5 8h5a.75.75 0 0 1 0 1.5h-5A.75.75 0 0 1 4 8.75a.75.75 0 0 1 .75-.75Z\" clip-rule=\"evenodd\" /></svg>\r\n        <span>حظر</span>\r\n    </button>\r\n     <button\r\n        v-else\r\n        @click=\"confirmAction('unban')\"\r\n        :disabled=\"isLoading || pendingAction === 'unban'\"\r\n        class=\"px-3 py-1.5 text-sm rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 flex items-center gap-1\"\r\n    >\r\n        <LoadingSpinner v-if=\"pendingAction === 'unban'\" class=\"w-4 h-4\"/>\r\n         <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" fill=\"currentColor\" class=\"w-4 h-4\"><path fill-rule=\"evenodd\" d=\"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14Zm3.84-10.73a.75.75 0 1 0-1.18-.94l-1.66 2.08-.94-1.18a.75.75 0 1 0-.94 1.18l1.5 1.875a.75.75 0 0 0 1.18 0l2-2.5Z\" clip-rule=\"evenodd\" /></svg>\r\n        <span>إلغاء الحظر</span>\r\n    </button>\r\n\r\n    <!-- Suspend/Unsuspend Button -->\r\n     <button\r\n        v-if=\"!isCurrentlySuspended\"\r\n        @click=\"emit('suspend-comments')\"\r\n        :disabled=\"isLoading\"\r\n        class=\"px-3 py-1.5 text-sm rounded-md text-yellow-800 dark:text-yellow-200 bg-yellow-100 dark:bg-yellow-900/50 hover:bg-yellow-200 dark:hover:bg-yellow-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 disabled:opacity-50 flex items-center gap-1\"\r\n    >\r\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" fill=\"currentColor\" class=\"w-4 h-4\"><path fill-rule=\"evenodd\" d=\"M4.5 6.75a.75.75 0 0 0 0 1.5h7a.75.75 0 0 0 0-1.5h-7Zm0 3.5a.75.75 0 0 0 0 1.5h4a.75.75 0 0 0 0-1.5h-4Z\" clip-rule=\"evenodd\" /></svg>\r\n        <span>إيقاف التعليق</span>\r\n    </button>\r\n     <button\r\n        v-else\r\n        @click=\"confirmAction('unsuspend')\"\r\n        :disabled=\"isLoading || pendingAction === 'unsuspend'\"\r\n        class=\"px-3 py-1.5 text-sm rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 flex items-center gap-1\"\r\n    >\r\n        <LoadingSpinner v-if=\"pendingAction === 'unsuspend'\" class=\"w-4 h-4\"/>\r\n         <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" fill=\"currentColor\" class=\"w-4 h-4\"><path fill-rule=\"evenodd\" d=\"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14Zm3.84-10.73a.75.75 0 1 0-1.18-.94l-1.66 2.08-.94-1.18a.75.75 0 1 0-.94 1.18l1.5 1.875a.75.75 0 0 0 1.18 0l2-2.5Z\" clip-rule=\"evenodd\" /></svg>\r\n        <span>إلغاء إيقاف التعليق</span>\r\n    </button>\r\n\r\n     <!-- Send Message Button -->\r\n      <button\r\n        @click=\"emit('send-message')\"\r\n        :disabled=\"isLoading\"\r\n        class=\"px-3 py-1.5 text-sm rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 flex items-center gap-1\"\r\n    >\r\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" fill=\"currentColor\" class=\"w-4 h-4\"><path d=\"M2.5 3A1.5 1.5 0 0 0 1 4.5v7A1.5 1.5 0 0 0 2.5 13h11a1.5 1.5 0 0 0 1.5-1.5v-7A1.5 1.5 0 0 0 13.5 3h-11ZM2 4.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 .5.5v1.145l-5.426 3.05a1.75 1.75 0 0 1-1.93.066L2 5.96V4.5Zm11.5 8h-11a.5.5 0 0 1-.5-.5v-4.318l3.924 2.207a3.25 3.25 0 0 0 3.552-.122L14 7.764V11.5a.5.5 0 0 1-.5.5Z\" /></svg>\r\n        <span>إرسال رسالة</span>\r\n    </button>\r\n\r\n     <!-- Confirmation Modal -->\r\n     <LazyAdminConfirmationModal v-model=\"showConfirm\" :config=\"confirmModalConfig\" @confirm=\"executeConfirmedAction\" />\r\n\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, watch, type PropType } from 'vue';\r\nimport type { Database, Tables } from '~/types/database.types';\r\nimport LoadingSpinner from '~/components/LoadingSpinner.vue';\r\n// Lazy load the confirmation modal\r\nconst ConfirmationModal = resolveComponent('LazyAdminConfirmationModal');\r\nimport { type ConfirmationConfig } from '~/components/admin/ConfirmationModal.vue';\r\nimport { useSupabaseClient } from '#imports';\r\n\r\n// Define the user profile type expected by the component\r\ntype ProfileProp = Tables<'profiles'>;\r\n\r\nconst props = defineProps({\r\n  userProfile: {\r\n    type: Object as PropType<ProfileProp>,\r\n    required: true,\r\n  },\r\n   isLoading: { // Prop to disable buttons while parent page is loading\r\n        type: Boolean,\r\n        default: false,\r\n    }\r\n});\r\n\r\nconst emit = defineEmits<{\r\n  (e: 'action-start', actionType: 'role' | 'ban' | 'unban' | 'unsuspend'): void;\r\n  (e: 'action-complete', success: boolean, message: string, updatedProfile?: Partial<Profile>): void;\r\n  (e: 'send-message'): void;\r\n  (e: 'suspend-comments'): void;\r\n}>();\r\n\r\nconst supabase = useSupabaseClient<Database>();\r\n\r\n// Internal state\r\nconst pendingAction = ref<'role' | 'ban' | 'unban' | 'unsuspend' | null>(null);\r\nconst currentRole = ref(props.userProfile.role); // Local state for dropdown\r\n\r\n// Confirmation Modal State\r\nconst showConfirm = ref(false);\r\nconst confirmModalConfig = ref<ConfirmationConfig | null>(null);\r\nlet actionToConfirm: { type: 'ban' | 'unban' | 'unsuspend' } | null = null;\r\n\r\n\r\n// Computed property to check suspension status\r\nconst isCurrentlySuspended = computed(() => {\r\n    if (!props.userProfile.comment_suspended_until) return false;\r\n    try { return new Date(props.userProfile.comment_suspended_until) > new Date(); }\r\n    catch { return false; }\r\n});\r\n\r\n// Watch for external changes to the user profile prop\r\nwatch(() => props.userProfile, (newProfile) => {\r\n    currentRole.value = newProfile.role; // Update local role if prop changes\r\n}, { deep: true });\r\n\r\n\r\n// --- Action Functions ---\r\n\r\nconst updateUserRole = async (newRole: 'user' | 'admin') => {\r\n    if (pendingAction.value || props.userProfile.role === newRole) return;\r\n    pendingAction.value = 'role';\r\n    emit('action-start', 'role'); // Inform parent action started\r\n\r\n    try {\r\n        const { error } = await supabase\r\n            .from('profiles')\r\n            .update({ role: newRole, updated_at: new Date().toISOString() })\r\n            .eq('id', props.userProfile.id);\r\n        if (error) throw error;\r\n\r\n        // Update local state after successful DB update\r\n        currentRole.value = newRole;\r\n        emit('action-complete', true, `تم تغيير دور المستخدم إلى ${newRole}.`, { role: newRole });\r\n\r\n    } catch (err: any) {\r\n        console.error(\"Error updating role:\", err);\r\n         // Revert local state on error\r\n         currentRole.value = props.userProfile.role;\r\n        emit('action-complete', false, `فشل تغيير دور المستخدم: ${err.message}`);\r\n    } finally {\r\n        pendingAction.value = null;\r\n    }\r\n};\r\n\r\nconst toggleBanStatus = async (ban: boolean) => {\r\n    const actionType = ban ? 'ban' : 'unban';\r\n    if (pendingAction.value) return;\r\n    pendingAction.value = actionType;\r\n    emit('action-start', actionType);\r\n\r\n    try {\r\n        const { error } = await supabase\r\n            .from('profiles')\r\n            .update({ is_banned: ban, updated_at: new Date().toISOString() })\r\n            .eq('id', props.userProfile.id);\r\n        if (error) throw error;\r\n\r\n        const message = ban ? `تم حظر المستخدم بنجاح.` : `تم إلغاء حظر المستخدم بنجاح.`;\r\n        emit('action-complete', true, message, { is_banned: ban });\r\n\r\n    } catch (err: any) {\r\n        console.error(\"Error toggling ban status:\", err);\r\n        emit('action-complete', false, `فشل تحديث حالة الحظر: ${err.message}`);\r\n    } finally {\r\n        pendingAction.value = null;\r\n    }\r\n};\r\n\r\nconst removeCommentSuspension = async () => {\r\n     if (pendingAction.value) return;\r\n     pendingAction.value = 'unsuspend';\r\n     emit('action-start', 'unsuspend');\r\n\r\n     try {\r\n         const { error } = await supabase\r\n             .from('profiles')\r\n             .update({ comment_suspended_until: null, updated_at: new Date().toISOString() })\r\n             .eq('id', props.userProfile.id);\r\n         if (error) throw error;\r\n\r\n          emit('action-complete', true, `تم إلغاء إيقاف التعليقات بنجاح.`, { comment_suspended_until: null });\r\n\r\n     } catch (err: any) {\r\n         console.error(\"Error removing suspension:\", err);\r\n         emit('action-complete', false, `فشل إلغاء إيقاف التعليقات: ${err.message}`);\r\n     } finally {\r\n         pendingAction.value = null;\r\n     }\r\n};\r\n\r\n// Confirmation Modal Logic\r\nconst confirmAction = (type: 'ban' | 'unban' | 'unsuspend') => {\r\n    actionToConfirm = { type };\r\n    let title = '', message = '', confirmText = '', cancelText = 'إلغاء', confirmClass = 'bg-red-600 hover:bg-red-700 focus:ring-red-500';\r\n    const userName = props.userProfile.full_name || props.userProfile.id; // Use ID as fallback\r\n\r\n    if (type === 'ban') { title = 'تأكيد الحظر'; message = `هل أنت متأكد من حظر ${userName}؟`; confirmText = 'نعم، حظر'; }\r\n    else if (type === 'unban') { title = 'تأكيد إلغاء الحظر'; message = `هل أنت متأكد من إلغاء حظر ${userName}؟`; confirmText = 'نعم، إلغاء الحظر'; confirmClass = 'bg-green-600 hover:bg-green-700 focus:ring-green-500'; }\r\n    else if (type === 'unsuspend') { title = 'تأكيد إلغاء إيقاف التعليق'; message = `هل أنت متأكد من السماح لـ ${userName} بالتعليق؟`; confirmText = 'نعم، إلغاء الإيقاف'; confirmClass = 'bg-green-600 hover:bg-green-700 focus:ring-green-500'; }\r\n\r\n    confirmModalConfig.value = { title, message, confirmText, cancelText, confirmClass };\r\n    showConfirm.value = true;\r\n};\r\n\r\nconst executeConfirmedAction = () => {\r\n    if (!actionToConfirm) return;\r\n    const { type } = actionToConfirm;\r\n    if (type === 'ban') { toggleBanStatus(true); }\r\n    else if (type === 'unban') { toggleBanStatus(false); }\r\n    else if (type === 'unsuspend') { removeCommentSuspension(); }\r\n    showConfirm.value = false; // Close modal after action initiated\r\n    actionToConfirm = null;\r\n};\r\n\r\n</script>\r\n\r\n<style scoped>\r\n/* Add styles if needed */\r\n</style>"],"version":3}