{"file":"CategoryModal.vue2.mjs","mappings":";;;;;;;;;;;;;AA0DA,UAAM,QAAQ;AACd,UAAM,OAAO;AACb,UAAM,WAAW,kBAA4B;AAEvC,UAAA,OAAO,IAAuB,EAAE;AAChC,UAAA,WAAW,IAAI,KAAK;AACpB,UAAA,eAAe,IAAmB,IAAI;AACtC,UAAA,YAAY,SAAS,MAAM,CAAC,CAAC,MAAM,gBAAgB,CAAC,CAAC,MAAM,aAAa,EAAE;AAEhF,UAAM,MAAM,MAAM,cAAc,CAAC,YAAY;AAC3C,UAAI,SAAS;AACN,aAAA,QAAQ,EAAE,GAAG,QAAQ;AAAA,MAAA,OACrB;AACL,aAAK,QAAQ,EAAE,MAAM,IAAI,aAAa,IAAI,MAAM,GAAG;AAAA,MAAA;AAErD,mBAAa,QAAQ;AAAA,OACpB,EAAE,WAAW,MAAM,MAAM,MAAM;AAElC,aAAS,aAAa;AAAE,UAAI,CAAC,SAAS,MAAO,MAAK,OAAO;AAAA,IAAA;AAEzD,mBAAe,eAAe;;AAC5B,eAAS,QAAQ;AACjB,mBAAa,QAAQ;AAGjB,UAAA,GAAC,UAAK,MAAM,SAAX,mBAAiB,WAAU,GAAC,UAAK,MAAM,SAAX,mBAAiB,SAAQ;AACtD,qBAAa,QAAQ;AACrB,iBAAS,QAAQ;AACjB;AAAA,MAAA;AAGJ,YAAM,UAA+C;AAAA;AAAA,QACnD,MAAM,KAAK,MAAM;AAAA,QACjB,aAAa,KAAK,MAAM,eAAe;AAAA,QACvC,MAAM,KAAK,MAAM;AAAA,MACnB;AAEI,UAAA;AACE,YAAA;AACJ,YAAI,UAAU,SAAS,KAAK,MAAM,IAAI;AACpC,gBAAM,SAAS,MAAM,SAAS,KAAK,YAAY,EAAE,OAAO,OAAO,EAAE,GAAG,MAAM,KAAK,MAAM,EAAE,EAAE,OAAO;AAChG,kBAAQ,OAAO;AAAA,QAAA,OACV;AACC,gBAAA,SAAS,MAAM,SAAS,KAAK,YAAY,EAAE,OAAO,OAAO,EAAE,OAAO;AACxE,kBAAQ,OAAO;AAAA,QAAA;AAEjB,YAAI,MAAa,OAAA;AACjB,aAAK,OAAO;AAAA,eACL,KAAU;AACT,gBAAA,MAAM,0BAA0B,GAAG;AAC3C,qBAAa,QAAQ,kBAAkB,IAAI,WAAW,eAAe;AAAA,MAAA,UACrE;AACA,iBAAS,QAAQ;AAAA,MAAA;AAAA,IACnB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":[],"sources":["../../../../../components/admin/CategoryModal.vue"],"sourcesContent":["<!-- components/admin/CategoryModal.vue -->\r\n<template>\r\n  <TransitionRoot appear :show=\"show\" as=\"template\">\r\n    <Dialog as=\"div\" @close=\"closeModal\" class=\"relative z-50\">\r\n      <TransitionChild as=\"div\" class=\"fixed inset-0 bg-black/30 backdrop-blur-sm\" enter=\"duration-300 ease-out\" enter-from=\"opacity-0\" enter-to=\"opacity-100\" leave=\"duration-200 ease-in\" leave-from=\"opacity-100\" leave-to=\"opacity-0\" />\r\n      <div class=\"fixed inset-0 overflow-y-auto\">\r\n        <div class=\"flex min-h-full items-center justify-center p-4 text-center\">\r\n          <TransitionChild as=\"template\" enter=\"duration-300 ease-out\" enter-from=\"opacity-0 scale-95\" enter-to=\"opacity-100 scale-100\" leave=\"duration-200 ease-in\" leave-from=\"opacity-100 scale-100\" leave-to=\"opacity-0 scale-95\">\r\n            <DialogPanel class=\"w-full max-w-md transform overflow-hidden rounded-2xl bg-white dark:bg-gray-800 p-6 text-right shadow-xl transition-all\">\r\n              <DialogTitle as=\"h3\" class=\"text-lg font-medium leading-6 text-gray-900 dark:text-gray-100 border-b pb-3 mb-4\">\r\n                {{ isEditing ? 'تعديل الفئة' : 'إضافة فئة جديدة' }}\r\n              </DialogTitle>\r\n              <form @submit.prevent=\"saveCategory\" class=\"mt-4 space-y-4\">\r\n                <!-- Name Field -->\r\n                <div>\r\n                  <label for=\"cat-name\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">اسم الفئة *</label>\r\n                  <input type=\"text\" id=\"cat-name\" v-model=\"form.name\" required class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white\" />\r\n                </div>\r\n                <!-- Description Field -->\r\n                <div>\r\n                  <label for=\"cat-description\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">الوصف</label>\r\n                  <textarea id=\"cat-description\" rows=\"3\" v-model=\"form.description\" class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white\"></textarea>\r\n                </div>\r\n                 <!-- Type Field -->\r\n                 <div>\r\n                   <label for=\"cat-type\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">النوع *</label>\r\n                   <!-- يمكنك استخدام select إذا كانت الأنواع محدودة أو input عادي -->\r\n                   <input type=\"text\" id=\"cat-type\" v-model=\"form.type\" required placeholder=\"مثل: lesson, study_course, book, sermon...\" class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white\" />\r\n                   <p class=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">يُستخدم لتصنيف المحتوى العام (مطلوب).</p>\r\n                 </div>\r\n\r\n                 <!-- Error Message -->\r\n                <p v-if=\"errorMessage\" class=\"text-sm text-red-600 dark:text-red-400\">خطأ: {{ errorMessage }}</p>\r\n\r\n                <!-- Action Buttons -->\r\n                <div class=\"mt-6 pt-4 border-t dark:border-gray-700 flex justify-end space-x-3 rtl:space-x-reverse\">\r\n                  <button type=\"button\" @click=\"closeModal\" class=\"inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800\">إلغاء</button>\r\n                  <button type=\"submit\" :disabled=\"isSaving\" class=\"inline-flex justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:opacity-50\">\r\n                     <svg v-if=\"isSaving\" class=\"animate-spin -ml-1 mr-3 h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\"><circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle><path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path></svg>\r\n                    {{ isSaving ? 'جاري الحفظ...' : (isEditing ? 'حفظ التعديلات' : 'إضافة الفئة') }}\r\n                  </button>\r\n                </div>\r\n              </form>\r\n            </DialogPanel>\r\n          </TransitionChild>\r\n        </div>\r\n      </div>\r\n    </Dialog>\r\n  </TransitionRoot>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, watch, computed } from 'vue';\r\nimport { TransitionRoot, TransitionChild, Dialog, DialogPanel, DialogTitle } from '@headlessui/vue';\r\nimport type { Database, Tables } from '~/types/database.types';\r\n\r\ntype Category = Tables<'categories'>;\r\n\r\nconst props = defineProps<{ show: boolean; categoryData: Category | null; }>();\r\nconst emit = defineEmits(['close', 'saved']);\r\nconst supabase = useSupabaseClient<Database>();\r\n\r\nconst form = ref<Partial<Category>>({});\r\nconst isSaving = ref(false);\r\nconst errorMessage = ref<string | null>(null);\r\nconst isEditing = computed(() => !!props.categoryData && !!props.categoryData.id);\r\n\r\nwatch(() => props.categoryData, (newData) => {\r\n  if (newData) {\r\n    form.value = { ...newData };\r\n  } else {\r\n    form.value = { name: '', description: '', type: '' }; // Reset for add\r\n  }\r\n  errorMessage.value = null;\r\n}, { immediate: true, deep: true });\r\n\r\nfunction closeModal() { if (!isSaving.value) emit('close'); }\r\n\r\nasync function saveCategory() {\r\n  isSaving.value = true;\r\n  errorMessage.value = null;\r\n\r\n  // Basic validation\r\n  if (!form.value.name?.trim() || !form.value.type?.trim()) {\r\n      errorMessage.value = \"اسم الفئة ونوعها حقول مطلوبة.\";\r\n      isSaving.value = false;\r\n      return;\r\n  }\r\n\r\n  const payload: Omit<Category, 'id' | 'created_at'> = { // Omit fields managed by DB\r\n    name: form.value.name,\r\n    description: form.value.description || null,\r\n    type: form.value.type,\r\n  };\r\n\r\n  try {\r\n    let error: any;\r\n    if (isEditing.value && form.value.id) {\r\n      const result = await supabase.from('categories').update(payload).eq('id', form.value.id).select();\r\n      error = result.error;\r\n    } else {\r\n      const result = await supabase.from('categories').insert(payload).select();\r\n      error = result.error;\r\n    }\r\n    if (error) throw error;\r\n    emit('saved');\r\n  } catch (err: any) {\r\n    console.error(\"Error saving category:\", err);\r\n    errorMessage.value = `فشل حفظ الفئة: ${err.message || 'خطأ غير متوقع'}`;\r\n  } finally {\r\n    isSaving.value = false;\r\n  }\r\n}\r\n</script>"],"version":3}