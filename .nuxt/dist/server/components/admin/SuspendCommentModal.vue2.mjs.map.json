{"file":"SuspendCommentModal.vue2.mjs","mappings":";;;;;;;;;;;;;;;;;;;;;;AAkFA,UAAM,QAAQ;AAWd,UAAM,OAAO;AAEb,UAAM,WAAW,kBAA4B;AACvC,UAAA,SAAS,IAAI,MAAM,UAAU;AAC7B,UAAA,gBAAgB,IAA0D,OAAO;AACjF,UAAA,kBAAkB,IAAI,EAAE;AACxB,UAAA,YAAY,IAAI,KAAK;AACrB,UAAA,eAAe,IAAmB,IAAI;AAGtC,UAAA,UAAU,SAAS,MAAM;AACrB,YAAA,4BAAY,KAAK;AACvB,YAAM,WAAW,MAAM,WAAA,IAAe,MAAM,mBAAmB;AAC/D,aAAO,MAAM,YAAA,EAAc,MAAM,GAAG,EAAE;AAAA,IAAA,CACzC;AAGD,UAAM,MAAM,MAAM,YAAY,CAAC,WAAW;AACxC,aAAO,QAAQ;AACf,UAAI,QAAQ;AAEV,sBAAc,QAAQ;AACtB,wBAAgB,QAAQ;AACxB,qBAAa,QAAQ;AACrB,kBAAU,QAAQ;AAAA,MAAA;AAAA,IACpB,CACD;AAED,aAAS,aAAa;AACpB,UAAI,UAAU,MAAO;AACrB,aAAO,QAAQ;AACf,WAAK,qBAAqB,KAAK;AAC/B,WAAK,OAAO;AAAA,IAAA;AAGd,mBAAe,kBAAkB;AAC/B,UAAI,CAAC,MAAM,QAAQ,UAAU,MAAO;AAEpC,UAAI,eAA4B;AAC1B,YAAA,0BAAU,KAAK;AAEjB,UAAA;AACF,gBAAQ,cAAc,OAAO;AAAA,UACzB,KAAK;AAAwB,2BAAA,QAAQ,KAAK,CAAC;AAAG;AAAA,UAC9C,KAAK;AAAyB,2BAAA,QAAQ,KAAK,CAAC;AAAG;AAAA,UAC/C,KAAK;AAAyB,2BAAA,SAAS,KAAK,CAAC;AAAG;AAAA,UAChD,KAAK;AAA0B,2BAAA,UAAU,KAAK,CAAC;AAAG;AAAA,UAClD,KAAK;AACG,gBAAA,CAAC,gBAAgB,OAAO;AACxB,2BAAa,QAAQ;AACrB;AAAA,YAAA;AAEW,2BAAA,IAAI,KAAK,gBAAgB,KAAK;AAC7C,gBAAI,MAAM,aAAa,QAAS,CAAA,KAAK,gBAAgB,KAAK;AACtD,2BAAa,QAAQ;AACrB;AAAA,YAAA;AAEJ;AAAA,UACJ;AACK,yBAAa,QAAQ;AACrB;AAAA,QAAA;AAAA,eAEF,GAAG;AACR,qBAAa,QAAQ;AACrB;AAAA,MAAA;AAIJ,gBAAU,QAAQ;AAClB,mBAAa,QAAQ;AAEjB,UAAA;AACM,cAAA,kBAAkB,aAAa,YAAY;AAEjD,cAAM,EAAE,MAAM,IAAI,MAAM,SACnB,KAAK,UAAU,EACf,OAAO,EAAE,yBAAyB,gBAAiB,CAAA,EACnD,GAAG,MAAM,MAAM,KAAK,EAAE;AAE3B,YAAI,MAAa,OAAA;AAEjB,aAAK,aAAa,MAAM,KAAK,IAAI,MAAM,eAAe;AAC3C,mBAAA;AAAA,eAEN,KAAU;AACP,gBAAA,MAAM,8BAA8B,GAAG;AAClC,qBAAA,QAAQ,IAAI,WAAW;AAAA,MAAA,UAEtC;AACE,kBAAU,QAAQ;AAAA,MAAA;AAAA,IACtB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":[],"sources":["../../../../../components/admin/SuspendCommentModal.vue"],"sourcesContent":["<template>\r\n  <TransitionRoot appear :show=\"isOpen\" as=\"template\">\r\n    <Dialog as=\"div\" @close=\"closeModal\" class=\"relative z-40\">\r\n      <!-- ... (Backdrop similar to ConfirmationModal) ... -->\r\n      <TransitionChild as=\"template\" enter=\"duration-300 ease-out\" enter-from=\"opacity-0\" enter-to=\"opacity-100\" leave=\"duration-200 ease-in\" leave-from=\"opacity-100\" leave-to=\"opacity-0\">\r\n         <div class=\"fixed inset-0 bg-black/30 backdrop-blur-sm\" />\r\n       </TransitionChild>\r\n\r\n      <div class=\"fixed inset-0 overflow-y-auto\">\r\n        <div class=\"flex min-h-full items-center justify-center p-4 text-center\">\r\n          <TransitionChild as=\"template\" enter=\"duration-300 ease-out\" enter-from=\"opacity-0 scale-95\" enter-to=\"opacity-100 scale-100\" leave=\"duration-200 ease-in\" leave-from=\"opacity-100 scale-100\" leave-to=\"opacity-0 scale-95\">\r\n            <DialogPanel class=\"w-full max-w-lg transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 p-6 text-right shadow-xl transition-all\">\r\n              <DialogTitle as=\"h3\" class=\"text-lg font-medium leading-6 text-gray-900 dark:text-gray-100 mb-4 border-b dark:border-gray-700 pb-3\">\r\n                إيقاف التعليقات للمستخدم: {{ user?.full_name || user?.auth_email }}\r\n              </DialogTitle>\r\n\r\n              <form @submit.prevent=\"suspendComments\">\r\n                 <div class=\"mt-4 space-y-4\">\r\n                    <p class=\"text-sm text-gray-600 dark:text-gray-300\">\r\n                        حدد مدة إيقاف المستخدم عن إضافة تعليقات جديدة. سيتمكن من التعليق مرة أخرى بعد انتهاء المدة.\r\n                    </p>\r\n                   <div>\r\n                     <label for=\"suspension-duration\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">مدة الإيقاف *</label>\r\n                     <select id=\"suspension-duration\" v-model=\"durationValue\" required class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white\">\r\n                       <option value=\"1_day\">يوم واحد</option>\r\n                       <option value=\"3_days\">3 أيام</option>\r\n                       <option value=\"1_week\">أسبوع واحد</option>\r\n                       <option value=\"1_month\">شهر واحد</option>\r\n                       <option value=\"custom\">مدة مخصصة (تاريخ الانتهاء)</option>\r\n                     </select>\r\n                   </div>\r\n                   <div v-if=\"durationValue === 'custom'\">\r\n                     <label for=\"suspension-until\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">تاريخ انتهاء الإيقاف *</label>\r\n                     <input type=\"datetime-local\" id=\"suspension-until\" v-model=\"customUntilDate\" required :min=\"minDate\" class=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white\" />\r\n                   </div>\r\n                   <p v-if=\"errorMessage\" class=\"text-sm text-red-600 dark:text-red-400\">{{ errorMessage }}</p>\r\n                 </div>\r\n\r\n                 <div class=\"mt-6 flex justify-start gap-3\">\r\n                    <button\r\n                      type=\"submit\"\r\n                      :disabled=\"isLoading || (durationValue === 'custom' && !customUntilDate)\"\r\n                      class=\"inline-flex justify-center rounded-md border border-transparent bg-yellow-600 px-6 py-2 text-sm font-medium text-white shadow-sm hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:opacity-50\"\r\n                    >\r\n                       <LoadingSpinner v-if=\"isLoading\" class=\"w-5 h-5 text-white -ml-1 mr-2\" />\r\n                      {{ isLoading ? 'جارٍ الإيقاف...' : 'إيقاف التعليقات' }}\r\n                    </button>\r\n                    <button\r\n                      type=\"button\"\r\n                      class=\"inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800\"\r\n                      @click=\"closeModal\"\r\n                      :disabled=\"isLoading\"\r\n                    >\r\n                      إلغاء\r\n                    </button>\r\n                 </div>\r\n              </form>\r\n            </DialogPanel>\r\n          </TransitionChild>\r\n        </div>\r\n      </div>\r\n    </Dialog>\r\n  </TransitionRoot>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, watch, computed, type PropType } from 'vue';\r\nimport {\r\n  Dialog, DialogPanel, DialogTitle, TransitionRoot, TransitionChild\r\n} from '@headlessui/vue';\r\nimport type { Database, Tables } from '~/types/database.types';\r\nimport { useSupabaseClient } from '#imports';\r\nimport LoadingSpinner from '~/components/LoadingSpinner.vue';\r\nimport { addDays, addWeeks, addMonths } from 'date-fns'; // For calculating dates\r\n\r\n// Define the user type expected by the modal\r\ntype UserProp = {\r\n    id: string;\r\n    full_name: string | null;\r\n    auth_email?: string | null;\r\n} | null;\r\n\r\nconst props = defineProps({\r\n  user: {\r\n    type: Object as PropType<UserProp>,\r\n    required: true,\r\n  },\r\n  modelValue: { // For v-model support\r\n    type: Boolean,\r\n    default: false,\r\n  }\r\n});\r\n\r\nconst emit = defineEmits(['close', 'suspended', 'update:modelValue']);\r\n\r\nconst supabase = useSupabaseClient<Database>();\r\nconst isOpen = ref(props.modelValue);\r\nconst durationValue = ref<'1_day' | '3_days' | '1_week' | '1_month' | 'custom'>('1_day');\r\nconst customUntilDate = ref('');\r\nconst isLoading = ref(false);\r\nconst errorMessage = ref<string | null>(null);\r\n\r\n// Minimum date for custom input (today)\r\nconst minDate = computed(() => {\r\n    const today = new Date();\r\n    today.setMinutes(today.getMinutes() - today.getTimezoneOffset()); // Adjust for local timezone for input\r\n    return today.toISOString().slice(0, 16); // Format for datetime-local\r\n});\r\n\r\n\r\nwatch(() => props.modelValue, (newVal) => {\r\n  isOpen.value = newVal;\r\n  if (newVal) {\r\n    // Reset form when modal opens\r\n    durationValue.value = '1_day';\r\n    customUntilDate.value = '';\r\n    errorMessage.value = null;\r\n    isLoading.value = false;\r\n  }\r\n});\r\n\r\nfunction closeModal() {\r\n  if (isLoading.value) return;\r\n  isOpen.value = false;\r\n  emit('update:modelValue', false);\r\n  emit('close');\r\n}\r\n\r\nasync function suspendComments() {\r\n  if (!props.user || isLoading.value) return;\r\n\r\n  let suspendUntil: Date | null = null;\r\n  const now = new Date();\r\n\r\n  try {\r\n    switch (durationValue.value) {\r\n        case '1_day': suspendUntil = addDays(now, 1); break;\r\n        case '3_days': suspendUntil = addDays(now, 3); break;\r\n        case '1_week': suspendUntil = addWeeks(now, 1); break;\r\n        case '1_month': suspendUntil = addMonths(now, 1); break;\r\n        case 'custom':\r\n            if (!customUntilDate.value) {\r\n                errorMessage.value = \"الرجاء تحديد تاريخ انتهاء الإيقاف.\";\r\n                return;\r\n            }\r\n            suspendUntil = new Date(customUntilDate.value);\r\n            if (isNaN(suspendUntil.getTime()) || suspendUntil <= now) {\r\n                errorMessage.value = \"تاريخ الانتهاء يجب أن يكون في المستقبل.\";\r\n                return;\r\n            }\r\n            break;\r\n        default:\r\n             errorMessage.value = \"مدة إيقاف غير صالحة.\";\r\n             return;\r\n    }\r\n  } catch (e) {\r\n      errorMessage.value = \"تنسيق التاريخ غير صالح.\";\r\n      return;\r\n  }\r\n\r\n\r\n  isLoading.value = true;\r\n  errorMessage.value = null;\r\n\r\n  try {\r\n      const suspendUntilISO = suspendUntil.toISOString();\r\n\r\n      const { error } = await supabase\r\n          .from('profiles')\r\n          .update({ comment_suspended_until: suspendUntilISO })\r\n          .eq('id', props.user.id);\r\n\r\n      if (error) throw error;\r\n\r\n      emit('suspended', props.user.id, true, suspendUntilISO); // Emit success with user ID and expiry date\r\n      closeModal();\r\n\r\n  } catch (err: any) {\r\n      console.error(\"Error suspending comments:\", err);\r\n      errorMessage.value = err.message || \"فشل إيقاف تعليقات المستخدم.\";\r\n      // Optionally emit failure: emit('suspended', props.user.id, false, null, errorMessage.value);\r\n  } finally {\r\n      isLoading.value = false;\r\n  }\r\n}\r\n</script>"],"version":3}