import{e as M,u as j,r as u,k as D,c as r,a as e,t as p,i as f,x as s,y as i,d as L,v as N,o as n,_ as P}from"./CaF1xe-H.js";const T={class:"p-4 md:p-6 lg:p-8"},$={key:0,class:"text-center py-10"},G={key:1,class:"p-4 bg-red-100 dark:bg-red-900/50 border border-red-300 dark:border-red-700 text-red-800 dark:text-red-200 rounded-md"},z={key:2,class:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow border border-cream-gray dark:border-gray-700"},F={class:"space-y-6"},R={class:"mt-1 flex items-center space-x-reverse space-x-4"},q=["src"],A={key:1,class:"h-24 w-24 rounded-md border border-dashed border-cream-gray dark:border-gray-600 flex items-center justify-center text-gray-400 flex-shrink-0"},H={class:"flex-grow"},K={for:"imageUpload",class:"cursor-pointer inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},O={key:0,class:"mt-1 text-xs text-red-600 dark:text-red-400"},J={key:1,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},W=["value"],Q={class:"border-t border-cream-gray dark:border-gray-600 pt-5"},Y={class:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-5"},Z={key:0,class:"mt-6 p-3 form-success-message"},tt={key:1,class:"mt-6 p-3 form-error-message"},et={class:"mt-8 pt-5 border-t border-cream-gray dark:border-gray-700"},ot=["disabled"],lt={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},at={key:0,class:"mt-3 text-xs text-gray-500 dark:text-gray-400"},E="profile-images",rt=M({__name:"about-sheikh",setup(nt){const x=j(),U=u(!0),g=u(null),b=u(!1),k=u(null),d=u(null),_=u(null),v=u(null),h=u(!1),c=u(null),o=u({...{short_bio:"",full_bio:"",profile_image_url:"",contact_info:{}}});function C(l){if(!l)return null;try{return new Date(l).toLocaleString("ar-EG",{dateStyle:"long",timeStyle:"short"})}catch{return"تاريخ غير صالح"}}async function V(){U.value=!0,g.value=null;try{const{data:l,error:t}=await x.from("about_sheikh").select("*").eq("id",1).maybeSingle();if(t)throw t;l?(o.value.short_bio=l.short_bio??"",o.value.full_bio=l.full_bio??"",o.value.profile_image_url=l.profile_image_url??"",o.value.contact_info=typeof l.contact_info=="object"&&l.contact_info!==null?l.contact_info:{},_.value=l.updated_at):(g.value='لم يتم العثور على بيانات "عن الشيخ" (id=1).',o.value.contact_info={})}catch(l){console.error("Error fetching Sheikh info:",l),g.value=l.message||"فشل تحميل بيانات الشيخ.",o.value.contact_info={}}finally{U.value=!1}}D(V);function X(l){const t=l.target;t.files&&t.files[0]?(v.value=t.files[0],c.value=null,B()):v.value=null}async function B(){if(!v.value){c.value="الرجاء اختيار ملف صورة أولاً.";return}h.value=!0,c.value=null,d.value=null;try{const l=v.value,y=`${`sheikh_avatar.${l.name.split(".").pop()}`}`;console.log(`Uploading ${y} to bucket ${E}...`);const{error:m}=await x.storage.from(E).upload(y,l,{cacheControl:"3600",upsert:!0});if(m)throw console.error("Supabase storage upload error:",m),m;console.log("Upload successful. Getting public URL...");const{data:w}=x.storage.from(E).getPublicUrl(y);if(!(w!=null&&w.publicUrl))throw console.error("Could not get public URL after upload."),new Error("لم يتمكن من الحصول على رابط الصورة بعد الرفع.");const S=w.publicUrl;console.log("Public URL:",S),o.value.profile_image_url=S,d.value="تم رفع الصورة بنجاح. لا تنس حفظ التعديلات الإجمالية.",v.value=null}catch(l){console.error("Error uploading image:",l),c.value=`فشل رفع الصورة: ${l.message}`}finally{h.value=!1;const l=document.getElementById("imageUpload");l&&(l.value="")}}async function I(){b.value=!0,k.value=null,d.value=null;try{const l={};for(const y in o.value.contact_info){const m=y;o.value.contact_info[m]&&(l[m]=o.value.contact_info[m])}const t={short_bio:o.value.short_bio||null,full_bio:o.value.full_bio||null,profile_image_url:o.value.profile_image_url||null,contact_info:Object.keys(l).length>0?l:null,updated_at:new Date().toISOString()};console.log("Updating about_sheikh with data:",t);const{error:a}=await x.from("about_sheikh").update(t).eq("id",1);if(a)throw a;d.value="تم حفظ التعديلات بنجاح!",_.value=t.updated_at,setTimeout(()=>{d.value=null},3e3)}catch(l){console.error("Error updating Sheikh info:",l),k.value=l.message||"حدث خطأ غير متوقع أثناء حفظ التعديلات."}finally{b.value=!1}}return(l,t)=>(n(),r("div",T,[t[29]||(t[29]=e("h1",{class:"text-2xl font-bold text-brown-dark dark:text-beige-light mb-6 border-b border-cream-gray dark:border-gray-700 pb-3"},' إدارة صفحة "عن الشيخ" ',-1)),U.value?(n(),r("div",$,t[11]||(t[11]=[e("p",{class:"text-gray-500 dark:text-gray-400"},"جاري تحميل البيانات...",-1)]))):g.value?(n(),r("div",G,[e("p",null,"خطأ في تحميل البيانات: "+p(g.value),1),e("button",{onClick:V,class:"mt-2 px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700"}," إعادة المحاولة ")])):(n(),r("div",z,[e("form",{onSubmit:N(I,["prevent"])},[e("div",F,[e("div",null,[t[12]||(t[12]=e("label",{for:"short_bio",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," نبذة مختصرة ",-1)),s(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=a=>o.value.short_bio=a),id:"short_bio",rows:"3",class:"form-textarea"},null,512),[[i,o.value.short_bio]]),t[13]||(t[13]=e("p",{class:"form-help-text"},"تظهر في أماكن مثل أعلى الصفحة الرئيسية.",-1))]),e("div",null,[t[14]||(t[14]=e("label",{for:"full_bio",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," السيرة الذاتية الكاملة ",-1)),s(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=a=>o.value.full_bio=a),id:"full_bio",rows:"10",class:"form-textarea"},null,512),[[i,o.value.full_bio]]),t[15]||(t[15]=e("p",{class:"form-help-text"},'المحتوى الرئيسي لصفحة "عن الشيخ".',-1))]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," صورة الشيخ الشخصية ",-1)),e("div",R,[o.value.profile_image_url?(n(),r("img",{key:0,src:o.value.profile_image_url,alt:"صورة الشيخ الحالية",class:"h-24 w-24 rounded-md object-cover border border-cream-gray dark:border-gray-600 flex-shrink-0"},null,8,q)):(n(),r("div",A,t[16]||(t[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-10 w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"1"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)]))),e("div",H,[e("input",{type:"file",id:"imageUpload",onChange:X,accept:"image/png, image/jpeg, image/webp",class:"hidden"},null,32),e("label",K,[e("span",null,p(h.value?"جاري الرفع...":"اختيار صورة جديدة"),1)]),c.value?(n(),r("p",O,p(c.value),1)):f("",!0),c.value?f("",!0):(n(),r("p",J," (اختياري) اختر ملف PNG, JPG, أو WEBP. سيتم استبدال الصورة الحالية. ")),e("input",{type:"text",value:o.value.profile_image_url,readonly:"",class:"form-input mt-2 !bg-gray-100 dark:!bg-gray-700/50 opacity-75",placeholder:"رابط الصورة بعد الرفع"},null,8,W)])])]),e("fieldset",Q,[t[27]||(t[27]=e("legend",{class:"text-base font-medium text-gray-900 dark:text-white mb-3"},"معلومات الاتصال (اختياري)",-1)),e("div",Y,[e("div",null,[t[18]||(t[18]=e("label",{for:"contact_email",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"البريد الإلكتروني",-1)),s(e("input",{type:"email",id:"contact_email","onUpdate:modelValue":t[2]||(t[2]=a=>o.value.contact_info.email=a),class:"form-input mt-1",placeholder:"email@example.com"},null,512),[[i,o.value.contact_info.email]])]),e("div",null,[t[19]||(t[19]=e("label",{for:"contact_phone",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"الهاتف",-1)),s(e("input",{type:"tel",id:"contact_phone","onUpdate:modelValue":t[3]||(t[3]=a=>o.value.contact_info.phone=a),class:"form-input mt-1",placeholder:"+XXXXXXXXXXX"},null,512),[[i,o.value.contact_info.phone]])]),e("div",null,[t[20]||(t[20]=e("label",{for:"contact_telegram",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"تيليجرام (رابط قناة أو حساب)",-1)),s(e("input",{type:"url",id:"contact_telegram","onUpdate:modelValue":t[4]||(t[4]=a=>o.value.contact_info.telegram=a),class:"form-input mt-1",placeholder:"https://t.me/username"},null,512),[[i,o.value.contact_info.telegram]])]),e("div",null,[t[21]||(t[21]=e("label",{for:"contact_whatsapp",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"واتساب (رابط مباشر أو رقم)",-1)),s(e("input",{type:"text",id:"contact_whatsapp","onUpdate:modelValue":t[5]||(t[5]=a=>o.value.contact_info.whatsapp=a),class:"form-input mt-1",placeholder:"https://wa.me/..."},null,512),[[i,o.value.contact_info.whatsapp]])]),e("div",null,[t[22]||(t[22]=e("label",{for:"contact_facebook",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"فيسبوك (رابط صفحة)",-1)),s(e("input",{type:"url",id:"contact_facebook","onUpdate:modelValue":t[6]||(t[6]=a=>o.value.contact_info.facebook=a),class:"form-input mt-1",placeholder:"https://facebook.com/page"},null,512),[[i,o.value.contact_info.facebook]])]),e("div",null,[t[23]||(t[23]=e("label",{for:"contact_twitter",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"تويتر / X (رابط حساب)",-1)),s(e("input",{type:"url",id:"contact_twitter","onUpdate:modelValue":t[7]||(t[7]=a=>o.value.contact_info.twitter=a),class:"form-input mt-1",placeholder:"https://x.com/username"},null,512),[[i,o.value.contact_info.twitter]])]),e("div",null,[t[24]||(t[24]=e("label",{for:"contact_youtube",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"يوتيوب (رابط قناة)",-1)),s(e("input",{type:"url",id:"contact_youtube","onUpdate:modelValue":t[8]||(t[8]=a=>o.value.contact_info.youtube=a),class:"form-input mt-1",placeholder:"https://youtube.com/channel/..."},null,512),[[i,o.value.contact_info.youtube]])]),e("div",null,[t[25]||(t[25]=e("label",{for:"contact_instagram",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"انستغرام (رابط حساب)",-1)),s(e("input",{type:"url",id:"contact_instagram","onUpdate:modelValue":t[9]||(t[9]=a=>o.value.contact_info.instagram=a),class:"form-input mt-1",placeholder:"https://instagram.com/username"},null,512),[[i,o.value.contact_info.instagram]])]),e("div",null,[t[26]||(t[26]=e("label",{for:"contact_tiktok",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"تيك توك (رابط حساب)",-1)),s(e("input",{type:"url",id:"contact_tiktok","onUpdate:modelValue":t[10]||(t[10]=a=>o.value.contact_info.tiktok=a),class:"form-input mt-1",placeholder:"https://tiktok.com/@username"},null,512),[[i,o.value.contact_info.tiktok]])])])])]),d.value?(n(),r("div",Z,p(d.value),1)):f("",!0),k.value?(n(),r("div",tt," خطأ في التحديث: "+p(k.value),1)):f("",!0),e("div",et,[e("button",{type:"submit",disabled:b.value||h.value,class:"inline-flex justify-center items-center px-6 py-2.5 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50 dark:focus:ring-offset-gray-800"},[b.value?(n(),r("svg",lt,t[28]||(t[28]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):f("",!0),L(" "+p(b.value?"جاري حفظ التعديلات...":"حفظ التعديلات"),1)],8,ot),_.value?(n(),r("p",at,"آخر تحديث: "+p(C(_.value)),1)):f("",!0)])],32)]))]))}}),ut=P(rt,[["__scopeId","data-v-2d9e13f5"]]);export{ut as default};
