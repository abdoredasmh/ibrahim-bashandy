import{e as L,g as B,x as A,Y as D,p as C,w as V,n as x,Z as S,o as r,c,a as e,i as f,t as _,_ as E,u as M,r as h,k as $,d as q,F as T,j as N,b as u}from"./CaF1xe-H.js";const U={key:0,class:"animate-pulse"},H={key:1,class:"flex items-center space-x-4 rtl:space-x-reverse"},j={class:"text-sm font-medium text-gray-500 dark:text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300 transition-colors"},F={key:0,class:"absolute top-2 right-2 text-yellow-500 dark:text-yellow-400"},I=L({__name:"AdminStatCard.vue",props:{title:{type:String,required:!0},value:{type:Number,default:null},icon:{type:String,required:!0},isLoading:{type:Boolean,default:!1},warning:{type:Boolean,default:!1},linkTo:{type:String,default:null},tooltip:{type:String,default:null}},setup(n){const g=n,t=B(()=>g.value===null||g.value===void 0?"-":g.value.toLocaleString("ar-EG")),l=B(()=>`icon-${g.icon}`),v=()=>{if(g.warning&&!g.isLoading)return"bg-yellow-100 dark:bg-yellow-900/50";const s=["bg-blue-100 dark:bg-blue-900/50","bg-green-100 dark:bg-green-900/50","bg-purple-100 dark:bg-purple-900/50","bg-red-100 dark:bg-red-900/50"];return s[Math.floor(Math.random()*s.length)]},b=()=>{if(g.warning&&!g.isLoading)return"text-yellow-600 dark:text-yellow-400";const s=["text-blue-600 dark:text-blue-400","text-green-600 dark:text-green-400","text-purple-600 dark:text-purple-400","text-red-600 dark:text-red-400"];return s[Math.floor(Math.random()*s.length)]};return(s,k)=>{const w=D("tooltip");return A((r(),C(S(n.linkTo?"NuxtLink":"div"),{to:n.linkTo,class:x(["bg-white dark:bg-gray-800 p-4 md:p-5 rounded-lg shadow-md border border-transparent hover:border-indigo-300 dark:hover:border-indigo-700 transition-all duration-200 group relative",{"border-yellow-400 dark:border-yellow-600 hover:border-yellow-500 dark:hover:border-yellow-500":n.warning&&!n.isLoading,"cursor-pointer":n.linkTo}])},{default:V(()=>[n.isLoading?(r(),c("div",U,k[0]||(k[0]=[e("div",{class:"h-5 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-3"},null,-1),e("div",{class:"h-8 bg-gray-300 dark:bg-gray-600 rounded w-1/2"},null,-1)]))):(r(),c("div",H,[e("div",{class:x(["p-3 rounded-full flex items-center justify-center",v()])},[(r(),C(S(l.value),{class:x(["h-6 w-6",b()])},null,8,["class"]))],2),e("div",null,[e("p",j,_(n.title),1),e("p",{class:x(["text-2xl md:text-3xl font-bold text-gray-800 dark:text-gray-200 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors",{"text-yellow-600 dark:text-yellow-400 group-hover:text-yellow-500 dark:group-hover:text-yellow-300":n.warning}])},_(t.value),3)]),n.warning&&n.value!==null&&n.value>0?(r(),c("span",F,k[1]||(k[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)]))):f("",!0)]))]),_:1},8,["to","class"])),[[w,n.tooltip]])}}}),i=E(I,[["__scopeId","data-v-a4217ca5"]]),P={class:"p-4 md:p-6 lg:p-8 bg-gray-50 dark:bg-gray-900 min-h-screen"},R={class:"flex justify-between items-center mb-6"},G=["disabled"],K={key:0,class:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},O={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},Y={key:0,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6"},Z={key:1,class:"text-center text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/30 p-6 rounded-lg shadow border border-red-200 dark:border-red-800"},J={class:"text-sm text-gray-600 dark:text-gray-400 mb-4"},W=["disabled"],X={key:2,class:"space-y-8"},ee={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6"},te={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6"},oe={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6"},le={key:0},se={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6"},ae=5*60*1e3,re=L({__name:"index",setup(n){const g=M(),t=h({totalUsers:null,totalComments:null,totalEnrollments:null,totalCompletions:null,totalBooks:null,totalLessons:null,totalCourses:null,totalQuizzes:null,totalQuestionsToSheikh:null,unansweredQuestions:null,unreadNotifications:null,totalQuizAttempts:null,totalLessonViews:null,totalBookDownloads:null}),l=h(!0),v=h(null),b=h(null);async function s(y,o){try{let d=g.from(y).select("*",{count:"exact",head:!0});o&&(d=o(d));const{count:a,error:m}=await d;if(m)throw console.error(`Supabase count error for ${y}:`,m.message),m;return a??0}catch(d){throw console.error(`Unexpected error fetching count for ${y}:`,d),d instanceof Error?d:new Error(`Failed to fetch count for ${y}`)}}async function k(y=!1){const o=Date.now();if(!y&&b.value&&o-b.value<ae){console.log("Using cached stats.");return}l.value=!0,v.value=null;const d=[{key:"totalUsers",promise:s("profiles")},{key:"totalComments",promise:s("comments")},{key:"totalEnrollments",promise:s("course_enrollments")},{key:"totalCompletions",promise:s("lesson_completions")},{key:"totalBooks",promise:s("books")},{key:"totalLessons",promise:s("lessons")},{key:"totalCourses",promise:s("study_courses")},{key:"totalQuizzes",promise:s("quizzes")},{key:"totalQuestionsToSheikh",promise:s("questions_to_sheikh")},{key:"unansweredQuestions",promise:s("questions_to_sheikh",a=>a.eq("is_answered",!1))},{key:"unreadNotifications",promise:s("notifications",a=>a.eq("is_read",!1).is("user_id",null))},{key:"totalQuizAttempts",promise:s("quiz_attempts")},{key:"totalLessonViews",promise:s("site_stats",a=>a.eq("type","lesson_view"))},{key:"totalBookDownloads",promise:s("site_stats",a=>a.eq("type","book_download"))}];try{const a=await Promise.allSettled(d.map(p=>p.promise));let m=null;a.forEach((p,Q)=>{const z=d[Q].key;p.status==="fulfilled"?t.value[z]=p.value:(console.error(`Failed to fetch stat for ${z}:`,p.reason),t.value[z]=null,m||(m=p.reason instanceof Error?p.reason:new Error(String(p.reason))))}),m?v.value=m:b.value=Date.now()}catch(a){console.error("An unexpected error occurred outside Promise.allSettled:",a),v.value||(v.value=a instanceof Error?a:new Error("Unknown error during fetching process"))}finally{l.value=!1}}function w(){b.value=null,k(!0)}return $(()=>{k()}),(y,o)=>(r(),c("div",P,[e("div",R,[o[2]||(o[2]=e("h1",{class:"text-2xl md:text-3xl font-bold text-gray-800 dark:text-gray-200"}," 📊 لوحة الإحصائيات ",-1)),e("button",{onClick:w,disabled:l.value,class:"px-4 py-2 bg-indigo-600 text-white rounded-md shadow hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center"},[l.value?(r(),c("svg",K,o[0]||(o[0]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(r(),c("svg",O,o[1]||(o[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m-15.357-2a8.001 8.001 0 0115.357 2m0 0H15"},null,-1)]))),q(" "+_(l.value?"جاري التحديث...":"تحديث"),1)],8,G)]),l.value&&!t.value.totalUsers?(r(),c("div",Y,[(r(),c(T,null,N(12,d=>e("div",{key:`skel-${d}`,class:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow animate-pulse"},o[3]||(o[3]=[e("div",{class:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-3"},null,-1),e("div",{class:"h-8 bg-gray-300 dark:bg-gray-600 rounded w-1/2"},null,-1)]))),64))])):v.value?(r(),c("div",Z,[o[5]||(o[5]=e("h3",{class:"text-lg font-semibold mb-2"},"حدث خطأ!",-1)),o[6]||(o[6]=e("p",{class:"mb-4"},"لم نتمكن من جلب بيانات لوحة الإحصائيات.",-1)),e("p",J,"الخطأ: "+_(v.value.message||"غير معروف"),1),e("button",{onClick:w,disabled:l.value,class:"px-4 py-2 bg-red-600 text-white rounded-md shadow hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center mx-auto"},o[4]||(o[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m-15.357-2a8.001 8.001 0 0115.357 2m0 0H15"})],-1),q(" إعادة المحاولة ")]),8,W)])):(r(),c("div",X,[e("section",null,[o[7]||(o[7]=e("h2",{class:"text-xl font-semibold mb-4 text-gray-700 dark:text-gray-300 border-b pb-2 border-gray-300 dark:border-gray-700"}," المستخدمون والتفاعل ",-1)),e("div",ee,[u(i,{title:"إجمالي المستخدمين",value:t.value.totalUsers,icon:"users","link-to":"/admin/users","is-loading":l.value,tooltip:"إجمالي عدد المستخدمين المسجلين"},null,8,["value","is-loading"]),u(i,{title:"إجمالي التعليقات",value:t.value.totalComments,icon:"comments","link-to":"/admin/comments","is-loading":l.value,tooltip:"إجمالي عدد التعليقات على الدروس"},null,8,["value","is-loading"]),u(i,{title:"التسجيلات بالدورات",value:t.value.totalEnrollments,icon:"graduation-cap","link-to":"/admin/enrollments","is-loading":l.value,tooltip:"إجمالي عدد مرات تسجيل المستخدمين في الدورات"},null,8,["value","is-loading"]),u(i,{title:"إكمالات الدروس",value:t.value.totalCompletions,icon:"check-circle","link-to":"/admin/completions","is-loading":l.value,tooltip:"إجمالي عدد الدروس التي تم إكمالها بواسطة المستخدمين"},null,8,["value","is-loading"])])]),e("section",null,[o[8]||(o[8]=e("h2",{class:"text-xl font-semibold mb-4 text-gray-700 dark:text-gray-300 border-b pb-2 border-gray-300 dark:border-gray-700"}," المحتوى التعليمي ",-1)),e("div",te,[u(i,{title:"إجمالي الكتب",value:t.value.totalBooks,icon:"book","link-to":"/admin/books","is-loading":l.value,tooltip:"إجمالي عدد الكتب المتاحة"},null,8,["value","is-loading"]),u(i,{title:"إجمالي الدروس",value:t.value.totalLessons,icon:"video","link-to":"/admin/lessons","is-loading":l.value,tooltip:"إجمالي عدد الدروس المتاحة"},null,8,["value","is-loading"]),u(i,{title:"إجمالي الدورات",value:t.value.totalCourses,icon:"chalkboard-teacher","link-to":"/admin/courses","is-loading":l.value,tooltip:"إجمالي عدد الدورات التدريبية المتاحة"},null,8,["value","is-loading"]),u(i,{title:"إجمالي الاختبارات",value:t.value.totalQuizzes,icon:"question-circle","link-to":"/admin/quizzes","is-loading":l.value,tooltip:"إجمالي عدد الاختبارات المتاحة"},null,8,["value","is-loading"])])]),e("section",null,[o[9]||(o[9]=e("h2",{class:"text-xl font-semibold mb-4 text-gray-700 dark:text-gray-300 border-b pb-2 border-gray-300 dark:border-gray-700"}," الاستفسارات والتنبيهات ",-1)),e("div",oe,[u(i,{title:"أسئلة للشيخ",value:t.value.totalQuestionsToSheikh,icon:"question","link-to":"/admin/questions-sheikh","is-loading":l.value,tooltip:"إجمالي الأسئلة الموجهة للشيخ"},null,8,["value","is-loading"]),u(i,{title:"أسئلة بانتظار الرد",value:t.value.unansweredQuestions,icon:"clock",warning:t.value.unansweredQuestions!==null&&t.value.unansweredQuestions>0,"link-to":"/admin/questions-sheikh?filter=unanswered","is-loading":l.value,tooltip:"عدد الأسئلة الموجهة للشيخ ولم يتم الرد عليها بعد"},null,8,["value","warning","is-loading"]),u(i,{title:"إشعارات غير مقروءة",value:t.value.unreadNotifications,icon:"bell",warning:t.value.unreadNotifications!==null&&t.value.unreadNotifications>0,"link-to":"/admin/notifications","is-loading":l.value,tooltip:"عدد الإشعارات الهامة التي لم يتم الاطلاع عليها"},null,8,["value","warning","is-loading"]),u(i,{title:"محاولات الاختبارات",value:t.value.totalQuizAttempts,icon:"file-alt","link-to":"/admin/quiz-attempts","is-loading":l.value,tooltip:"إجمالي عدد المحاولات التي أجراها المستخدمون للاختبارات"},null,8,["value","is-loading"])])]),t.value.totalLessonViews!==null||t.value.totalBookDownloads!==null?(r(),c("section",le,[o[10]||(o[10]=e("h2",{class:"text-xl font-semibold mb-4 text-gray-700 dark:text-gray-300 border-b pb-2 border-gray-300 dark:border-gray-700"}," إحصائيات الموقع ",-1)),e("div",se,[t.value.totalLessonViews!==null?(r(),C(i,{key:0,title:"مشاهدات الدروس",value:t.value.totalLessonViews,icon:"eye","is-loading":l.value,tooltip:"إجمالي عدد مرات مشاهدة الدروس"},null,8,["value","is-loading"])):f("",!0),t.value.totalBookDownloads!==null?(r(),C(i,{key:1,title:"تحميلات الكتب",value:t.value.totalBookDownloads,icon:"download","is-loading":l.value,tooltip:"إجمالي عدد مرات تحميل الكتب"},null,8,["value","is-loading"])):f("",!0)])])):f("",!0)]))]))}}),ie=E(re,[["__scopeId","data-v-847d0b30"]]);export{ie as default};
