import{_ as le}from"./CEyFpblA.js";import{e as U,r as s,c as l,o as r,$ as O,v as B,a as e,i as u,t as M,p as G,b as R,w as q,d as V,z as ae,_ as W,u as se,k as ne,l as ie,m as de,g as ce,n as K,F as D,j as Q}from"./CaF1xe-H.js";import ue from"./CgliSXAb.js";import{u as ge}from"./C0vmt3Ib.js";import"./C2nUyU-9.js";import"./CpjGp_h0.js";import"./vWwLff75.js";const ve=["onKeydown","aria-label"],fe={class:"flex flex-col h-full"},he={class:"relative h-48 bg-cream-gray dark:bg-gray-700 flex items-center justify-center flex-shrink-0"},ke=["src","alt"],xe={key:1,class:"w-full h-full flex items-center justify-center bg-gray-100 dark:bg-gray-800","aria-hidden":"true"},me={key:2,class:"absolute top-2 start-2 flex gap-1"},be={key:0,class:"badge bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"},ye={key:1,class:"badge bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300"},pe={class:"p-4 flex flex-col flex-grow"},we=["title"],_e={key:0,class:"text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-3 flex-grow"},$e={key:1,class:"flex-grow"},Ce={class:"mt-auto flex flex-col space-y-2"},Be={key:1,class:"text-xs text-center text-red-500 dark:text-red-400 mt-1"},Me=U({__name:"BookCard",props:{book:{type:Object,required:!0}},setup(a){const $=a,c=s(!1);function p(){c.value=!0}function d(){ae(`/books/${$.book.id}`)}return(g,n)=>{const v=le;return r(),l("div",{class:"book-card group block bg-beige-light dark:bg-cream-gray rounded-lg shadow-md overflow-hidden transition-shadow duration-300 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900 cursor-pointer",role:"link",tabindex:"0",onClick:d,onKeydown:[O(d,["enter"]),O(B(d,["prevent"]),["space"])],"aria-label":`عرض تفاصيل كتاب ${a.book.title}`},[e("div",fe,[e("div",he,[a.book.cover_image_url&&!c.value?(r(),l("img",{key:0,src:a.book.cover_image_url,alt:`غلاف ${a.book.title}`,class:"w-full h-full object-cover",loading:"lazy",decoding:"async",onError:B(p,["stop"])},null,40,ke)):(r(),l("div",xe,n[2]||(n[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"text-6xl text-gray-400 dark:text-gray-500 w-12 h-12",fill:"currentColor",viewBox:"0 0 24 24"},[e("title",null,"رمز كتاب بديل"),e("path",{d:"M6 4v16c0 .6.4 1 1 1h13v-2H8V5h12V3H7c-.6 0-1 .4-1 1zm3 2h8v2H9V6zm0 4h8v2H9v-2zm0 4h5v2H9v-2z"})],-1)]))),a.book.is_research||a.book.is_transcript?(r(),l("div",me,[a.book.is_research?(r(),l("span",be," بحث ")):u("",!0),a.book.is_transcript?(r(),l("span",ye," تفريغ ")):u("",!0)])):u("",!0)]),e("div",pe,[e("h3",{class:"text-lg font-semibold text-brown-dark dark:text-brown-dark mb-2 line-clamp-2 group-hover:text-primary dark:group-hover:text-primary transition-colors duration-200",title:a.book.title},M(a.book.title),9,we),a.book.description?(r(),l("p",_e,M(a.book.description),1)):(r(),l("div",$e)),e("div",Ce,[a.book.is_transcript&&a.book.linked_lesson_id?(r(),G(v,{key:0,to:`/lessons/${a.book.linked_lesson_id}`,onClick:n[0]||(n[0]=B(()=>{},["stop"])),class:"button-secondary"},{default:q(()=>n[3]||(n[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 me-2",fill:"currentColor",viewBox:"0 0 20 20"},[e("title",null,"عرض الدرس الأصلي"),e("path",{"fill-rule":"evenodd",d:"M12.293 2.293a1 1 0 011.414 0L18 6.586V16a2 2 0 01-2 2H4a2 2 0 01-2-2V4a2 2 0 012-2h8.586a1 1 0 01.707.293zM11 6a1 1 0 00-1 1v3.586l-.293-.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l2-2a1 1 0 10-1.414-1.414L12 10.586V7a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1),V(" عرض الدرس الأصلي ")])),_:1},8,["to"])):u("",!0),R(v,{to:`/books/${a.book.id}`,onClick:n[1]||(n[1]=B(()=>{},["stop"])),class:"button-primary"},{default:q(()=>n[4]||(n[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 me-2",fill:"currentColor",viewBox:"0 0 20 20"},[e("title",null,"عرض الكتاب"),e("path",{"fill-rule":"evenodd",d:"M4 2a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V4a2 2 0 00-2-2H4zm0 2h12v12H4V4zm2 2a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 4a1 1 0 100 2h4a1 1 0 100-2H7z","clip-rule":"evenodd"})],-1),V(" عرض الكتاب ")])),_:1},8,["to"]),a.book.storage_path?u("",!0):(r(),l("p",Be," ملف الكتاب غير متاح حاليًا. "))])])])],40,ve)}}}),Ve=W(Me,[["__scopeId","data-v-87625d12"]]),ze={class:"container mx-auto px-4"},Ae={class:"mb-8 space-y-4"},Te={class:"relative"},Ie=["value"],Pe={class:"flex flex-wrap items-center gap-2 pt-2"},He=["disabled"],Ee=["onClick","disabled"],Fe={key:0,class:"text-xs text-gray-500"},Se={key:1,class:"text-xs text-red-500"},je={key:0,class:"text-center py-20"},Ze={key:1,class:"text-center py-10 px-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg max-w-2xl mx-auto"},Le={key:0,class:"mt-1 text-xs text-left bg-red-100 dark:bg-red-800/30 p-2 rounded border border-red-200 dark:border-red-700 text-red-700 dark:text-red-300 whitespace-pre-wrap"},Ne={key:2,class:"text-center py-16 text-gray-500 dark:text-gray-400"},Oe={key:0},qe={key:0,class:"text-sm mt-1"},Ke={key:1},De={key:3,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},Qe={key:0,class:"flex items-center space-x-2 space-x-reverse text-gray-600 dark:text-gray-400"},Ue={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},Ge={key:2,class:"text-sm text-red-600 dark:text-red-400"},Re=16,We=400,Je=U({__name:"index",setup(a){const $=se(),c=s([]),p=s([]),d=s(null),g=s(""),n=s(""),v=s(null),z=s(1),m=s(0),w=s(!1),f=s(!0),b=s(!1),h=s(null),A=s(!1),T=s(null),I=s(!1),H=s(null),E=s(null),F=async o=>{console.log(`Fetching books batch ${o} with search: "${n.value}" and category: ${d.value}`);const t=Re,i=(o-1)*t,j=i+t-1;let x=$.from("books").select("id, title, description, cover_image_url, is_research, is_transcript, created_at, storage_path, category_id",{count:"exact"});d.value!==null&&(x=x.eq("category_id",d.value));const Z=n.value;if(Z){const N=`%${Z}%`;x=x.or(`title.ilike.${N},description.ilike.${N}`)}x=x.order("created_at",{ascending:!1}).range(i,j);const{data:C,error:P,count:L}=await x;if(P)throw console.error("Error fetching books batch:",P),P;return console.log(`Fetched batch ${o}: ${(C==null?void 0:C.length)??0} books. Total count: ${L}`),{data:C||[],count:L??0}},_=async()=>{console.log("Loading initial books..."),f.value=!0,h.value=null,z.value=1,c.value=[],w.value=!1,m.value=0;try{const{data:o,count:t}=await F(1);c.value=o,m.value=t,o.length>=t&&(w.value=!0)}catch(o){h.value=o}finally{f.value=!1}},J=async()=>{if(b.value||w.value||f.value)return;b.value=!0,h.value=null;const o=z.value+1;try{const{data:t,count:i}=await F(o);t.length>0&&(c.value.push(...t),z.value=o,m.value!==i&&(console.warn("Total book count changed during load more:",i),m.value=i)),c.value.length>=m.value&&(w.value=!0,console.log("All books loaded."))}catch(t){h.value=t,console.error("Error in loadMoreBooks:",t)}finally{b.value=!1}},X=async()=>{A.value=!0,T.value=null;try{const{data:o,error:t}=await $.from("categories").select("id, name").order("name",{ascending:!0});if(t)throw t;p.value=o||[],console.log("Filter categories loaded:",p.value)}catch(o){console.error("Error fetching filter categories:",o),T.value=o}finally{A.value=!1}},Y=o=>{g.value=o.target.value,v.value&&clearTimeout(v.value),v.value=setTimeout(()=>{n.value!==g.value.trim()&&(console.log("Search query changed, debounced:",g.value.trim()),n.value=g.value.trim(),_())},We)},S=o=>{d.value!==o&&(console.log(`Category filter changed to: ${o}`),d.value=o,_())},ee=()=>{_()},te=()=>{g.value="",n.value="",d.value=null,_()},y=s(null);let k=null;ne(()=>{X(),_(),k=new IntersectionObserver(o=>{o[0].isIntersecting&&(console.log("Infinite scroll trigger intersected!"),J())},{threshold:.1}),y.value?(k.observe(y.value),console.log("Infinite scroll observer attached.")):(console.warn("Infinite scroll trigger element not found on mount."),ie(y,o=>{o&&k&&(k.observe(o),console.log("Infinite scroll observer attached after element render."))}))}),de(()=>{k&&y.value&&(k.unobserve(y.value),console.log("Infinite scroll observer disconnected.")),k=null,v.value&&clearTimeout(v.value)}),ce(()=>m.value);function oe(o){o.storage_path?(H.value=o.storage_path,E.value=o.title??"مستند PDF",I.value=!0):(console.warn(`Book "${o.title}" does not have a storage path.`),alert(`عذرًا، لا يوجد ملف مرتبط بهذا الكتاب (${o.title}).`))}function re(){I.value=!1}return ge({title:"المكتبة الرقمية - موقع الشيخ إبراهيم بشندي",meta:[{name:"description",content:"تصفح وحمل كتب وأبحاث وتفريغات محاضرات ودروس الشيخ إبراهيم بشندي في مختلف العلوم الشرعية."}]}),(o,t)=>(r(),l("div",ze,[t[11]||(t[11]=e("h1",{class:"text-3xl font-bold text-brown-dark dark:text-brown-dark mb-6 border-b-2 border-olive-green pb-2"}," المكتبة الرقمية ",-1)),e("div",Ae,[e("div",null,[t[2]||(t[2]=e("label",{for:"library-search",class:"sr-only"},"ابحث في المكتبة",-1)),e("div",Te,[t[1]||(t[1]=e("div",{class:"absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none text-gray-500 dark:text-gray-400"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},[e("path",{"fill-rule":"evenodd",d:"M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Z","clip-rule":"evenodd"})])],-1)),e("input",{type:"search",id:"library-search",value:g.value,onInput:Y,class:"block w-full p-3 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-olive-green focus:border-olive-green dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-olive-green/70 dark:focus:border-olive-green/70",placeholder:"ابحث في الكتب والأبحاث والتفريغات...","aria-label":"بحث في المكتبة"},null,40,Ie)])]),e("div",Pe,[t[3]||(t[3]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 ms-2 hidden sm:inline"},"تصفية حسب الفئة:",-1)),e("button",{onClick:t[0]||(t[0]=i=>S(null)),disabled:f.value||b.value,class:K(["px-4 py-1.5 rounded-full text-sm font-medium transition-colors duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-900 focus:ring-olive-green disabled:opacity-50 disabled:cursor-not-allowed",d.value===null?"bg-olive-green text-white shadow":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"])}," كل الفئات ",10,He),(r(!0),l(D,null,Q(p.value,i=>(r(),l("button",{key:i.id,onClick:j=>S(i.id),disabled:f.value||b.value,class:K(["px-4 py-1.5 rounded-full text-sm font-medium transition-colors duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-900 focus:ring-olive-green disabled:opacity-50 disabled:cursor-not-allowed",d.value===i.id?"bg-olive-green text-white shadow":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"])},M(i.name),11,Ee))),128)),A.value?(r(),l("div",Fe,"جار تحميل الفئات...")):u("",!0),T.value?(r(),l("div",Se,"خطأ تحميل الفئات.")):u("",!0)])]),f.value?(r(),l("div",je,t[4]||(t[4]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-olive-green"},null,-1),e("p",{class:"mt-4 text-gray-600 dark:text-gray-400"},"جارٍ تحميل الكتب...",-1)]))):h.value&&c.value.length===0?(r(),l("div",Ze,[t[6]||(t[6]=e("p",{class:"text-red-600 dark:text-red-400 font-semibold mb-2 text-lg"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-6 h-6 inline-block align-middle me-1","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-8-5a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-1.5 0v-4.5A.75.75 0 0 1 10 5Zm0 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z","clip-rule":"evenodd"})]),V(" حدث خطأ أثناء تحميل المكتبة. ")],-1)),h.value.message?(r(),l("pre",Le,M(h.value.message),1)):u("",!0),e("button",{onClick:ee,class:"mt-6 px-5 py-2 bg-olive-green text-white rounded hover:bg-opacity-80 transition-colors text-sm font-medium"},t[5]||(t[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-4 h-4 inline-block align-middle me-1"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})],-1),V(" إعادة المحاولة ")]))])):!f.value&&c.value.length===0?(r(),l("div",Ne,[g.value||d.value!==null?(r(),l("div",Oe,[t[7]||(t[7]=e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-12 h-12 mb-4 mx-auto text-gray-400 dark:text-gray-500"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})],-1)),t[8]||(t[8]=e("p",{class:"text-lg"},"لم يتم العثور على نتائج تطابق بحثك أو الفلتر المطبق.",-1)),g.value?(r(),l("p",qe,"حاول تبسيط كلمات البحث أو تغيير الفئة.")):u("",!0),d.value!==null||g.value?(r(),l("button",{key:1,onClick:te,class:"mt-4 text-sm text-olive-green hover:underline"}," عرض كل الكتب ")):u("",!0)])):(r(),l("div",Ke,t[9]||(t[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-12 h-12 mb-4 mx-auto text-gray-400 dark:text-gray-500","aria-hidden":"true"},[e("path",{d:"M11.25 4.533A9.707 9.707 0 0 0 6 3a9.735 9.735 0 0 0-3.25.555.75.75 0 0 0-.5.707v14.25a.75.75 0 0 0 .5.707A9.735 9.735 0 0 0 6 21a9.707 9.707 0 0 0 5.25-1.533v-1.27a.75.75 0 0 0-.624-.744A8.25 8.25 0 0 1 6 18.75a8.25 8.25 0 0 1-5.25-2.268v-2.156a.75.75 0 0 0 .51-.698A8.217 8.217 0 0 1 6 13.5a8.182 8.182 0 0 1 5.25 1.406v-1.406a8.182 8.182 0 0 1-5.25 1.406 8.217 8.217 0 0 1-4.74-.954.75.75 0 0 0-.51-.698V9.732a8.25 8.25 0 0 1 5.25-2.268 8.25 8.25 0 0 1 5.25 2.268V9.376a.75.75 0 0 0 .624.744v1.27ZM12.75 4.533A9.707 9.707 0 0 1 18 3a9.735 9.735 0 0 1 3.25.555.75.75 0 0 1 .5.707v14.25a.75.75 0 0 1-.5.707A9.735 9.735 0 0 1 18 21a9.707 9.707 0 0 1-5.25-1.533v-1.27a.75.75 0 0 1 .624-.744A8.25 8.25 0 0 0 18 18.75a8.25 8.25 0 0 0 5.25-2.268v-2.156a.75.75 0 0 1-.51-.698A8.217 8.217 0 0 0 18 13.5a8.182 8.182 0 0 0-5.25 1.406v-1.406a8.182 8.182 0 0 0 5.25 1.406 8.217 8.217 0 0 0 4.74-.954.75.75 0 0 1 .51-.698V9.732a8.25 8.25 0 0 0-5.25-2.268 8.25 8.25 0 0 0-5.25 2.268V9.376a.75.75 0 0 1-.624.744v1.27Z"})],-1),e("p",{class:"text-lg"},"المكتبة فارغة حاليًا.",-1)])))])):(r(),l("div",De,[(r(!0),l(D,null,Q(c.value,i=>(r(),G(Ve,{key:i.id,book:i,onOpenPdf:oe},null,8,["book"]))),128))])),e("div",{ref_key:"infiniteScrollTrigger",ref:y,class:"h-10 flex justify-center items-center mt-10"},[b.value?(r(),l("div",Qe,t[10]||(t[10]=[e("svg",{class:"animate-spin h-5 w-5 text-olive-green",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),e("span",null,"جارٍ تحميل المزيد...",-1)]))):!f.value&&c.value.length>0&&w.value?(r(),l("div",Ue," ~ نهاية القائمة ~ ")):h.value&&c.value.length>0?(r(),l("div",Ge," حدث خطأ أثناء تحميل المزيد. ")):u("",!0)],512),R(ue,{show:I.value,"storage-path":H.value,"book-title":E.value,onClose:re},null,8,["show","storage-path","book-title"])]))}}),at=W(Je,[["__scopeId","data-v-aac0eec2"]]);export{at as default};
