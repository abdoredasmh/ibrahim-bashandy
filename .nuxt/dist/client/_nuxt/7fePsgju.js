import{_ as R}from"./CEyFpblA.js";import{L as S}from"./CpjGp_h0.js";import{e as O,g as A,p as Z,w as y,h,o as a,b as v,a as s,d as M,t as c,n as E,_ as F,u as z,r as d,k as Y,m as U,c as i,F as J,j as K,i as j}from"./CaF1xe-H.js";import{h as I,G as Q,V as W,Y as X,S as ee}from"./vWwLff75.js";import{u as te}from"./C0vmt3Ib.js";const se={class:"fixed inset-0 overflow-y-auto"},re={class:"flex min-h-full items-center justify-center p-4 text-center"},ae={class:"mt-2"},oe={class:"text-sm text-gray-600 dark:text-gray-300 whitespace-pre-line"},ne={class:"mt-6 pt-4 border-t dark:border-gray-600 flex flex-col-reverse sm:flex-row sm:justify-start sm:space-x-3 sm:space-x-reverse gap-3"},le=O({__name:"ConfirmationModal",props:{isOpen:{type:Boolean,required:!0},title:{type:String,default:"تأكيد الإجراء"},message:{type:String,required:!0},confirmButtonText:{type:String,default:"تأكيد"},cancelButtonText:{type:String,default:"إلغاء"},confirmButtonVariant:{type:String,default:"danger"}},emits:["confirm","cancel"],setup(m,{emit:k}){const o=m,u=k,b=()=>{u("confirm")},g=()=>{u("cancel")},f=A(()=>{switch(o.confirmButtonVariant){case"danger":return"bg-red-600 text-white hover:bg-red-700 focus-visible:ring-red-500 border-transparent shadow-sm";case"primary":return"bg-primary-600 text-white hover:bg-primary-700 focus-visible:ring-primary-500 border-transparent shadow-sm";case"success":return"bg-green-600 text-white hover:bg-green-700 focus-visible:ring-green-500 border-transparent shadow-sm";default:return"bg-red-600 text-white hover:bg-red-700 focus-visible:ring-red-500 border-transparent shadow-sm"}}),_=A(()=>"bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600 focus-visible:ring-gray-500 shadow-sm");return(C,l)=>(a(),Z(h(ee),{appear:"",show:m.isOpen,as:"template"},{default:y(()=>[v(h(X),{as:"div",onClose:g,class:"relative z-50"},{default:y(()=>[v(h(I),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:y(()=>l[0]||(l[0]=[s("div",{class:"fixed inset-0 bg-black/60 backdrop-blur-sm","aria-hidden":"true"},null,-1)])),_:1}),s("div",se,[s("div",re,[v(h(I),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:y(()=>[v(h(Q),{class:"w-full max-w-md transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 p-6 text-right shadow-xl transition-all space-y-5 border dark:border-gray-700"},{default:y(()=>[v(h(W),{as:"h3",class:"text-lg font-semibold leading-6 text-gray-900 dark:text-gray-100 border-b dark:border-gray-600 pb-3 flex items-center"},{default:y(()=>[l[1]||(l[1]=s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6 me-2 text-red-600 dark:text-red-400"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"})],-1)),M(" "+c(m.title),1)]),_:1}),s("div",ae,[s("p",oe,c(m.message),1)]),s("div",ne,[s("button",{type:"button",onClick:b,class:E(["button-base w-full sm:w-auto justify-center",f.value])},c(m.confirmButtonText),3),s("button",{type:"button",onClick:g,class:E(["button-base w-full sm:w-auto justify-center",_.value]),ref:"cancelButtonRef"},c(m.cancelButtonText),3)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}}),ie=F(le,[["__scopeId","data-v-b0ec62f0"]]),de={class:"p-4 sm:p-6"},ce={key:0,class:"text-center py-10"},ue={key:1,class:"error-box"},ge={class:"mt-2 text-sm"},fe={key:2,class:"text-center py-10 bg-gray-50 dark:bg-gray-800 rounded-lg"},ve={key:3,class:"space-y-4"},me={class:"flex items-start justify-between mb-2"},pe={class:"flex items-center space-x-3 rtl:space-x-reverse"},xe=["src"],ye={class:"text-sm font-semibold text-gray-800 dark:text-gray-200"},be={class:"text-xs text-gray-500 dark:text-gray-400"},he={key:0,class:"mx-1"},_e={class:"flex items-center space-x-2 rtl:space-x-reverse flex-shrink-0"},we=["onClick","disabled"],ke={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},Ce={class:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},$e={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},L=30,Be=O({__name:"comments",setup(m){const k=z(),o=d([]),u=d(!1),b=d(null),g=d(!1),f=d(!0),_=d(0),C=d(null);let l=null;const $=d(!1),B=d(null),D=async(e=!1)=>{if(e&&(u.value=!0,b.value=null,_.value=0,o.value=[],f.value=!0),g.value||!f.value)return;g.value=!0,e||(u.value=!1);const t=_.value,n=t*L,r=n+L-1;console.log(`Loading comments page ${t+1} (Range: ${n}-${r})`);try{const{data:p,error:w}=await k.from("comments").select(`
        *,
        profiles ( full_name, avatar_url ),
        lessons ( id, title ),
        books ( id, title ),
        study_courses ( id, title )
      `).order("created_at",{ascending:!1}).range(n,r);if(w)throw w;const x=p??[];console.log(`Fetched ${x.length} new comments.`),e?o.value=x:o.value.push(...x),f.value=x.length===L,_.value+=1}catch(p){console.error("Error loading comments:",p),b.value=p,f.value=!1}finally{g.value=!1,e&&(u.value=!1)}},N=()=>{l&&l.disconnect();const e={rootMargin:"0px 0px 200px 0px"};l=new IntersectionObserver(t=>{t[0].isIntersecting&&!g.value&&f.value&&D()},e),C.value&&l.observe(C.value)};Y(()=>{D(!0),N()}),U(()=>{l&&l.disconnect()});const H=()=>{D(!0)},P=e=>{},T=e=>{var t,n,r;return e.lesson_id&&((t=e.lessons)!=null&&t.title)?{to:`/lessons/${e.lesson_id}`,text:`درس: ${e.lessons.title}`}:e.book_id&&((n=e.books)!=null&&n.title)?{to:`/books?open=${e.book_id}`,text:`كتاب: ${e.books.title}`}:e.study_course_id&&((r=e.study_courses)!=null&&r.title)?{to:`/study/courses/${e.study_course_id}`,text:`دورة: ${e.study_courses.title}`}:null},q=e=>{B.value=e,$.value=!0},G=async()=>{if(!B.value)return;const e=B.value;e.isDeleting=!0,$.value=!1;try{console.log(`Deleting comment ${e.id}...`);const{error:t}=await k.from("comments").delete().eq("id",e.id);if(t)throw t;console.log(`Comment ${e.id} deleted successfully.`),o.value=o.value.filter(n=>n.id!==e.id)}catch(t){console.error(`Error deleting comment ${e.id}:`,t),alert(`فشل حذف التعليق: ${t.message}`),e.isDeleting=!1}finally{B.value=null;const t=o.value.find(n=>n.id===e.id);t&&(t.isDeleting=!1)}};return te({title:"إدارة التعليقات"}),(e,t)=>{const n=R;return a(),i("div",de,[t[6]||(t[6]=s("h1",{class:"text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-6"},"إدارة التعليقات",-1)),u.value&&o.value.length===0?(a(),i("div",ce,[v(S),t[1]||(t[1]=s("p",{class:"mt-3 text-gray-500 dark:text-gray-400"},"جارٍ تحميل التعليقات...",-1))])):b.value?(a(),i("div",ue,[t[2]||(t[2]=s("p",null,"حدث خطأ أثناء تحميل التعليقات:",-1)),s("pre",ge,c(b.value.message),1),s("button",{onClick:H,class:"button-secondary mt-4"},"إعادة المحاولة")])):o.value.length===0&&!u.value?(a(),i("div",fe,t[3]||(t[3]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-12 h-12 mx-auto text-gray-400"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12a9.008 9.008 0 0 1-9.887 8.554c-1.197.449-2.52.696-3.888.696C3.04 21.25 0 17.556 0 13c0-4.063 2.368-7.568 5.88-9.105a.75.75 0 0 1 .92.841 8.41 8.41 0 0 0 .454 2.351 .75.75 0 0 1-.687 1.342 9.903 9.903 0 0 1-.547-1.932A8.91 8.91 0 0 0 3.04 13c0 3.54 2.468 6.5 5.88 7.105v-1.05a1.482 1.482 0 0 1 1.488-1.48l.06-.004a8.4 8.4 0 0 0 4.986-7.412 8.36 8.36 0 0 0-.085-1.113.75.75 0 0 1 1.47-.29 9.86 9.86 0 0 1 .053.516c0 2.398-1.054 4.56-2.792 6.056l-.06.004a1.482 1.482 0 0 1-1.488 1.48v1.05c0 .33.116.643.31.887.71.865 1.617 1.568 2.662 2.082A9.008 9.008 0 0 0 21 13a8.91 8.91 0 0 0-2.12-5.88.75.75 0 1 1 1.06-1.061A10.41 10.41 0 0 1 21 13Z"})],-1),s("p",{class:"mt-3 font-medium text-gray-700 dark:text-gray-300"},"لا توجد تعليقات لعرضها حالياً.",-1)]))):(a(),i("div",ve,[(a(!0),i(J,null,K(o.value,r=>{var p,w,x;return a(),i("div",{key:r.id,class:E(["bg-white dark:bg-gray-800 p-4 rounded-lg shadow border dark:border-gray-700 relative",{"opacity-50":r.isDeleting}])},[s("div",me,[s("div",pe,[s("img",{src:((p=r.profiles)==null?void 0:p.avatar_url)||"/images/default-avatar.png",alt:"صورة المستخدم",class:"w-8 h-8 rounded-full object-cover bg-gray-200 dark:bg-gray-600"},null,8,xe),s("div",null,[s("p",ye,c(((w=r.profiles)==null?void 0:w.full_name)??"مستخدم غير معروف"),1),s("p",be,[M(c(P(r.created_at))+" ",1),T(r)?(a(),i("span",he,[t[4]||(t[4]=M(" - على: ")),v(n,{to:((x=T(r))==null?void 0:x.to)||"#",class:"text-primary hover:underline"},{default:y(()=>{var V;return[M(c(((V=T(r))==null?void 0:V.text)||"منشور"),1)]}),_:2},1032,["to"])])):j("",!0)])])]),s("div",_e,[s("button",{onClick:V=>q(r),disabled:r.isDeleting,class:"p-1 rounded text-red-500 hover:bg-red-100 dark:hover:bg-red-900/50 hover:text-red-700 transition-colors",title:"حذف التعليق"},[r.isDeleting?(a(),Z(S,{key:0,class:"w-4 h-4"})):(a(),i("svg",ke,t[5]||(t[5]=[s("path",{"fill-rule":"evenodd",d:"M8.75 1A2.75 2.75 0 0 0 6 3.75v.443c-.795.077-1.58.22-2.325.418C2.38 4.97 1.5 5.647 1.5 6.5V17a3 3 0 0 0 3 3h11a3 3 0 0 0 3-3V6.5c0-.853-.88-1.53-2.175-1.889a48.47 48.47 0 0 0-2.325-.418v-.443A2.75 2.75 0 0 0 11.25 1h-2.5ZM10 4c.84 0 1.5.66 1.5 1.5v1.5c0 .84-.66 1.5-1.5 1.5s-1.5-.66-1.5-1.5V5.5C8.5 4.66 9.16 4 10 4ZM4.5 6.5c0-.132.015-.26.043-.386a.75.75 0 0 1 .914-.551 47.14 47.14 0 0 1 8.999.171.75.75 0 0 1 .914.55c.028.127.043.255.043.386V17a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 4.5 17V6.5Z","clip-rule":"evenodd"},null,-1)])))],8,we)])]),s("p",Ce,c(r.content),1)],2)}),128)),s("div",{ref_key:"scrollTrigger",ref:C,class:"h-10 flex justify-center items-center"},[g.value?(a(),Z(S,{key:0,class:"w-6 h-6 text-primary"})):j("",!0),!f.value&&o.value.length>0?(a(),i("span",$e,"لا توجد تعليقات أخرى.")):j("",!0)],512)])),v(ie,{isOpen:$.value,title:"تأكيد الحذف",message:"هل أنت متأكد من حذف هذا التعليق؟ لا يمكن التراجع عن هذا الإجراء.",confirmButtonText:"نعم، حذف",cancelButtonText:"إلغاء",onConfirm:G,onCancel:t[0]||(t[0]=r=>$.value=!1)},null,8,["isOpen"])])}}}),je=F(Be,[["__scopeId","data-v-05b8aed2"]]);export{je as default};
