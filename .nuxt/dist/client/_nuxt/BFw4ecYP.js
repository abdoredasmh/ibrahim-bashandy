import{_ as N}from"./CEyFpblA.js";import{e as D,u as L,g as h,r as w,f as P,l as U,c as r,b as _,h as s,a as e,t as x,w as V,p as S,i as c,d as H,U as j,V as k,o,_ as q}from"./CaF1xe-H.js";import{L as z}from"./CpjGp_h0.js";import{_ as F}from"./BFvDSq9n.js";import R from"./CgliSXAb.js";import{u as T}from"./CqvecxAQ.js";import{u as G}from"./C0vmt3Ib.js";import"./Cjm1-dYk.js";import"./Bqepao4b.js";import"./DhpZqJBn.js";import"./C2nUyU-9.js";import"./vWwLff75.js";const J={class:"container mx-auto px-4 py-8"},K={key:0,class:"text-center py-20"},O={key:1,class:"text-center py-20"},Q={key:0,class:"text-2xl font-semibold text-red-600 dark:text-red-400 mb-4"},W={key:1,class:"text-2xl font-semibold text-red-600 dark:text-red-400 mb-4"},X={class:"text-gray-600 dark:text-gray-400 mb-6"},Y={key:2,class:"book-details"},e0={class:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-8"},t0={class:"md:col-span-1"},a0={class:"relative aspect-[3/4] bg-cream-gray dark:bg-gray-700 flex items-center justify-center rounded-lg shadow-md overflow-hidden"},s0=["src","alt"],o0={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"text-8xl text-gray-400 dark:text-gray-500 w-24 h-24","aria-hidden":"true"},r0={class:"absolute top-3 start-3 flex gap-2"},l0={key:0,class:"badge bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300 shadow"},n0={key:1,class:"badge bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 shadow"},i0={class:"mt-4 flex flex-col space-y-2"},d0=["href"],c0={key:2,class:"text-center text-sm text-red-500 dark:text-red-400 mt-2"},u0={class:"md:col-span-2"},p0={class:"text-3xl font-bold text-brown-dark dark:text-brown-dark mb-4"},g0={key:0,class:"mb-4"},m0={key:1,class:"prose prose-lg dark:prose-invert max-w-none text-gray-700 dark:text-gray-300"},_0={class:"whitespace-pre-wrap"},v0={key:2,class:"text-gray-500 dark:text-gray-400 italic"},f0=D({__name:"[id]",async setup(h0){let p,b;const y=L(),M=j(),i=h(()=>{const l=+M.params.id;return isNaN(l)||l<=0?-1:l}),A=h(()=>i.value>0),v=w(!1),f=w(!1),g=w(null);function E(){console.warn(`Failed to load cover image for book ID ${i.value}`),v.value=!0}function $(){f.value=!0}function I(){f.value=!1}const{data:t,pending:C,error:m,refresh:w0}=([p,b]=P(async()=>T(`book-${i.value}`,async()=>{if(!A.value)throw console.error("Invalid Book ID from route:",M.params.id),k({statusCode:400,statusMessage:"معرف الكتاب غير صالح."});const{data:l,error:a}=await y.from("books").select("*").eq("id",i.value).maybeSingle();if(a)throw console.error(`Error fetching book ID ${i.value}:`,a),k({statusCode:500,statusMessage:`فشل تحميل الكتاب: ${a.message}`});if(!l)throw k({statusCode:404,statusMessage:"الكتاب المطلوب غير موجود."});if(g.value=null,l.storage_path)try{const n="book-files",{data:d,error:u}=await y.storage.from(n).getPublicUrl(l.storage_path);if(u)throw u;g.value=d.publicUrl}catch(n){console.error(`Failed to get public download URL for ${l.storage_path}:`,n.message||n)}return l},{watch:[i]})),p=await p,b(),p);return U(t,l=>{v.value=!1}),G(h(()=>{var l,a,n,d;return{title:((l=t.value)==null?void 0:l.title)??(C.value?"تحميل...":m.value?"خطأ":"تفاصيل الكتاب"),meta:[{name:"description",content:((n=(a=t.value)==null?void 0:a.description)==null?void 0:n.substring(0,150))||`تفاصيل ومعلومات عن ${((d=t.value)==null?void 0:d.title)||"الكتاب المطلوب"}`}]}})),(l,a)=>{var d,u,Z,B;const n=N;return o(),r("div",J,[s(C)?(o(),r("div",K,[_(z),a[0]||(a[0]=e("p",{class:"mt-4 text-gray-600 dark:text-gray-400"},"جارٍ تحميل بيانات الكتاب...",-1))])):s(m)||!s(t)?(o(),r("div",O,[((d=s(m))==null?void 0:d.statusCode)===404?(o(),r("h2",Q," الكتاب غير موجود ")):(o(),r("h2",W," حدث خطأ ")),e("p",X,x(((u=s(m))==null?void 0:u.statusMessage)||"لم نتمكن من العثور على الكتاب المطلوب أو حدث خطأ أثناء تحميله."),1),_(n,{to:"/books",class:"button-primary"},{default:V(()=>a[1]||(a[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5 ms-2","aria-hidden":"true"},[e("title",null,"العودة"),e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm-.75-4.75a.75.75 0 0 0 0 1.5h4.59l-2.1 1.95a.75.75 0 1 0 1.02 1.1l3.5-3.25a.75.75 0 0 0 0-1.1l-3.5-3.25a.75.75 0 1 0-1.02 1.1l2.1 1.95H9.25a.75.75 0 0 0 0 1.5Z","clip-rule":"evenodd"})],-1),e("span",null,"العودة إلى المكتبة",-1)])),_:1})])):(o(),r("div",Y,[e("div",e0,[e("div",t0,[e("div",a0,[a[3]||(a[3]=H(" {/* Added aspect ratio */} ")),s(t).cover_image_url&&!v.value?(o(),r("img",{key:0,src:s(t).cover_image_url,alt:`غلاف ${s(t).title}`,class:"w-full h-full object-contain",loading:"lazy",decoding:"async",onError:E},null,40,s0)):(o(),r("svg",o0,a[2]||(a[2]=[e("title",null,"غلاف كتاب بديل",-1),e("path",{d:"M11.25 4.533A9.707 9.707 0 0 0 6 3a9.735 9.735 0 0 0-3.25.555.75.75 0 0 0-.5.707v14.25a.75.75 0 0 0 .5.707A9.735 9.735 0 0 0 6 21a9.707 9.707 0 0 0 5.25-1.533v-1.27a.75.75 0 0 0-.624-.744A8.25 8.25 0 0 1 6 18.75a8.25 8.25 0 0 1-5.25-2.268v-2.156a.75.75 0 0 0 .51-.698A8.217 8.217 0 0 1 6 13.5a8.182 8.182 0 0 1 5.25 1.406v-1.406a8.182 8.182 0 0 1-5.25 1.406 8.217 8.217 0 0 1-4.74-.954.75.75 0 0 0-.51-.698V9.732a8.25 8.25 0 0 1 5.25-2.268 8.25 8.25 0 0 1 5.25 2.268V9.376a.75.75 0 0 0 .624.744v1.27ZM12.75 4.533A9.707 9.707 0 0 1 18 3a9.735 9.735 0 0 1 3.25.555.75.75 0 0 1 .5.707v14.25a.75.75 0 0 1-.5.707A9.735 9.735 0 0 1 18 21a9.707 9.707 0 0 1-5.25-1.533v-1.27a.75.75 0 0 1 .624-.744A8.25 8.25 0 0 0 18 18.75a8.25 8.25 0 0 0 5.25-2.268v-2.156a.75.75 0 0 1-.51-.698A8.217 8.217 0 0 0 18 13.5a8.182 8.182 0 0 0-5.25 1.406v-1.406a8.182 8.182 0 0 0 5.25 1.406 8.217 8.217 0 0 0 4.74-.954.75.75 0 0 1 .51-.698V9.732a8.25 8.25 0 0 0-5.25-2.268 8.25 8.25 0 0 0-5.25 2.268V9.376a.75.75 0 0 1-.624.744v1.27Z"},null,-1)]))),e("div",r0,[s(t).is_research?(o(),r("span",l0," بحث ")):c("",!0),s(t).is_transcript?(o(),r("span",n0," تفريغ ")):c("",!0)])]),e("div",i0,[s(t).storage_path?(o(),r("button",{key:0,type:"button",onClick:$,class:"button-primary w-full"},a[4]||(a[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5 me-2","aria-hidden":"true"},[e("title",null,"عرض بالموقع"),e("path",{d:"M10 12.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z"}),e("path",{"fill-rule":"evenodd",d:"M.664 10.59a1.651 1.651 0 0 1 0-1.18l.879-.879a.75.75 0 0 1 1.06 0l.879.879A1.651 1.651 0 0 1 3.482 10c0 .311.102.613.284.879l-.879.879a.75.75 0 0 1-1.06 0l-.879-.879A1.651 1.651 0 0 1 .664 10.59ZM19.336 9.41a1.651 1.651 0 0 1 0 1.18l-.879.879a.75.75 0 0 1-1.06 0l-.879-.879A1.651 1.651 0 0 1 16.518 10c0-.311-.102-.613-.284-.879l.879-.879a.75.75 0 0 1 1.06 0l.879.879A1.651 1.651 0 0 1 19.336 9.41Z","clip-rule":"evenodd"}),e("path",{"fill-rule":"evenodd",d:"M10 17a7 7 0 1 0 0-14 7 7 0 0 0 0 14Zm-5.017-9.836a.75.75 0 0 1 1.06 0l.879.879a4.652 4.652 0 0 1 6.156 0l.879-.879a.75.75 0 1 1 1.06 1.06l-.879.879a4.652 4.652 0 0 1-6.156 0l-.879-.879a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})],-1),e("span",null,"عرض الكتاب بالموقع",-1)]))):c("",!0),g.value?(o(),r("a",{key:1,href:g.value,target:"_blank",download:"",class:"button-secondary w-full",rel:"noopener noreferrer"},a[5]||(a[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5 me-2","aria-hidden":"true"},[e("title",null,"تنزيل"),e("path",{d:"M10.75 2.75a.75.75 0 0 0-1.5 0v8.614L6.295 8.235a.75.75 0 1 0-1.09 1.03l4.25 4.5a.75.75 0 0 0 1.09 0l4.25-4.5a.75.75 0 0 0-1.09-1.03l-2.955 3.129V2.75Z"}),e("path",{d:"M3.5 12.75a.75.75 0 0 0-1.5 0v2.5A2.75 2.75 0 0 0 4.75 18h10.5A2.75 2.75 0 0 0 18 15.25v-2.5a.75.75 0 0 0-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5Z"})],-1),e("span",null,"تنزيل الملف",-1)]),8,d0)):c("",!0),s(t).storage_path?c("",!0):(o(),r("p",c0," ملف الكتاب غير متاح حاليًا للعرض أو التنزيل. "))])]),e("div",u0,[e("h1",p0,x(s(t).title),1),s(t).is_transcript&&s(t).linked_lesson_id?(o(),r("div",g0,[_(n,{to:`/lessons/${s(t).linked_lesson_id}`,class:"inline-flex items-center text-sm font-medium text-golden-calm hover:underline focus:outline-none focus:ring-2 focus:ring-golden-calm focus:ring-offset-2 dark:focus:ring-offset-gray-900 rounded"},{default:V(()=>a[6]||(a[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-4 h-4 me-1","aria-hidden":"true"},[e("title",null,"رابط"),e("path",{d:"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.665l3-3Z"}),e("path",{d:"M8.603 17.007a4 4 0 0 0 5.656-5.656l-3-3a4 4 0 0 0-5.865-.225.75.75 0 0 0 1.138.977 2.5 2.5 0 0 1 3.665.142l3 3a2.5 2.5 0 0 1-3.536 3.536l-1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 0 0 5.656 5.656Z"})],-1),e("span",null,"هذا تفريغ للدرس - اضغط هنا لعرض الدرس الأصلي",-1)])),_:1},8,["to"])])):c("",!0),s(t).description?(o(),r("div",m0,[e("p",_0,x(s(t).description),1)])):(o(),r("p",v0," لا يوجد وصف متاح لهذا الكتاب. "))])]),A.value&&s(t)?(o(),S(F,{key:0,"book-id":i.value},null,8,["book-id"])):c("",!0)])),_(R,{show:f.value,"storage-path":((Z=s(t))==null?void 0:Z.storage_path)||null,"book-title":((B=s(t))==null?void 0:B.title)||"عرض الكتاب",onClose:I},null,8,["show","storage-path","book-title"])])}}}),I0=q(f0,[["__scopeId","data-v-e8bc791c"]]);export{I0 as default};
