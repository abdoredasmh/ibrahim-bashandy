import{e as P,r as u,g as W,c as n,o as r,b as Y,w as U,a as t,t as v,_ as H,u as Q,k as J,m as K,i as g,n as D,F as A,j as V,d as M,x as X,a8 as ee,p as te}from"./CaF1xe-H.js";import{_ as oe}from"./CEyFpblA.js";import{u as se}from"./C0vmt3Ib.js";const re={class:"bg-white dark:bg-gray-800 rounded-lg shadow border border-cream-gray dark:border-gray-700/50 overflow-hidden group transition-shadow duration-300 hover:shadow-lg"},ne={class:"aspect-video bg-black flex items-center justify-center relative overflow-hidden"},le=["src","alt"],ae={key:1,class:"absolute inset-0 flex items-center justify-center bg-gray-200 dark:bg-gray-700"},ie={class:"p-4"},de={class:"font-semibold text-lg mb-1 line-clamp-2 text-brown-dark dark:text-beige-light group-hover/link:text-olive-green transition-colors duration-200"},ue={class:"text-sm text-gray-600 dark:text-gray-400 line-clamp-3"},ce=P({__name:"LessonCard",props:{lesson:{type:Object,required:!0}},setup(x){const y=x,b=u(!1),w=d=>{if(!d)return null;try{const a=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:watch\?v=|embed\/|v\/|.+\?v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/,i=d.match(a);return i&&i[1]?i[1]:null}catch(a){return console.error("Error processing YouTube URL:",d,a),null}},f=W(()=>w(y.lesson.youtube_url)),l=()=>{console.warn(`Failed to load YouTube thumbnail for video ID: ${f.value}`),b.value=!0};return(d,a)=>{const i=oe;return r(),n("div",re,[Y(i,{to:`/lessons/${x.lesson.id}`,class:"block group/link"},{default:U(()=>[t("div",ne,[f.value&&!b.value?(r(),n("img",{key:0,src:`https://img.youtube.com/vi/${f.value}/hqdefault.jpg`,alt:`صورة مصغرة لدرس: ${x.lesson.title}`,class:"w-full h-full object-cover transition-transform duration-300 group-hover/link:scale-105",loading:"lazy",decoding:"async",onError:l},null,40,le)):(r(),n("div",ae,a[0]||(a[0]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-12 h-12 text-gray-400 dark:text-gray-500",fill:"currentColor","aria-hidden":"true"},[t("path",{d:"M10,15L15,12L10,9V15M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3Z"})],-1)]))),a[1]||(a[1]=t("div",{class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-20 group-hover/link:bg-opacity-40 transition-opacity duration-300 opacity-0 group-hover/link:opacity-100"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"w-12 h-12 text-white drop-shadow-lg transform transition-transform duration-300 group-hover/link:scale-110",fill:"currentColor","aria-hidden":"true"},[t("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"})])],-1))]),t("div",ie,[t("h3",de,v(x.lesson.title),1),t("p",ue,v(x.lesson.description||"لا يوجد وصف للفديو"),1)])]),_:1},8,["to"])])}}}),ge=H(ce,[["__scopeId","data-v-640cfe80"]]),ve={class:"container mx-auto px-10"},me={class:"mb-8"},fe={class:"flex flex-wrap items-center gap-2 border-b border-gray-200 dark:border-gray-700 pb-4"},he=["onClick"],xe={key:0,class:"text-sm text-gray-500"},ye={key:1,class:"text-sm text-red-500"},be={key:0,class:"text-center py-10"},pe={class:"mt-4 text-gray-600 dark:text-gray-400"},ke={key:1,class:"text-center py-10 px-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg max-w-2xl mx-auto"},we={class:"text-red-600 dark:text-red-400 font-semibold mb-2 text-lg"},_e={key:0,class:"mt-1 text-xs text-left bg-red-100 dark:bg-red-800/30 p-2 rounded border border-red-200 dark:border-red-700 text-red-700 dark:text-red-300 whitespace-pre-wrap"},Le={key:2,class:"space-y-12"},Ce={class:"text-2xl font-semibold mb-4 text-brown-dark dark:text-beige-light border-b border-gray-300 dark:border-gray-700 pb-2"},$e={class:"text-sm font-normal text-gray-500 dark:text-gray-400 ms-2"},Me={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-4 gap-y-6"},Ee={key:1,class:"text-gray-500 dark:text-gray-400 mt-4"},Se={key:2,class:"mt-6 text-center"},Fe=["onClick","disabled"],Ae={key:0},Ve={key:1},je={key:3,class:"mt-2 text-center text-sm text-red-600 dark:text-red-400"},Be={key:0,class:"text-center py-6"},Ie={key:0,class:"text-center py-6 text-gray-500 dark:text-gray-400"},Ne={key:1,class:"text-center py-6 text-red-600 dark:text-red-400"},Te={key:3,class:"text-center py-16 text-gray-500 dark:text-gray-400"},De={class:"text-lg"},Pe=8,He=12,j=5,Oe=P({__name:"index",setup(x){const y=Q(),b=u([]),w=u(!1),f=u(null),l=u(null),d=u([]),a=u(!0),i=u(null),_=u(1),L=u(!1),p=u(!1),O=async()=>{w.value=!0,f.value=null;try{const{data:o,error:e}=await y.from("categories").select("id, name").order("name",{ascending:!0});if(e)throw e;b.value=o||[],console.log("Filter categories loaded:",b.value)}catch(o){console.error("Error fetching filter categories:",o),f.value=o}finally{w.value=!1}},B=async(o=1,e=null)=>{console.log(`Fetching data. Page: ${o}, Selected Category ID: ${e}`);const s=(o-1)*j,m=s+j-1;let c=y.from("categories").select("id, name");e!==null?(c=c.eq("id",e),console.log(`Fetching specific category: ${e}`)):(c=c.order("created_at",{ascending:!1}).range(s,m),console.log(`Fetching category page ${o} (range ${s}-${m})`));const{data:h,error:I}=await c;if(I)throw I;if(!h||h.length===0)return e!==null?(console.warn(`Filtered category ${e} not found.`),[]):(console.log("No more categories found for pagination."),p.value=!0,[]);console.log(`Fetched ${h.length} categories. Fetching lessons and counts...`);const R=h.map(async k=>{try{const{data:F,error:N,count:Z}=await y.from("lessons").select("id, title, description, youtube_url, created_at",{count:"exact"}).eq("category_id",k.id).is("course_id",null).order("created_at",{ascending:!1}).limit(Pe);if(N)return console.error(`Error fetching initial lessons for category ${k.id}:`,N),{...k,lessons:[],totalLessonsCount:0,loadedLessonsCount:0,isLoadingMoreLessons:!1,errorLoadingMore:!0};const G=Z??0,T=F||[];return{...k,lessons:T,totalLessonsCount:G,loadedLessonsCount:T.length,isLoadingMoreLessons:!1,errorLoadingMore:!1}}catch(F){return console.error(`Failed processing category ${k.id}:`,F),{...k,lessons:[],totalLessonsCount:0,loadedLessonsCount:0,isLoadingMoreLessons:!1,errorLoadingMore:!0}}});return await Promise.all(R)},z=async o=>{const e=d.value.find(s=>s.id===o);if(!(!e||e.isLoadingMoreLessons||e.loadedLessonsCount>=e.totalLessonsCount)){console.log(`Loading more lessons for category ${o}...`),e.isLoadingMoreLessons=!0,e.errorLoadingMore=!1;try{const s=e.loadedLessonsCount,m=s+He-1,{data:c,error:h}=await y.from("lessons").select("id, title, description, youtube_url, created_at").eq("category_id",e.id).is("course_id",null).order("created_at",{ascending:!1}).range(s,m);if(h)throw h;c&&c.length>0&&(e.lessons.push(...c),e.loadedLessonsCount+=c.length)}catch(s){console.error(`Error loading more lessons for category ${o}:`,s),e.errorLoadingMore=!0}finally{e.isLoadingMoreLessons=!1}}},C=u(null);let $=null;const q=async()=>{if(L.value||p.value||i.value||l.value!==null){console.log("Skipping load more categories (loading, no more, error, or filter active).");return}L.value=!0,i.value=null,console.log("Loading more categories...");try{_.value++;const o=await B(_.value,null);o.length>0&&d.value.push(...o)}catch(o){console.error("Error loading more categories:",o),i.value=o,_.value--}finally{L.value=!1}},E=async()=>{console.log("Refreshing data with selected category:",l.value),a.value=!0,i.value=null,p.value=!1,_.value=1,d.value=[];try{const o=await B(1,l.value);d.value=o,l.value===null&&o.length<j&&(p.value=!0)}catch(o){console.error("Error during data refresh:",o),i.value=o}finally{a.value=!1}},S=o=>{l.value!==o&&(console.log(`Selecting category: ${o===null?"All":o}`),l.value=o,E())};return J(async()=>{await O(),await E(),C.value?($=new IntersectionObserver(o=>{o[0].isIntersecting&&!a.value&&l.value===null&&(console.log("Infinite scroll trigger intersected (All view)!"),q())},{threshold:.1}),$.observe(C.value),console.log("Infinite scroll observer attached.")):console.warn("Infinite scroll trigger element not found on mount.")}),K(()=>{$&&C.value&&($.unobserve(C.value),console.log("Infinite scroll observer disconnected.")),$=null}),se({title:"سلاسل الدروس - موقع الشيخ إبراهيم بشندي",meta:[{name:"description",content:"تصفح واستمع إلى سلاسل الدروس والمحاضرات العامة للشيخ إبراهيم بشندي في مختلف العلوم الشرعية."}]}),(o,e)=>(r(),n("div",ve,[t("div",me,[t("div",fe,[e[2]||(e[2]=t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 ms-2"},"تصفية حسب السلسلة:",-1)),t("button",{onClick:e[0]||(e[0]=s=>S(null)),class:D(["px-4 py-1.5 rounded-full text-sm font-medium transition-colors duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-900 focus:ring-olive-green",l.value===null?"bg-olive-green text-white shadow":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"])}," الكل ",2),(r(!0),n(A,null,V(b.value,s=>(r(),n("button",{key:s.id,onClick:m=>S(s.id),class:D(["px-4 py-1.5 rounded-full text-sm font-medium transition-colors duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-900 focus:ring-olive-green",l.value===s.id?"bg-olive-green text-white shadow":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"])},v(s.name),11,he))),128)),w.value?(r(),n("div",xe,"جار تحميل الفلاتر...")):g("",!0),f.value?(r(),n("div",ye,"خطأ تحميل الفلاتر.")):g("",!0)])]),a.value?(r(),n("div",be,[e[3]||(e[3]=t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-olive-green"},null,-1)),t("p",pe,v(l.value?"جارٍ تحميل دروس السلسلة المختارة...":"جارٍ تحميل السلاسل والدروس..."),1)])):i.value?(r(),n("div",ke,[t("p",we,[e[4]||(e[4]=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-6 h-6 inline-block align-middle me-1","aria-hidden":"true"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-8-5a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-1.5 0v-4.5A.75.75 0 0 1 10 5Zm0 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z","clip-rule":"evenodd"})],-1)),M(" "+v(l.value?"عذرًا، حدث خطأ أثناء تحميل دروس السلسلة.":"عذرًا، حدث خطأ أثناء التحميل الأولي."),1)]),i.value.message?(r(),n("pre",_e,v(i.value.message),1)):g("",!0),t("button",{onClick:E,class:"mt-6 px-5 py-2 bg-olive-green text-white rounded hover:bg-opacity-80 transition-colors text-sm font-medium"},[e[5]||(e[5]=t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-4 h-4 inline-block align-middle me-1"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})],-1)),M(" "+v(l.value?"إعادة تحميل السلسلة":"إعادة المحاولة"),1)])])):d.value&&d.value.length>0?(r(),n("div",Le,[(r(!0),n(A,null,V(d.value,s=>(r(),n("div",{key:s.id,class:"category-section"},[t("h2",Ce,[M(v(s.name)+" ",1),t("span",$e,"("+v(s.totalLessonsCount)+" درس)",1)]),s.lessons&&s.lessons.length>0?(r(),n("div",Me,[(r(!0),n(A,null,V(s.lessons,m=>(r(),te(ge,{key:m.id,lesson:m},null,8,["lesson"]))),128))])):(r(),n("p",Ee,"لا توجد دروس متاحة حاليًا في هذه السلسلة.")),s.loadedLessonsCount<s.totalLessonsCount?(r(),n("div",Se,[t("button",{onClick:m=>z(s.id),disabled:s.isLoadingMoreLessons,class:"text-olive-green hover:underline font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed"},[s.isLoadingMoreLessons?(r(),n("span",Ve,e[7]||(e[7]=[t("div",{class:"inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-olive-green me-1 align-middle"},null,-1),M(" جارٍ التحميل... ")]))):(r(),n("span",Ae,e[6]||(e[6]=[M(" تحميل المزيد من الدروس "),t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",class:"w-4 h-4 inline-block align-middle ms-1"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})],-1)])))],8,Fe)])):g("",!0),s.errorLoadingMore?(r(),n("p",je," حدث خطأ أثناء تحميل المزيد من الدروس. ")):g("",!0)]))),128)),X(t("div",{ref_key:"infiniteScrollTriggerElement",ref:C,class:"h-10 flex justify-center items-center"},[L.value&&!p.value?(r(),n("div",Be,e[8]||(e[8]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-olive-green"},null,-1),t("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-2"},"جارٍ تحميل المزيد من السلاسل...",-1)]))):g("",!0)],512),[[ee,l.value===null]]),p.value&&l.value===null&&!a.value&&!L.value?(r(),n("div",Ie," ~ نهاية قائمة السلاسل ~ ")):g("",!0),i.value&&_.value>1&&l.value===null?(r(),n("div",Ne," حدث خطأ أثناء تحميل المزيد من السلاسل. حاول التمرير للأسفل مرة أخرى. ")):g("",!0)])):!a.value&&(!d.value||d.value.length===0)?(r(),n("div",Te,[e[9]||(e[9]=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-12 h-12 mb-4 mx-auto text-gray-400 dark:text-gray-500","aria-hidden":"true"},[t("path",{d:"M3.41 1.86L2 3.27l4.22 4.22c-.15.19-.22.44-.22.71v10c0 .55.45 1 1 1h12c.34 0 .65-.17.83-.42L20.73 21l1.41-1.41L3.41 1.86M7 18V9.54l8.46 8.46H7m5-8l-2-2H7V8l3.18 3.18L12 10m5 0v-.73L15.27 7.54C15.61 7.2 16.09 7 16.63 7H17v-.5a.5.5 0 0 1 .5-.5h.5a.5.5 0 0 1 .5.5V7h.5a.5.5 0 0 1 .5.5V12h-2v-2z"})],-1)),t("p",De,v(l.value?"لا توجد دروس متاحة حاليًا في هذه السلسلة.":"لا توجد سلاسل دروس متاحة حاليًا."),1),l.value?(r(),n("button",{key:0,onClick:e[1]||(e[1]=s=>S(null)),class:"mt-4 text-sm text-olive-green hover:underline"}," عرض كل السلاسل ")):g("",!0)])):g("",!0)]))}}),Ze=H(Oe,[["__scopeId","data-v-bb633b8c"]]);export{Ze as default};
