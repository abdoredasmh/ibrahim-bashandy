import{_ as K}from"./CEyFpblA.js";import{e as R,u as W,q as X,r as l,g as z,l as Y,c as a,a as t,h as Z,x as ee,i as g,y as te,n as V,t as d,b as E,w as $,T as re,v as ae,d as k,p as se,F as I,j as F,o as r,_ as oe}from"./CaF1xe-H.js";import{L as H}from"./CpjGp_h0.js";import{u as le}from"./C0vmt3Ib.js";const ne={class:"container mx-auto px-4 py-8"},ie={key:0,class:"mb-10 p-6 bg-beige-light dark:bg-cream-gray rounded-lg shadow-md border border-cream-gray dark:border-gray-700"},de=["aria-describedby","disabled"],ue={id:"question-help-text",class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},ce={key:0,id:"question-error-message",class:"mt-1 text-xs text-red-600 dark:text-red-400"},ge={class:"mt-4 flex items-center justify-end gap-4 flex-wrap"},ve={key:0,class:"text-sm text-green-600 dark:text-green-400 order-1 sm:order-none"},be={key:0,class:"text-sm text-red-600 dark:text-red-400 order-1 sm:order-none"},me=["disabled"],xe={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ye={key:1},pe={key:2},ke={key:1,class:"mb-10 p-6 text-center bg-gray-100 dark:bg-gray-800 rounded-md"},fe={class:"text-gray-700 dark:text-gray-300"},_e={key:0,class:"text-center py-10"},he={key:1,class:"text-center py-10 text-red-600 dark:text-red-400"},we={key:2},qe={class:"flex flex-wrap gap-2 mb-8 items-center"},Ce=["disabled"],Ee=["onClick","disabled"],Se={key:0,class:"text-sm text-gray-500 italic"},Te={key:0,class:"space-y-6"},Le={class:"p-5"},Ne={key:0,class:"inline-block bg-blue-100 text-blue-800 text-xs font-medium mb-2 px-2.5 py-0.5 rounded-full dark:bg-blue-900 dark:text-blue-300"},Qe={class:"font-semibold text-lg text-gray-800 dark:text-gray-100 mb-2"},Ve={key:0,class:"bg-gray-50 dark:bg-gray-700/50 p-5 border-t border-gray-200 dark:border-gray-600"},$e={class:"prose prose-sm dark:prose-invert max-w-none text-gray-700 dark:text-gray-200"},je={class:"whitespace-pre-wrap"},Be={key:1,class:"text-center py-10 text-gray-500 dark:text-gray-400"},De={key:0},Me={key:1},Pe={key:2,class:"mt-8 flex justify-center items-center space-x-2 rtl:space-x-reverse"},ze=["disabled"],Ie={class:"text-sm text-gray-700 dark:text-gray-300"},Fe=["disabled"],f=10,He=R({__name:"index",setup(Ue){const S=W(),T=X(),v=l(""),x=l(!1),_=l(!1),h=l(null),u=l(null),y=l([]),w=l([]),b=l(null),n=l(!0),q=l(null),L=l(!0),i=l(1),N=l(15),C=l(0),j=z(()=>v.value.trim().length<f),m=z(()=>C.value===0?1:Math.ceil(C.value/N.value));function B(){v.value.trim()&&v.value.trim().length<f?u.value=`يجب أن يكون السؤال ${f} حروف على الأقل.`:u.value=null}async function U(){if(B(),!(!T.value||j.value||u.value)){x.value=!0,_.value=!1,h.value=null;try{const{error:o}=await S.from("questions_to_sheikh").insert({user_id:T.value.id,question_text:v.value.trim()});if(o)if(o.code==="23514"&&o.message.includes("_check"))console.warn("Check constraint violation:",o.message),u.value=`فشل الإرسال. تأكد أن السؤال لا يقل عن ${f} حروف.`;else throw o;else v.value="",_.value=!0,u.value=null,setTimeout(()=>{_.value=!1},3e3)}catch(o){console.error("Error submitting question:",o),u.value||(h.value="حدث خطأ أثناء إرسال السؤال. يرجى المحاولة مرة أخرى.")}finally{x.value=!1}}}async function Q(o=1,e=b.value){n.value=!0,q.value=null;const p=(o-1)*N.value,s=p+N.value-1;try{if(w.value.length===0&&L.value){const{data:J,error:P}=await S.from("question_categories").select("id, name").order("id");P?console.error("Error fetching categories:",P):w.value=J||[],L.value=!1}let c=S.from("questions_to_sheikh").select(`
        id, question_text, submitted_at, answer_text, answered_at,
        is_public, is_answered, category_id,
        question_categories ( name )
      `,{count:"exact"}).eq("is_public",!0).eq("is_answered",!0).order("answered_at",{ascending:!1}).range(p,s);e!==null&&(c=c.eq("category_id",e));const{data:G,error:M,count:O}=await c;if(M)throw M;y.value=G||[],C.value=O??0,o>m.value&&m.value>0&&(i.value=m.value)}catch(c){console.error("Error fetching public questions:",c),q.value=c.message||"فشل تحميل البيانات.",y.value=[],C.value=0}finally{n.value=!1}}function D(o){o>=1&&o<=m.value&&o!==i.value&&!n.value&&(i.value=o)}Y([i,b],([o,e],[p,s])=>{e!==s?i.value!==1?i.value=1:Q(1,e):Q(o,e)},{immediate:!0});async function A(){await Q(i.value,b.value)}return le({title:"اسأل الشيخ - موقع الشيخ إبراهيم بشندي",meta:[{name:"description",content:"اطرح سؤالك مباشرة على الشيخ إبراهيم بشندي وتصفح الأسئلة المجابة في مختلف الفئات الشرعية مع إمكانية الفلترة والتصفح."}]}),(o,e)=>{const p=K;return r(),a("div",ne,[e[14]||(e[14]=t("h1",{class:"text-3xl font-bold text-brown-dark dark:text-brown-dark mb-8 border-b-2 border-olive-green pb-2"}," اسأل الشيخ ",-1)),Z(T)?(r(),a("section",ie,[e[5]||(e[5]=t("h2",{class:"text-xl font-semibold text-brown-dark dark:text-brown-dark mb-4"}," أرسل سؤالك للشيخ ",-1)),t("form",{onSubmit:ae(U,["prevent"])},[t("div",null,[ee(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=s=>v.value=s),rows:"4",class:V(["block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm dark:bg-gray-800 dark:border-gray-600 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 disabled:opacity-70",{"border-red-500 dark:border-red-600":u.value}]),placeholder:"اكتب سؤالك هنا...",required:"","aria-describedby":u.value?"question-error-message":"question-help-text",disabled:x.value,onInput:B},null,42,de),[[te,v.value]]),t("p",ue," يجب أن يكون السؤال "+d(f)+" حروف على الأقل. (الحالي: "+d(v.value.trim().length)+" حرف) ",1),u.value?(r(),a("p",ce,d(u.value),1)):g("",!0)]),t("div",ge,[E(re,{name:"fade"},{default:$(()=>[_.value?(r(),a("p",ve," تم إرسال سؤالك بنجاح! ")):g("",!0)]),_:1}),h.value?(r(),a("p",be,d(h.value),1)):g("",!0),t("button",{type:"submit",disabled:x.value||j.value,class:"inline-flex items-center justify-center px-5 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 dark:focus:ring-offset-gray-900 order-2 sm:order-none",style:{backgroundColor:"var(--color-olive-green)"}},[x.value?(r(),a("svg",xe,e[4]||(e[4]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):g("",!0),x.value?(r(),a("span",ye,"جاري الإرسال...")):(r(),a("span",pe,"إرسال السؤال"))],8,me)])],32)])):(r(),a("section",ke,[t("p",fe,[E(p,{to:"/login",class:"text-primary-600 hover:underline dark:text-primary-400 font-medium"},{default:$(()=>e[6]||(e[6]=[k("سجّل الدخول")])),_:1}),e[8]||(e[8]=k(" أو ")),E(p,{to:"/signup",class:"text-primary-600 hover:underline dark:text-primary-400 font-medium"},{default:$(()=>e[7]||(e[7]=[k("أنشئ حسابًا جديدًا")])),_:1}),e[9]||(e[9]=k(" لتتمكن من إرسال سؤالك. "))])])),t("section",null,[e[13]||(e[13]=t("h2",{class:"text-2xl font-semibold text-brown-dark dark:text-brown-dark mb-6 border-b border-cream-gray dark:border-gray-700 pb-2"}," أسئلة شائعة ومجابة ",-1)),n.value&&y.value.length===0?(r(),a("div",_e,[E(H),e[10]||(e[10]=t("p",{class:"mt-4 text-gray-600 dark:text-gray-400"},"جارٍ تحميل الأسئلة...",-1))])):q.value?(r(),a("div",he,[k(" حدث خطأ أثناء تحميل الأسئلة: "+d(q.value)+" ",1),t("button",{onClick:A,class:"mt-2 block mx-auto text-sm text-primary-600 hover:underline"},"إعادة المحاولة")])):(r(),a("div",we,[t("div",qe,[t("button",{onClick:e[1]||(e[1]=s=>b.value=null),disabled:n.value,class:V(["px-4 py-1.5 text-sm font-medium rounded-full transition-colors duration-150",b.value===null?"bg-olive-green text-white shadow":"bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",n.value?"opacity-70 cursor-not-allowed":""])}," الكل ",10,Ce),(r(!0),a(I,null,F(w.value,s=>(r(),a("button",{key:s.id,onClick:c=>b.value=s.id,disabled:n.value,class:V(["px-4 py-1.5 text-sm font-medium rounded-full transition-colors duration-150",b.value===s.id?"bg-olive-green text-white shadow":"bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",n.value?"opacity-70 cursor-not-allowed":""])},d(s.name),11,Ee))),128)),L.value&&!w.value.length?(r(),a("span",Se,"جارٍ تحميل التصنيفات...")):g("",!0),n.value?(r(),se(H,{key:1,class:"w-4 h-4 text-gray-500 inline-block ms-2"})):g("",!0)]),y.value.length>0?(r(),a("div",Te,[(r(!0),a(I,null,F(y.value,s=>{var c;return r(),a("div",{key:s.id,class:"bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 overflow-hidden transition-shadow duration-200 hover:shadow-md"},[t("div",Le,[(c=s.question_categories)!=null&&c.name?(r(),a("span",Ne,d(s.question_categories.name),1)):g("",!0),t("h3",Qe,[e[11]||(e[11]=t("span",{class:"text-gray-500 dark:text-gray-400"},"س:",-1)),k(" "+d(s.question_text),1)])]),s.answer_text?(r(),a("div",Ve,[e[12]||(e[12]=t("h4",{class:"font-semibold text-md text-olive-green dark:text-yellow-400 mb-2 flex items-center"},[t("span",{class:"bg-olive-green dark:bg-yellow-400 text-white dark:text-gray-900 rounded-full w-5 h-5 flex items-center justify-center text-xs me-2"},"ج"),t("span",null,"جواب الشيخ:")],-1)),t("div",$e,[t("p",je,d(s.answer_text),1)])])):g("",!0)])}),128))])):!n.value&&y.value.length===0?(r(),a("div",Be,[b.value===null?(r(),a("p",De,"لا توجد أسئلة مجابة متاحة حاليًا.")):(r(),a("p",Me,"لا توجد أسئلة مجابة تطابق هذا التصنيف حاليًا."))])):g("",!0),m.value>1?(r(),a("div",Pe,[t("button",{onClick:e[2]||(e[2]=s=>D(i.value-1)),disabled:i.value===1||n.value,class:"px-3 py-1 text-sm rounded border bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed"}," السابق ",8,ze),t("span",Ie," صفحة "+d(i.value)+" من "+d(m.value),1),t("button",{onClick:e[3]||(e[3]=s=>D(i.value+1)),disabled:i.value===m.value||n.value,class:"px-3 py-1 text-sm rounded border bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed"}," التالي ",8,Fe)])):g("",!0)]))])])}}}),Ke=oe(He,[["__scopeId","data-v-274c751a"]]);export{Ke as default};
