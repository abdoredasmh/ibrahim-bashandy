const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CH4oOQ9J.js","./Dfgt84Z7.js","./CaF1xe-H.js","./entry.DgcQJhFP.css","./vWwLff75.js","./CjyD0VXP.js","./CpjGp_h0.js","./LoadingSpinner.Dre-g5PP.css","./0hHoC52s.js","./DhpZqJBn.js"])))=>i.map(i=>d[i]);
import{e as ee,u as te,r as x,g as H,l as se,c as i,a as e,b as _,p as P,i as M,d as j,o as r,W,X,_ as le,N as ne,C as ie,t as u,w as A,n as de,F as Q,j as Y}from"./CaF1xe-H.js";import{_ as ue}from"./CEyFpblA.js";import{L as S}from"./CpjGp_h0.js";import{_ as ce}from"./Cjm1-dYk.js";import{B as G}from"./In8HDdPU.js";const fe=W(()=>X(()=>import("./CH4oOQ9J.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(c=>c.default||c)),ge={class:"p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg border dark:border-gray-700 flex flex-wrap items-center justify-start gap-3"},me={class:"flex items-center gap-2"},pe=["for"],ve=["id","value","disabled"],xe=["disabled"],ye={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",class:"w-4 h-4"},_e=["disabled"],be=["disabled"],he=["disabled"],we=["disabled"],ke=ee({__name:"AdminUserActions",props:{userProfile:{type:Object,required:!0},isLoading:{type:Boolean,default:!1}},emits:["action-start","action-complete","send-message","suspend-comments"],setup(c,{emit:D}){const p=c,y=D,b=te(),d=x(null),w=x(p.userProfile.role),a=x(!1),k=x(null);let $=null;const B=H(()=>{if(!p.userProfile.comment_suspended_until)return!1;try{return new Date(p.userProfile.comment_suspended_until)>new Date}catch{return!1}});se(()=>p.userProfile,n=>{w.value=n.role},{deep:!0});const Z=async n=>{if(!(d.value||p.userProfile.role===n)){d.value="role",y("action-start","role");try{const{error:s}=await b.from("profiles").update({role:n,updated_at:new Date().toISOString()}).eq("id",p.userProfile.id);if(s)throw s;w.value=n,y("action-complete",!0,`تم تغيير دور المستخدم إلى ${n}.`,{role:n})}catch(s){console.error("Error updating role:",s),w.value=p.userProfile.role,y("action-complete",!1,`فشل تغيير دور المستخدم: ${s.message}`)}finally{d.value=null}}},g=async n=>{const s=n?"ban":"unban";if(!d.value){d.value=s,y("action-start",s);try{const{error:v}=await b.from("profiles").update({is_banned:n,updated_at:new Date().toISOString()}).eq("id",p.userProfile.id);if(v)throw v;y("action-complete",!0,n?"تم حظر المستخدم بنجاح.":"تم إلغاء حظر المستخدم بنجاح.",{is_banned:n})}catch(v){console.error("Error toggling ban status:",v),y("action-complete",!1,`فشل تحديث حالة الحظر: ${v.message}`)}finally{d.value=null}}},U=async()=>{if(!d.value){d.value="unsuspend",y("action-start","unsuspend");try{const{error:n}=await b.from("profiles").update({comment_suspended_until:null,updated_at:new Date().toISOString()}).eq("id",p.userProfile.id);if(n)throw n;y("action-complete",!0,"تم إلغاء إيقاف التعليقات بنجاح.",{comment_suspended_until:null})}catch(n){console.error("Error removing suspension:",n),y("action-complete",!1,`فشل إلغاء إيقاف التعليقات: ${n.message}`)}finally{d.value=null}}},E=n=>{$={type:n};let s="",v="",m="",R="إلغاء",z="bg-red-600 hover:bg-red-700 focus:ring-red-500";const I=p.userProfile.full_name||p.userProfile.id;n==="ban"?(s="تأكيد الحظر",v=`هل أنت متأكد من حظر ${I}؟`,m="نعم، حظر"):n==="unban"?(s="تأكيد إلغاء الحظر",v=`هل أنت متأكد من إلغاء حظر ${I}؟`,m="نعم، إلغاء الحظر",z="bg-green-600 hover:bg-green-700 focus:ring-green-500"):n==="unsuspend"&&(s="تأكيد إلغاء إيقاف التعليق",v=`هل أنت متأكد من السماح لـ ${I} بالتعليق؟`,m="نعم، إلغاء الإيقاف",z="bg-green-600 hover:bg-green-700 focus:ring-green-500"),k.value={title:s,message:v,confirmText:m,cancelText:R,confirmClass:z},a.value=!0},O=()=>{if(!$)return;const{type:n}=$;n==="ban"?g(!0):n==="unban"?g(!1):n==="unsuspend"&&U(),a.value=!1,$=null};return(n,s)=>{const v=fe;return r(),i("div",ge,[e("div",me,[e("label",{for:`role-select-${c.userProfile.id}`,class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"تغيير الدور:",8,pe),e("select",{id:`role-select-${c.userProfile.id}`,value:w.value,onChange:s[0]||(s[0]=m=>Z(m.target.value)),disabled:c.isLoading||d.value==="role",class:"text-sm rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-indigo-500 focus:border-indigo-500 disabled:opacity-70"},s[7]||(s[7]=[e("option",{value:"user"},"مستخدم",-1),e("option",{value:"admin"},"مشرف",-1)]),40,ve),d.value==="role"?(r(),P(S,{key:0,class:"w-4 h-4 inline-block ml-1 animate-spin text-indigo-500"})):M("",!0)]),c.userProfile.is_banned?(r(),i("button",{key:1,onClick:s[2]||(s[2]=m=>E("unban")),disabled:c.isLoading||d.value==="unban",class:"px-3 py-1.5 text-sm rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 flex items-center gap-1"},[d.value==="unban"?(r(),P(S,{key:0,class:"w-4 h-4"})):M("",!0),s[12]||(s[12]=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",class:"w-4 h-4"},[e("path",{"fill-rule":"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14Zm3.84-10.73a.75.75 0 1 0-1.18-.94l-1.66 2.08-.94-1.18a.75.75 0 1 0-.94 1.18l1.5 1.875a.75.75 0 0 0 1.18 0l2-2.5Z","clip-rule":"evenodd"})],-1)),s[13]||(s[13]=e("span",null,"إلغاء الحظر",-1))],8,_e)):(r(),i("button",{key:0,onClick:s[1]||(s[1]=m=>E("ban")),disabled:c.isLoading||d.value==="ban",class:"px-3 py-1.5 text-sm rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 flex items-center gap-1"},[d.value==="ban"?(r(),P(S,{key:0,class:"w-4 h-4"})):(r(),i("svg",ye,s[8]||(s[8]=[e("path",{"fill-rule":"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14Zm3.84-10.73a.75.75 0 1 0-1.18-.94l-1.66 2.08-.94-1.18a.75.75 0 1 0-.94 1.18l1.5 1.875a.75.75 0 0 0 1.18 0l2-2.5Z","clip-rule":"evenodd"},null,-1)]))),s[9]||(s[9]=j(" --> ")),s[10]||(s[10]=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",class:"w-4 h-4"},[e("path",{"fill-rule":"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14ZM4.75 7.25A.75.75 0 0 1 5.5 8h5a.75.75 0 0 1 0 1.5h-5A.75.75 0 0 1 4 8.75a.75.75 0 0 1 .75-.75Z","clip-rule":"evenodd"})],-1)),s[11]||(s[11]=e("span",null,"حظر",-1))],8,xe)),B.value?(r(),i("button",{key:3,onClick:s[4]||(s[4]=m=>E("unsuspend")),disabled:c.isLoading||d.value==="unsuspend",class:"px-3 py-1.5 text-sm rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 flex items-center gap-1"},[d.value==="unsuspend"?(r(),P(S,{key:0,class:"w-4 h-4"})):M("",!0),s[15]||(s[15]=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",class:"w-4 h-4"},[e("path",{"fill-rule":"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14Zm3.84-10.73a.75.75 0 1 0-1.18-.94l-1.66 2.08-.94-1.18a.75.75 0 1 0-.94 1.18l1.5 1.875a.75.75 0 0 0 1.18 0l2-2.5Z","clip-rule":"evenodd"})],-1)),s[16]||(s[16]=e("span",null,"إلغاء إيقاف التعليق",-1))],8,he)):(r(),i("button",{key:2,onClick:s[3]||(s[3]=m=>y("suspend-comments")),disabled:c.isLoading,class:"px-3 py-1.5 text-sm rounded-md text-yellow-800 dark:text-yellow-200 bg-yellow-100 dark:bg-yellow-900/50 hover:bg-yellow-200 dark:hover:bg-yellow-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 disabled:opacity-50 flex items-center gap-1"},s[14]||(s[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",class:"w-4 h-4"},[e("path",{"fill-rule":"evenodd",d:"M4.5 6.75a.75.75 0 0 0 0 1.5h7a.75.75 0 0 0 0-1.5h-7Zm0 3.5a.75.75 0 0 0 0 1.5h4a.75.75 0 0 0 0-1.5h-4Z","clip-rule":"evenodd"})],-1),e("span",null,"إيقاف التعليق",-1)]),8,be)),e("button",{onClick:s[5]||(s[5]=m=>y("send-message")),disabled:c.isLoading,class:"px-3 py-1.5 text-sm rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 flex items-center gap-1"},s[17]||(s[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",class:"w-4 h-4"},[e("path",{d:"M2.5 3A1.5 1.5 0 0 0 1 4.5v7A1.5 1.5 0 0 0 2.5 13h11a1.5 1.5 0 0 0 1.5-1.5v-7A1.5 1.5 0 0 0 13.5 3h-11ZM2 4.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 .5.5v1.145l-5.426 3.05a1.75 1.75 0 0 1-1.93.066L2 5.96V4.5Zm11.5 8h-11a.5.5 0 0 1-.5-.5v-4.318l3.924 2.207a3.25 3.25 0 0 0 3.552-.122L14 7.764V11.5a.5.5 0 0 1-.5.5Z"})],-1),e("span",null,"إرسال رسالة",-1)]),8,we),_(v,{modelValue:a.value,"onUpdate:modelValue":s[6]||(s[6]=m=>a.value=m),config:k.value,onConfirm:O},null,8,["modelValue","config"])])}}}),$e=le(ke,[["__scopeId","data-v-e6f72aa4"]]),Ce=W(()=>X(()=>import("./CjyD0VXP.js"),__vite__mapDeps([5,2,3,6,7,4]),import.meta.url).then(c=>c.default||c)),Ae=W(()=>X(()=>import("./0hHoC52s.js"),__vite__mapDeps([8,2,3,6,7,9,4]),import.meta.url).then(c=>c.default||c)),Se={key:0,class:"flex justify-center items-center min-h-[60vh]"},Le={key:1,class:"container mx-auto px-4 py-8 text-center"},Me={class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert"},Pe={class:"block sm:inline"},De={key:2,class:"container mx-auto px-4 lg:px-8 py-8 space-y-8"},Ee={class:"flex flex-col sm:flex-row justify-between items-start gap-4 pb-4 border-b dark:border-gray-700"},Ve={class:"flex items-center gap-4"},je={class:"text-2xl font-semibold text-gray-800 dark:text-gray-100"},Be={class:"text-sm text-gray-500 dark:text-gray-400"},Ze={class:"mt-1 flex flex-wrap gap-2 text-xs"},qe={key:0,class:"px-2 py-0.5 rounded-full bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300"},Ne={key:1,class:"px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300"},Ue={key:2,class:"px-2 py-0.5 rounded-full bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"},ze={key:0,class:"fixed inset-0 bg-white/50 dark:bg-gray-900/50 flex items-center justify-center z-50"},Ie={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},Oe={class:"lg:col-span-1 space-y-6"},Re={class:"space-y-3 text-sm"},Te={class:"flex justify-between"},Fe={class:"text-gray-700 dark:text-gray-200"},Ge={class:"flex justify-between"},He={class:"text-gray-700 dark:text-gray-200"},We={class:"flex justify-between"},Xe={class:"text-gray-700 dark:text-gray-200"},Je={class:"flex justify-between"},Ke={class:"text-gray-700 dark:text-gray-200 font-semibold"},Qe={key:0},Ye={class:"text-yellow-600 dark:text-yellow-400"},et={class:"pt-2"},tt={class:"text-gray-700 dark:text-gray-200 whitespace-pre-wrap bg-gray-50 dark:bg-gray-700/50 p-2 rounded border dark:border-gray-600 min-h-[50px]"},st={key:0,class:"text-center p-4"},lt={key:1,class:"space-y-2 max-h-60 overflow-y-auto text-sm pr-1"},rt={class:"text-xs text-gray-400 flex-shrink-0"},at={key:1,class:"text-sm text-center text-gray-400 dark:text-gray-500 italic py-4"},ot={class:"lg:col-span-2 space-y-6"},nt={class:"flex justify-between items-center"},it=["disabled"],dt={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",class:"w-4 h-4"},ut={key:0,class:"text-center py-10"},ct={key:1,class:"text-center py-10 text-gray-500 dark:text-gray-400"},ft={key:2,class:"space-y-6 max-h-[70vh] overflow-y-auto pr-2 custom-scrollbar"},gt={class:"p-3 rounded-lg bg-gray-100 dark:bg-gray-700/80 shadow-sm"},mt={class:"flex justify-between items-start mb-1.5"},pt={class:"font-semibold text-gray-800 dark:text-gray-100"},vt={class:"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap"},xt={class:"text-sm text-gray-700 dark:text-gray-200 whitespace-pre-wrap"},yt={class:"text-xs text-gray-400 dark:text-gray-500 mt-1"},_t={key:0,class:"mt-3 mr-4 rtl:mr-0 rtl:ml-4 p-3 rounded-lg bg-yellow-50 dark:bg-yellow-900/30 border-l-4 border-yellow-400 dark:border-yellow-600 shadow-sm"},bt={class:"flex justify-between items-start mb-1.5"},ht={class:"text-xs text-yellow-700 dark:text-yellow-300 whitespace-nowrap"},wt={class:"text-sm text-gray-700 dark:text-gray-200 whitespace-pre-wrap"},kt={class:"mt-2 text-right"},$t=["onClick","disabled"],Ct={key:1,class:"text-xs text-green-600 dark:text-green-400 font-medium"},At={key:1,class:"mt-3 mr-4 rtl:mr-0 rtl:ml-4 text-xs text-gray-400 italic"},St=ee({__name:"[id]",setup(c){const D=te(),{$toast:p}=ne(),y=ie(),b=H(()=>y.params.id),d=x(!0),w=x(null),a=x(null),k=x([]),$=x(!1),B=x([]),Z=x(!1),g=x(!1),U=x(!1),E=x(!1),O=H(()=>{var l;return((l=a.value)==null?void 0:l.profile)??null}),n=async()=>{if(d.value=!0,w.value=null,a.value=null,k.value=[],B.value=[],$.value=!0,Z.value=!0,!b.value){w.value={message:"معرف المستخدم غير موجود."},d.value=!1;return}try{const l=D.from("profiles").select("*").eq("id",b.value).single(),t=D.auth.admin.getUserById(b.value),f=D.from("user_private_messages").select("*").eq("user_id",b.value).order("created_at",{ascending:!1}),C=D.from("course_enrollments").select("course_id, enrolled_at, study_courses (title)").eq("user_id",b.value).order("enrolled_at",{ascending:!1}),[h,V,o,N]=await Promise.allSettled([l,t,f,C]);if(h.status==="rejected"||!h.value.data)throw h.status==="rejected"?h.reason:new Error("لم يتم العثور على ملف المستخدم.");const K=h.value.data;let F;if(V.status==="fulfilled"&&V.value.data.user){const T=V.value.data.user;F={id:T.id,email:T.email??"غير متوفر",created_at:T.created_at,last_sign_in_at:T.last_sign_in_at}}else console.warn("فشل جلب بيانات المصادقة:",V.status==="rejected"?V.reason:"لا يوجد بيانات"),F={id:K.id,email:"غير متاح (خطأ تحميل)",created_at:void 0,last_sign_in_at:void 0};a.value={profile:K,auth:F},o.status==="fulfilled"?k.value=o.value.data??[]:console.error("Error fetching messages:",o.reason),$.value=!1,N.status==="fulfilled"?B.value=N.value.data??[]:console.error("Error fetching enrolled courses:",N.reason),Z.value=!1}catch(l){console.error("Error fetching user detail:",l),w.value=l??{message:"خطأ غير معروف."},a.value=null,$.value=!1,Z.value=!1}finally{d.value=!1}},s=l=>{g.value=l==="ban"||l==="unban"||l==="unsuspend"||l==="role",console.log(`Action started: ${l}`)},v=(l,t,f)=>{g.value=!1,l&&a.value&&f?(Object.assign(a.value.profile,f),L(t,"success")):l||L(t,"error")},m=async l=>{var t;if(!g.value){g.value=`read-${l}`;try{const{error:f}=await D.from("user_private_messages").update({admin_read_reply:!0}).eq("id",l);if(f)throw f;const C=(t=k.value)==null?void 0:t.findIndex(h=>h.id===l);C!==void 0&&C!==-1&&k.value&&(k.value[C].admin_read_reply=!0),L("تم تمييز الرد كمقروء.","success")}catch(f){console.error("Error marking reply as read by admin:",f),L("فشل تمييز الرد كمقروء.","error")}finally{g.value===`read-${l}`&&(g.value=!1)}}},R=l=>{l&&(U.value=!0)},z=l=>{l&&(E.value=!0)},I=(l,t)=>{U.value=!1,l?(L("تم إرسال الرسالة الخاصة بنجاح.","success"),re()):L(`فشل إرسال الرسالة الخاصة: ${t||"خطأ غير معروف"}`,"error")},re=async()=>{if(b.value){$.value=!0;try{const{data:l,error:t}=await D.from("user_private_messages").select("*").eq("user_id",b.value).order("created_at",{ascending:!1});if(t)throw t;k.value=l??[]}catch(l){console.error("Error refreshing messages:",l),L("فشل تحديث قائمة الرسائل.","error")}finally{$.value=!1}}},ae=(l,t,f)=>{var C;if(((C=a.value)==null?void 0:C.profile.id)===l){a.value.profile.comment_suspended_until=f;const h=a.value.profile.full_name||a.value.auth.email;L(t?`تم إيقاف تعليقات المستخدم ${h} حتى ${q(f)}.`:`تم إلغاء إيقاف تعليقات المستخدم ${h}.`,"success")}E.value=!1},q=l=>{if(!l)return"--";try{const t=new Date(l);return isNaN(t.getTime())?"تاريخ غير صالح":t.toLocaleString("ar-EG",{dateStyle:"medium",timeStyle:"short",hour12:!0})}catch{return"خطأ تنسيق"}},oe=l=>{if(!l)return"--";try{const t=new Date(l);return isNaN(t.getTime())?"تاريخ غير صالح":t.toLocaleDateString("ar-EG",{year:"numeric",month:"short",day:"numeric"})}catch{return"خطأ تنسيق"}},J=l=>{if(!l)return!1;try{return new Date(l)>new Date}catch{return!1}},L=(l,t="info")=>{p&&typeof p[t]=="function"?p[t](l):console.log(`[${t.toUpperCase()}] ${l}`)};return se(b,l=>{l&&n()},{immediate:!0}),(l,t)=>{var V;const f=ue,C=Ce,h=Ae;return d.value?(r(),i("div",Se,[_(S,{class:"w-10 h-10 text-indigo-600"})])):w.value||!a.value?(r(),i("div",Le,[e("div",Me,[t[5]||(t[5]=e("strong",{class:"font-bold"},"خطأ!",-1)),e("span",Pe,u(w.value?`فشل تحميل بيانات المستخدم: ${w.value.message}`:"لم يتم العثور على المستخدم المطلوب."),1)]),_(f,{to:"/admin/users",class:"mt-6 inline-block text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300"},{default:A(()=>t[6]||(t[6]=[j(" ← العودة إلى قائمة المستخدمين ")])),_:1})])):(r(),i("div",De,[e("div",Ee,[e("div",Ve,[_(ce,{src:a.value.profile.avatar_url||void 0,alt:a.value.profile.full_name||"مستخدم",size:"lg"},null,8,["src","alt"]),e("div",null,[e("h1",je,u(a.value.profile.full_name||"لم يحدد اسم"),1),e("p",Be,u(a.value.auth.email),1),e("div",Ze,[e("span",{class:de(["px-2 py-0.5 rounded-full",a.value.profile.role==="admin"?"bg-purple-100 text-purple-800 dark:bg-purple-900/50 dark:text-purple-300":"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300"])},u(a.value.profile.role==="admin"?"مشرف":"مستخدم"),3),a.value.profile.is_banned?(r(),i("span",qe,"محظور")):J(a.value.profile.comment_suspended_until)?(r(),i("span",Ne,"تعليق موقوف")):(r(),i("span",Ue,"نشط"))])])]),_(f,{to:"/admin/users",class:"flex-shrink-0 text-sm text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300 flex items-center gap-1 mt-2 sm:mt-0"},{default:A(()=>t[7]||(t[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",class:"w-4 h-4"},[e("path",{"fill-rule":"evenodd",d:"M14 8a.75.75 0 0 1-.75.75H4.56l3.22 3.22a.75.75 0 1 1-1.06 1.06l-4.5-4.5a.75.75 0 0 1 0-1.06l4.5-4.5a.75.75 0 0 1 1.06 1.06L4.56 7.25H13.25A.75.75 0 0 1 14 8Z","clip-rule":"evenodd"})],-1),j(" العودة للقائمة ")])),_:1})]),g.value?(r(),i("div",ze,[_(S,{class:"w-8 h-8 text-indigo-600"}),t[8]||(t[8]=e("span",{class:"ml-2 text-gray-700 dark:text-gray-300"},"جاري تنفيذ الإجراء...",-1))])):M("",!0),(V=a.value)!=null&&V.profile?(r(),P($e,{key:1,"user-profile":a.value.profile,"is-loading":g.value,onActionStart:s,onActionComplete:v,onSendMessage:t[0]||(t[0]=o=>R(a.value.profile)),onSuspendComments:t[1]||(t[1]=o=>z(a.value.profile))},null,8,["user-profile","is-loading"])):M("",!0),e("div",Ie,[e("div",Oe,[_(G,null,{title:A(()=>t[9]||(t[9]=[j("معلومات إضافية")])),content:A(()=>[e("dl",Re,[e("div",Te,[t[10]||(t[10]=e("dt",{class:"font-medium text-gray-500 dark:text-gray-400"},"تاريخ الانضمام:",-1)),e("dd",Fe,u(q(a.value.profile.created_at)),1)]),e("div",Ge,[t[11]||(t[11]=e("dt",{class:"font-medium text-gray-500 dark:text-gray-400"},"آخر تحديث للبروفايل:",-1)),e("dd",He,u(q(a.value.profile.updated_at)),1)]),e("div",We,[t[12]||(t[12]=e("dt",{class:"font-medium text-gray-500 dark:text-gray-400"},"آخر تسجيل دخول:",-1)),e("dd",Xe,u(q(a.value.auth.last_sign_in_at)||"غير متاح"),1)]),e("div",Je,[t[13]||(t[13]=e("dt",{class:"font-medium text-gray-500 dark:text-gray-400"},"النقاط:",-1)),e("dd",Ke,u(a.value.profile.points??0),1)]),J(a.value.profile.comment_suspended_until)?(r(),i("div",Qe,[t[14]||(t[14]=e("dt",{class:"font-medium text-gray-500 dark:text-gray-400"},"انتهاء إيقاف التعليق:",-1)),e("dd",Ye,u(q(a.value.profile.comment_suspended_until)),1)])):M("",!0),e("div",et,[t[15]||(t[15]=e("dt",{class:"font-medium text-gray-500 dark:text-gray-400 mb-1"},"النبذة الشخصية:",-1)),e("dd",tt,u(a.value.profile.bio||"لم يكتب نبذة."),1)])])]),_:1}),B.value.length>0?(r(),P(G,{key:0},{title:A(()=>[j("الدورات المسجل بها ("+u(B.value.length)+")",1)]),content:A(()=>[Z.value?(r(),i("div",st,[_(S)])):(r(),i("ul",lt,[(r(!0),i(Q,null,Y(B.value,o=>(r(),i("li",{key:o.course_id,class:"flex justify-between items-center hover:bg-gray-100 dark:hover:bg-gray-700 p-1 rounded"},[_(f,{to:`/study/courses/${o.course_id}`,class:"hover:underline text-gray-700 dark:text-gray-200 flex-grow truncate mr-2"},{default:A(()=>{var N;return[j(u(((N=o.study_courses)==null?void 0:N.title)||"دورة غير معروفة"),1)]}),_:2},1032,["to"]),e("span",rt,u(oe(o.enrolled_at)),1)]))),128))]))]),_:1})):Z.value?M("",!0):(r(),i("div",at," المستخدم غير مسجل في أي دورات. "))]),e("div",ot,[_(G,null,{title:A(()=>[e("div",nt,[t[18]||(t[18]=e("span",null,"المراسلات مع المستخدم",-1)),e("button",{onClick:t[2]||(t[2]=o=>R(a.value.profile)),disabled:g.value==="send",class:"text-sm bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300 hover:bg-indigo-200 dark:hover:bg-indigo-900 px-3 py-1 rounded-md flex items-center gap-1 disabled:opacity-50"},[g.value==="send"?(r(),P(S,{key:0,class:"w-4 h-4"})):(r(),i("svg",dt,t[16]||(t[16]=[e("path",{d:"M2.5 3A1.5 1.5 0 0 0 1 4.5v7A1.5 1.5 0 0 0 2.5 13h11a1.5 1.5 0 0 0 1.5-1.5v-7A1.5 1.5 0 0 0 13.5 3h-11ZM2 4.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 .5.5v1.145l-5.426 3.05a1.75 1.75 0 0 1-1.93.066L2 5.96V4.5Zm11.5 8h-11a.5.5 0 0 1-.5-.5v-4.318l3.924 2.207a3.25 3.25 0 0 0 3.552-.122L14 7.764V11.5a.5.5 0 0 1-.5.5Z"},null,-1)]))),t[17]||(t[17]=e("span",null,"رسالة جديدة",-1))],8,it)])]),content:A(()=>[$.value?(r(),i("div",ut,[_(S)])):k.value.length===0?(r(),i("div",ct,"لا توجد رسائل متبادلة.")):(r(),i("div",ft,[(r(!0),i(Q,null,Y(k.value,o=>(r(),i("div",{key:o.id,class:"border-b dark:border-gray-700 pb-4 last:border-b-0"},[e("div",gt,[e("div",mt,[e("h4",pt,u(o.title),1),e("span",vt,u(q(o.created_at)),1)]),e("p",xt,u(o.content),1),e("p",yt,[t[19]||(t[19]=e("span",{class:"font-medium"},"المصدر:",-1)),j(" "+u(o.source==="ask_sheikh_reply"?"رد على سؤال":o.source==="admin_direct_message"?"رسالة مباشرة":"غير محدد")+" ",1),o.related_question_id?(r(),P(f,{key:0,to:`/admin/ask-sheikh?question=${o.related_question_id}`,class:"mr-1 text-indigo-600 dark:text-indigo-400 hover:underline"},{default:A(()=>[j("(#"+u(o.related_question_id)+")",1)]),_:2},1032,["to"])):M("",!0)])]),o.user_reply_text?(r(),i("div",_t,[e("div",bt,[t[20]||(t[20]=e("p",{class:"text-sm font-semibold text-yellow-800 dark:text-yellow-200"},"رد المستخدم:",-1)),e("span",ht,u(q(o.user_replied_at)),1)]),e("p",wt,u(o.user_reply_text),1),e("div",kt,[o.admin_read_reply?(r(),i("span",Ct,"(تمت القراءة)")):(r(),i("button",{key:0,onClick:N=>m(o.id),disabled:g.value===`read-${o.id}`,class:"text-xs text-blue-600 dark:text-blue-400 hover:underline disabled:opacity-50 flex items-center justify-end gap-1 ml-auto"},[g.value===`read-${o.id}`?(r(),P(S,{key:0,class:"w-3 h-3"})):M("",!0),e("span",null,u(g.value===`read-${o.id}`?"جارٍ...":"تمييز كمقروء"),1)],8,$t))])])):(r(),i("div",At," لم يرد المستخدم على هذه الرسالة بعد. "))]))),128))]))]),_:1})])]),_(C,{modelValue:U.value,"onUpdate:modelValue":t[3]||(t[3]=o=>U.value=o),user:O.value,onSent:I},null,8,["modelValue","user"]),_(h,{modelValue:E.value,"onUpdate:modelValue":t[4]||(t[4]=o=>E.value=o),user:O.value,onSuspended:ae},null,8,["modelValue","user"])]))}}}),Vt=le(St,[["__scopeId","data-v-aa34737d"]]);export{Vt as default};
