const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CgliSXAb.js","./C2nUyU-9.js","./CaF1xe-H.js","./entry.DgcQJhFP.css","./CpjGp_h0.js","./LoadingSpinner.Dre-g5PP.css","./vWwLff75.js","./PdfViewerModal.Dt6jtUpO.css"])))=>i.map(i=>d[i]);
import{e as H,u as z,g,r as $,f as O,s as U,c as a,b as C,h as _,a as s,t as f,w as L,p as B,i as W,d as j,F as X,j as Y,V as E,U as G,o,W as J,X as K,_ as Q}from"./CaF1xe-H.js";import{_ as ee}from"./CEyFpblA.js";import{_ as te}from"./C2nUyU-9.js";import{L as se}from"./CpjGp_h0.js";import{_ as oe}from"./BFvDSq9n.js";import{u as re}from"./CqvecxAQ.js";import{u as ae}from"./C0vmt3Ib.js";import"./Cjm1-dYk.js";import"./Bqepao4b.js";import"./DhpZqJBn.js";const le={class:"container mx-auto px-4"},ne={key:0,class:"text-center py-20"},ie={key:1,class:"text-center py-20 max-w-2xl mx-auto"},de={key:0,class:"text-2xl font-semibold text-red-600 dark:text-red-400 mb-4"},ce={key:1,class:"text-2xl font-semibold text-red-600 dark:text-red-400 mb-4"},ue={class:"text-gray-600 dark:text-gray-400 mb-6"},ge={key:2,class:"lesson-details max-w-5xl mx-auto space-y-6"},fe={class:"text-3xl font-bold text-brown-dark dark:text-brown-dark text-center sm:text-right"},pe={class:"video-section flex items-center gap-2 sm:gap-4"},me={class:"flex-shrink-0"},ve={key:1,class:"w-11 h-11 sm:w-14 sm:h-14"},ye={class:"flex-grow min-w-0"},he={key:0,class:"relative w-full rounded-lg overflow-hidden shadow-lg bg-black h-[250px] sm:h-[350px] md:h-[500px] lg:h-[600px]"},_e=["src"],xe={key:1,class:"p-4 bg-yellow-100 dark:bg-yellow-900 border border-yellow-300 dark:border-yellow-700 rounded-md text-yellow-800 dark:text-yellow-200 text-sm"},we={class:"break-all"},be={key:2,class:"p-4 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md text-gray-600 dark:text-gray-400 text-sm"},ke={class:"flex-shrink-0"},Ce={key:1,class:"w-11 h-11 sm:w-14 sm:h-14"},Le={class:"description-section"},De={key:0,class:"prose prose-lg dark:prose-invert max-w-none text-gray-700 dark:text-gray-300"},Me={class:"whitespace-pre-wrap"},Ne={key:1,class:"text-gray-500 dark:text-gray-400 italic"},Pe={class:"downloads-section p-5 bg-beige-light dark:bg-cream-gray rounded-lg shadow-sm border border-cream-gray dark:border-gray-700"},$e={key:0,class:"flex flex-col sm:flex-row items-start sm:items-center gap-3 flex-wrap"},Be=["onClick","title"],Ee={key:1,class:"text-xs text-gray-400 italic"},Ae={key:1,class:"text-sm text-gray-500 dark:text-gray-400"},Ie=H({__name:"[id]",async setup(Ve){let x,A;const F=J(()=>K(()=>import("./CgliSXAb.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url)),w=z(),R=G(),p=g(()=>{const t=Number(R.params.id);return isNaN(t)?-1:t}),D=$(!1),I=$(null),V=$(""),{data:b,pending:Z,error:M,refresh:Ze}=([x,A]=O(async()=>re(`lesson-details-catnav-${p.value}`,async()=>{const t=p.value;if(t===-1)throw E({statusCode:400,statusMessage:"معرف الدرس غير صالح."});const{data:e,error:n}=await w.from("lessons").select("id, title, description, youtube_url, category_id, course_id, created_at").eq("id",t).maybeSingle();if(n)throw console.error("Error fetching lesson:",n),E({statusCode:500,statusMessage:"حدث خطأ أثناء تحميل بيانات الدرس."});if(!e)throw E({statusCode:404,statusMessage:"الدرس المطلوب غير موجود."});let d=null,i=null,c=[];const l=e.category_id,u=[w.from("books").select("id, title, storage_path, is_research, is_transcript").eq("linked_lesson_id",t)];l!==null?(console.log(`Lesson belongs to category ${l}. Fetching prev/next...`),u.push(w.from("lessons").select("id, title").eq("category_id",l).lt("id",t).order("id",{ascending:!1}).limit(1).maybeSingle()),u.push(w.from("lessons").select("id, title").eq("category_id",l).gt("id",t).order("id",{ascending:!0}).limit(1).maybeSingle())):console.log("Lesson does not belong to a category. Skipping prev/next fetch.");const h=await Promise.all(u),m=h[0];if(m.error?console.error("Error fetching linked books:",m.error.message):c=m.data??[],l!==null&&h.length===3){const N=h[1],P=h[2];N.error?console.error("Error fetching previous lesson by category:",N.error.message):(d=N.data,console.log("Fetched Previous Lesson Data (Category Nav):",d)),P.error?console.error("Error fetching next lesson by category:",P.error.message):(i=P.data,console.log("Fetched Next Lesson Data (Category Nav):",i))}return{lesson:e,linkedBooks:c,previousLesson:d,nextLesson:i}},{watch:[p]})),x=await x,A(),x),r=g(()=>{var t;return((t=b.value)==null?void 0:t.lesson)??null}),k=g(()=>{var t;return((t=b.value)==null?void 0:t.linkedBooks)??[]}),v=g(()=>{var t;return((t=b.value)==null?void 0:t.previousLesson)??null}),y=g(()=>{var t;return((t=b.value)==null?void 0:t.nextLesson)??null}),S=g(()=>{var t;if(!((t=r.value)!=null&&t.youtube_url))return null;try{const e=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:watch\?v=|embed\/|v\/|.+\?v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/,n=r.value.youtube_url.match(e);return n&&n[1]?n[1]:null}catch(e){return console.error("Invalid YouTube URL format:",r.value.youtube_url,e),null}});ae(g(()=>{var i,c,l,u;const t=(i=r.value)!=null&&i.title?`درس: ${r.value.title}`:Z.value?"جارٍ التحميل...":"تفاصيل الدرس",e=((l=(c=r.value)==null?void 0:c.description)==null?void 0:l.substring(0,100))||`شاهد تفاصيل درس ${((u=r.value)==null?void 0:u.title)||""}.`;let n="";k.value.length>0&&(n=` يتضمن ملفات مرتبطة: ${k.value.map(m=>m.is_research?"بحث":m.is_transcript?"تفريغ":"كتاب").join(", ")}.`);const d=(e+n).substring(0,160);return{title:t,meta:[{name:"description",content:d},{property:"og:title",content:t},{property:"og:description",content:d},{property:"og:type",content:"article"},{property:"og:url",content:typeof window<"u"?window.location.href:""}]}}));function T(t,e){t&&typeof t=="string"?(I.value=t,V.value=e||"ملف مرتبط",D.value=!0):console.warn("Attempted to open PDF modal with invalid path:",t)}function q(){D.value=!1}return U(()=>{var t,e;console.log("[WatchEffect Debug - Category Nav]"),console.log("  Current Lesson ID:",p.value),console.log("  Lesson Data:",r.value),console.log("  Lesson Category ID:",(t=r.value)==null?void 0:t.category_id),console.log("  Previous Lesson Data:",v.value),console.log("  Next Lesson Data:",y.value),console.log("  Show Buttons Condition:",!!((e=r.value)!=null&&e.category_id&&(v.value||y.value)))}),(t,e)=>{var i,c;const n=ee,d=te;return o(),a("div",le,[_(Z)?(o(),a("div",ne,[C(se),e[0]||(e[0]=s("p",{class:"mt-4 text-gray-600 dark:text-gray-400"},"جارٍ تحميل بيانات الدرس...",-1))])):_(M)||!r.value?(o(),a("div",ie,[((i=_(M))==null?void 0:i.statusCode)===404?(o(),a("h2",de," الدرس غير موجود ")):(o(),a("h2",ce," حدث خطأ ")),s("p",ue,f(((c=_(M))==null?void 0:c.statusMessage)||"لم نتمكن من العثور على الدرس المطلوب أو حدث خطأ أثناء تحميله."),1),C(n,{to:"/lessons",class:"inline-flex items-center justify-center px-6 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:focus:ring-offset-gray-900 transition-colors",style:{backgroundColor:"var(--color-olive-green)"}},{default:L(()=>e[1]||(e[1]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5 ms-2","aria-hidden":"true",focusable:"false"},[s("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.25-7.25a.75.75 0 0 0 0-1.5H8.66l2.1-1.95a.75.75 0 1 0-1.02-1.1l-3.5 3.25a.75.75 0 0 0 0 1.1l3.5 3.25a.75.75 0 0 0 1.02-1.1l-2.1-1.95h4.59Z","clip-rule":"evenodd"})],-1),s("span",null,"العودة إلى قائمة الدروس",-1)])),_:1})])):(o(),a("div",ge,[s("h1",fe,f(r.value.title),1),s("div",pe,[s("div",me,[r.value.category_id&&v.value?(o(),B(n,{key:0,to:`/lessons/${v.value.id}`,class:"w-11 h-11 sm:w-14 sm:h-14 flex items-center justify-center rounded-full text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-900",title:`الدرس السابق: ${v.value.title}`,"aria-label":"الدرس السابق"},{default:L(()=>e[2]||(e[2]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5 sm:w-6 sm:h-6"},[s("path",{"fill-rule":"evenodd",d:"M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})],-1)])),_:1},8,["to","title"])):(o(),a("div",ve))]),s("div",ye,[S.value?(o(),a("div",he,[s("iframe",{src:`https://www.youtube.com/embed/${S.value}`,frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin",allowfullscreen:"",class:"absolute inset-0 w-full h-full",title:"مشغل فيديو الدرس"},null,8,_e)])):r.value.youtube_url?(o(),a("div",xe,[s("p",null,[e[3]||(e[3]=j("تعذر استخلاص معرف الفيديو من الرابط: ")),s("code",we,f(r.value.youtube_url),1),e[4]||(e[4]=j("."))]),e[5]||(e[5]=s("p",{class:"mt-1"},"قد يكون الرابط غير صحيح أو بتنسيق غير مدعوم.",-1))])):(o(),a("div",be,e[6]||(e[6]=[s("p",null,"لا يوجد رابط يوتيوب متاح لهذا الدرس.",-1)])))]),s("div",ke,[r.value.category_id&&y.value?(o(),B(n,{key:0,to:`/lessons/${y.value.id}`,class:"w-11 h-11 sm:w-14 sm:h-14 flex items-center justify-center rounded-full text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-900",title:`الدرس التالي: ${y.value.title}`,"aria-label":"الدرس التالي"},{default:L(()=>e[7]||(e[7]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5 sm:w-6 sm:h-6"},[s("path",{"fill-rule":"evenodd",d:"M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})],-1)])),_:1},8,["to","title"])):(o(),a("div",Ce))])]),s("div",Le,[e[8]||(e[8]=s("h2",{class:"text-2xl font-semibold text-brown-dark dark:text-brown-dark mb-3"},"عن الدرس:",-1)),r.value.description?(o(),a("div",De,[s("p",Me,f(r.value.description),1)])):(o(),a("p",Ne," لا يوجد وصف متاح لهذا الدرس. "))]),s("div",Pe,[e[10]||(e[10]=s("h3",{class:"text-lg font-semibold text-brown-dark dark:text-brown-dark mb-4"},"ملفات مرتبطة:",-1)),k.value.length>0?(o(),a("div",$e,[(o(!0),a(X,null,Y(k.value,l=>(o(),a("div",{key:l.id},[l.storage_path?(o(),a("button",{key:0,onClick:u=>T(l.storage_path,l.title),class:"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:focus:ring-offset-gray-800 transition-colors",style:{backgroundColor:"var(--color-olive-green)"},title:`عرض ${l.title}`},[e[9]||(e[9]=s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5 me-2","aria-hidden":"true",focusable:"false"},[s("path",{"fill-rule":"evenodd",d:"M4.5 2A1.5 1.5 0 0 0 3 3.5v13A1.5 1.5 0 0 0 4.5 18h11a1.5 1.5 0 0 0 1.5-1.5V7.621a1.5 1.5 0 0 0-.44-1.06l-4.12-4.122A1.5 1.5 0 0 0 11.378 2H4.5Zm4.75 8.75a.75.75 0 0 1 .75.75v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 .75-.75Z","clip-rule":"evenodd"}),s("path",{"fill-rule":"evenodd",d:"M9 3.5a.5.5 0 0 0-.5.5v2.75A1.75 1.75 0 0 0 10.25 8.5h2.75a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 0-.5-.5h-3ZM11 5.75v1.75a.25.25 0 0 0 .25.25h1.75a.25.25 0 0 0 .25-.25V5.75H11Z","clip-rule":"evenodd"})],-1)),s("span",null,"عرض: "+f(l.title)+" ("+f(l.is_research?"بحث":l.is_transcript?"تفريغ":"كتاب")+")",1)],8,Be)):(o(),a("span",Ee,"("+f(l.title)+" - لا يوجد ملف مرفق)",1))]))),128))])):(o(),a("p",Ae," لا توجد ملفات إضافية متاحة للتحميل لهذا الدرس. "))]),p.value!==-1&&r.value?(o(),B(oe,{key:0,"lesson-id":p.value},null,8,["lesson-id"])):W("",!0)])),C(d,null,{default:L(()=>[C(_(F),{show:D.value,"storage-path":I.value,"book-title":V.value,onClose:q},null,8,["show","storage-path","book-title"])]),_:1})])}}}),We=Q(Ie,[["__scopeId","data-v-6dc4eee0"]]);export{We as default};
