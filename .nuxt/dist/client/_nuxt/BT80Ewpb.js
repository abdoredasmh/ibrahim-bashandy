import{e as O,u as $,r as n,k as j,c as a,a as e,i as f,d as y,t as d,F as q,j as A,v as F,x as m,y as w,a6 as N,a9 as H,o,n as D,_ as G}from"./CaF1xe-H.js";const P={class:"p-4 md:p-6 lg:p-8"},J={key:0,class:"text-center py-10"},K={key:1,class:"text-center py-10 p-4 bg-red-100 dark:bg-red-900/50 border border-red-300 dark:border-red-700 text-red-800 dark:text-red-200 rounded-md"},Q={key:2,class:"overflow-x-auto bg-white dark:bg-gray-800 rounded-lg shadow border border-cream-gray dark:border-gray-700"},R={class:"min-w-full divide-y divide-cream-gray dark:divide-gray-700"},W={class:"bg-white dark:bg-gray-800 divide-y divide-cream-gray dark:divide-gray-700"},X={class:"table-td font-medium text-brown-dark dark:text-beige-light"},Y={class:"table-td"},Z={class:"table-td text-gray-700 dark:text-gray-300"},ee={class:"table-td text-center"},te=["onClick"],le={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},se={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},re={class:"sr-only"},ae={class:"table-td text-left font-medium space-x-reverse space-x-2"},oe=["onClick"],ie=["onClick"],ne={key:3,class:"text-center py-10"},de={key:4,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},ue={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},ce={class:"inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-right overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full"},pe={class:"bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},ve={class:"sm:flex sm:items-start w-full"},me={class:"mt-3 text-center sm:mt-0 sm:text-right w-full"},ge={class:"text-lg leading-6 font-medium text-gray-900 dark:text-white mb-5",id:"modal-title"},be={class:"space-y-5"},fe={for:"modal-link",class:"form-label"},ye={key:0,class:"text-red-500"},xe=["required"],he={class:"flex items-center"},ke={key:0,class:"mt-4 p-3 form-success-message"},we={key:1,class:"mt-4 p-3 form-error-message"},_e={class:"bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Ce=["disabled"],Me={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Se=O({__name:"index",setup(Ee){const g=$(),x=n([]),_=n(!1),h=n(null),k=n(!1),u=n(null),p=n(!1),v=n(null),i=n(null),S={title:"",details:"",type:"announcement",date:"",link:"",is_published:!1},r=n({...S});function L(s){if(!s)return null;try{return new Date(s).toLocaleDateString("ar-EG",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch(t){return console.error("Error formatting date:",t),"تاريخ غير صالح"}}function V(s){if(!s)return"";try{const t=new Date(s);return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t.toISOString().slice(0,16)}catch{return""}}function z(s){switch(s){case"lecture":return"محاضرة/درس";case"announcement":return"إعلان عام";case"live":return"بث مباشر";default:return String(s)}}async function b(){_.value=!0,h.value=null;try{const{data:s,error:t}=await g.from("announcements").select("*").order("created_at",{ascending:!1});if(t)throw t;x.value=s||[]}catch(s){console.error("Error fetching announcements:",s),h.value=s.message||"فشل تحميل قائمة الإعلانات.",x.value=[]}finally{_.value=!1}}j(b);function B(){u.value=null,r.value={...S},v.value=null,i.value=null,k.value=!0}function T(s){u.value=s,r.value={title:s.title,details:s.details??"",type:s.type,date:V(s.date),link:s.link??"",is_published:s.is_published},v.value=null,i.value=null,k.value=!0}function C(){k.value=!1,u.value=null}const E=async()=>{var s,t;if(p.value=!0,v.value=null,i.value=null,(r.value.type==="live"||r.value.type==="lecture")&&!r.value.link){i.value="حقل الرابط مطلوب للمحاضرات والبث المباشر.",p.value=!1;return}try{const l={title:r.value.title,details:r.value.details||null,type:r.value.type,date:r.value.date?new Date(r.value.date).toISOString():null,link:r.value.link||null,is_published:r.value.is_published};let c;if(u.value){const{error:M}=await g.from("announcements").update(l).match({id:u.value.id});c=M}else{const{error:M}=await g.from("announcements").insert([l]);c=M}if(c)throw c;v.value=u.value?"تم التحديث بنجاح!":"تمت الإضافة بنجاح!",await b(),C()}catch(l){console.error("Error saving announcement:",l),(s=l.message)!=null&&s.includes("announcement_type")?i.value='خطأ في النوع المحدد. تأكد من تحديث قاعدة البيانات لتشمل النوع "live".':(t=l.message)!=null&&t.includes("violates check constraint")?i.value="حدث خطأ في البيانات المدخلة، يرجى المراجعة.":i.value=l.message||"حدث خطأ غير متوقع."}finally{p.value=!1}};async function U(s){if(confirm("هل أنت متأكد من رغبتك في حذف هذا الإعلان؟ لا يمكن التراجع عن هذا الإجراء.")){i.value=null;try{const{error:t}=await g.from("announcements").delete().match({id:s});if(t)throw t;await b()}catch(t){console.error("Error deleting announcement:",t),i.value=`فشل حذف الإعلان: ${t.message}`}}}async function I(s){const t=!s.is_published;i.value=null;try{const{error:l}=await g.from("announcements").update({is_published:t}).match({id:s.id});if(l)throw l;await b()}catch(l){console.error("Error toggling publish status:",l),i.value=`فشل تحديث حالة النشر: ${l.message}`}}return(s,t)=>(o(),a("div",P,[e("div",{class:"flex justify-between items-center mb-6 border-b border-cream-gray dark:border-gray-700 pb-3"},[t[7]||(t[7]=e("h1",{class:"text-2xl font-bold text-brown-dark dark:text-beige-light"}," إدارة المواعيد والإعلانات ",-1)),e("button",{onClick:B,class:"inline-flex items-center px-4 py-2 bg-primary text-white text-sm font-medium rounded-md shadow-sm hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary dark:focus:ring-offset-gray-800"},t[6]||(t[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 me-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),y(" إضافة جديد ")]))]),_.value?(o(),a("div",J,t[8]||(t[8]=[e("p",{class:"text-gray-500 dark:text-gray-400 mb-3"},"جاري تحميل الإعلانات...",-1),e("div",{class:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] text-primary motion-reduce:animate-[spin_1.5s_linear_infinite]",role:"status"},[e("span",{class:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]"},"Loading...")],-1)]))):h.value?(o(),a("div",K,[e("p",null,"خطأ في تحميل القائمة: "+d(h.value),1),e("button",{onClick:b,class:"mt-2 px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700"}," إعادة المحاولة ")])):x.value.length>0?(o(),a("div",Q,[e("table",R,[t[11]||(t[11]=e("thead",{class:"bg-gray-50 dark:bg-gray-700/50"},[e("tr",null,[e("th",{scope:"col",class:"table-th"},"العنوان"),e("th",{scope:"col",class:"table-th"},"النوع"),e("th",{scope:"col",class:"table-th"},"التاريخ"),e("th",{scope:"col",class:"table-th text-center"},"منشور؟"),e("th",{scope:"col",class:"table-th text-left"},"إجراءات")])],-1)),e("tbody",W,[(o(!0),a(q,null,A(x.value,l=>(o(),a("tr",{key:l.id,class:"table-tr"},[e("td",X,d(l.title),1),e("td",Y,[e("span",{class:D(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",l.type==="lecture"?"bg-blue-100 text-blue-800 dark:bg-blue-900/70 dark:text-blue-200":l.type==="live"?"bg-red-100 text-red-800 dark:bg-red-900/70 dark:text-red-200 animate-pulse":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/70 dark:text-yellow-200"])},d(z(l.type)),3)]),e("td",Z,d(L(l.date)||"غير محدد"),1),e("td",ee,[e("button",{onClick:c=>I(l),class:D(["p-1 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition-colors duration-150",l.is_published?"bg-green-100 text-green-700 hover:bg-green-200 focus:ring-green-500 dark:bg-green-900/50 dark:text-green-300 dark:hover:bg-green-800/60":"bg-red-100 text-red-700 hover:bg-red-200 focus:ring-red-500 dark:bg-red-900/50 dark:text-red-300 dark:hover:bg-red-800/60"])},[l.is_published?(o(),a("svg",le,t[9]||(t[9]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"},null,-1)]))):(o(),a("svg",se,t[10]||(t[10]=[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"},null,-1)]))),e("span",re,d(l.is_published?"إلغاء النشر":"نشر"),1)],10,te)]),e("td",ae,[e("button",{onClick:c=>T(l),class:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300"},"تعديل",8,oe),e("button",{onClick:c=>U(l.id),class:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300"},"حذف",8,ie)])]))),128))])])])):(o(),a("div",ne,t[12]||(t[12]=[e("p",{class:"text-gray-500 dark:text-gray-400"},"لا توجد إعلانات أو مواعيد حاليًا.",-1)]))),k.value?(o(),a("div",de,[e("div",ue,[e("div",{onClick:C,class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity dark:bg-gray-900 dark:bg-opacity-80","aria-hidden":"true"}),t[23]||(t[23]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",ce,[e("div",pe,[e("div",ve,[e("div",me,[e("h3",ge,d(u.value?"تعديل":"إضافة جديد"),1),e("form",{onSubmit:F(E,["prevent"])},[e("div",be,[e("div",null,[t[13]||(t[13]=e("label",{for:"modal-title-input",class:"form-label"},[y("العنوان "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>r.value.title=l),type:"text",id:"modal-title-input",required:"",class:"form-input"},null,512),[[w,r.value.title]])]),e("div",null,[t[14]||(t[14]=e("label",{for:"modal-details",class:"form-label"},"التفاصيل",-1)),m(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=l=>r.value.details=l),id:"modal-details",rows:"4",class:"form-textarea"},null,512),[[w,r.value.details]])]),e("div",null,[t[16]||(t[16]=e("label",{for:"modal-type",class:"form-label"},[y("النوع "),e("span",{class:"text-red-500"},"*")],-1)),m(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>r.value.type=l),id:"modal-type",required:"",class:"form-select"},t[15]||(t[15]=[e("option",{value:"lecture"},"محاضرة / درس",-1),e("option",{value:"announcement"},"إعلان عام",-1),e("option",{value:"live"},"بث مباشر",-1)]),512),[[N,r.value.type]])]),e("div",null,[t[17]||(t[17]=e("label",{for:"modal-date",class:"form-label"},"التاريخ والوقت",-1)),m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>r.value.date=l),type:"datetime-local",id:"modal-date",class:"form-input"},null,512),[[w,r.value.date]]),t[18]||(t[18]=e("p",{class:"form-help-text"},"مهم للمحاضرات والبث المباشر لتحديد وقت البدء.",-1))]),e("div",null,[e("label",fe,[t[19]||(t[19]=y("الرابط ")),r.value.type==="live"||r.value.type==="lecture"?(o(),a("span",ye,"*")):f("",!0)]),m(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>r.value.link=l),type:"url",id:"modal-link",required:r.value.type==="live"||r.value.type==="lecture",class:"form-input",placeholder:"https://..."},null,8,xe),[[w,r.value.link]]),t[20]||(t[20]=e("p",{class:"form-help-text"},"رابط البث (يوتيوب، فيسبوك، إلخ) أو رابط تفاصيل الإعلان.",-1))]),e("div",he,[m(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>r.value.is_published=l),id:"modal-is_published",type:"checkbox",class:"h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary dark:bg-gray-600 dark:border-gray-500"},null,512),[[H,r.value.is_published]]),t[21]||(t[21]=e("label",{for:"modal-is_published",class:"ms-2 block text-sm text-gray-900 dark:text-gray-300"},"نشر (جعله مرئياً للعامة)",-1))])]),v.value?(o(),a("div",ke,d(v.value),1)):f("",!0),i.value?(o(),a("div",we,"خطأ: "+d(i.value),1)):f("",!0)],32)])])]),e("div",_e,[e("button",{onClick:E,disabled:p.value,type:"button",class:"modal-button-primary"},[p.value?(o(),a("svg",Me,t[22]||(t[22]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):f("",!0),y(" "+d(p.value?"جاري الحفظ...":u.value?"حفظ التعديلات":"إضافة"),1)],8,Ce),e("button",{onClick:C,type:"button",class:"modal-button-secondary"},"إلغاء")])])])])):f("",!0)]))}}),Le=G(Se,[["__scopeId","data-v-8f013c71"]]);export{Le as default};
