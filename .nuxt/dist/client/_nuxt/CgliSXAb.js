import{_ as C}from"./C2nUyU-9.js";import{L}from"./CpjGp_h0.js";import{e as M,u as P,r as p,l as x,p as V,w as r,o as u,b as n,h as d,a as e,t as g,c,d as B,i as z,_ as S}from"./CaF1xe-H.js";import{Y as U,h as w,G as E,V as A,S as j}from"./vWwLff75.js";const N={class:"fixed inset-0 overflow-y-auto"},T={class:"flex min-h-full items-center justify-center p-4 text-center"},D={class:"truncate"},F={class:"mt-2 flex-grow border border-cream-gray dark:border-gray-700 rounded overflow-hidden flex flex-col min-h-[400px]"},G={key:0,class:"flex items-center justify-center h-full p-8","aria-live":"polite"},Y={key:1,class:"flex flex-col items-center justify-center h-full p-8 text-red-600 dark:text-red-400 text-center","aria-live":"assertive"},$={class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},H=["src","title"],I={key:3,class:"flex items-center justify-center h-full p-8 text-gray-500 dark:text-gray-400"},K={class:"mt-4 text-start flex-shrink-0"},O=["href"],q="book-files",J=M({__name:"PdfViewerModal",props:{show:Boolean,storagePath:String,bookTitle:String},emits:["close"],setup(f,{emit:y}){const o=f,h=y,b=P(),a=p(null),i=p(!1),s=p(null);function k(l){if(console.error("Storage Error:",l),"statusCode"in l)switch(l.statusCode){case"404":return"الملف المطلوب غير موجود. قد يكون تم حذفه أو تغيير مساره.";case"403":return"ليس لديك الصلاحية للوصول إلى هذا الملف.";case"400":return"حدث خطأ في طلب الملف. يرجى التحقق من صحة الرابط.";default:return`حدث خطأ غير متوقع (${l.statusCode}). يرجى المحاولة مرة أخرى.`}return l.message||"حدث خطأ غير معروف أثناء محاولة الوصول للملف."}async function v(){if(!o.storagePath||o.storagePath.trim()===""){a.value=null,s.value="لم يتم توفير مسار صالح للملف.",i.value=!1;return}i.value=!0,s.value=null,a.value=null;try{const{data:l,error:t}=await b.storage.from(q).getPublicUrl(o.storagePath);if(t)throw t;if(!(l!=null&&l.publicUrl))throw new Error("لم يتم استلام رابط عام صالح للملف من الخادم.");a.value=l.publicUrl}catch(l){s.value=k(l),a.value=null}finally{i.value=!1}}x(()=>o.show,l=>{l?v():(a.value=null,s.value=null,i.value=!1)}),x(()=>o.storagePath,(l,t)=>{o.show&&l!==t&&l?v():o.show&&!l&&(a.value=null,s.value="تمت إزالة مسار الملف.",i.value=!1)});function m(){h("close")}return(l,t)=>{const _=C;return u(),V(_,null,{default:r(()=>[n(d(j),{appear:"",show:f.show,as:"div"},{default:r(()=>[n(d(U),{as:"div",onClose:m,class:"relative z-50"},{default:r(()=>[n(d(w),{as:"div",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:r(()=>t[0]||(t[0]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-60 dark:bg-gray-900 dark:bg-opacity-75"},null,-1)])),_:1}),e("div",N,[e("div",T,[n(d(w),{as:"div",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:r(()=>[n(d(E),{class:"w-full max-w-4xl transform overflow-hidden rounded-2xl bg-beige-light dark:bg-cream-gray p-6 text-end shadow-xl transition-all flex flex-col max-h-[90vh]"},{default:r(()=>[n(d(A),{as:"h3",class:"text-lg font-medium leading-6 text-brown-dark dark:text-brown-dark mb-4 flex justify-between items-center flex-shrink-0"},{default:r(()=>[e("button",{type:"button",class:"button-close",onClick:m,"aria-label":"إغلاق العارض"},t[1]||(t[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},[e("title",null,"إغلاق"),e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1),e("span",{class:"hidden sm:inline ms-1"},"إغلاق",-1)])),e("span",D,g(f.bookTitle||"عرض المستند"),1)]),_:1}),e("div",F,[i.value?(u(),c("div",G,[n(L),t[2]||(t[2]=e("p",{class:"ms-3 text-gray-600 dark:text-gray-400"},"جارٍ تحميل الملف...",-1))])):s.value?(u(),c("div",Y,[t[3]||(t[3]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-12 h-12 mb-3 text-red-500",fill:"currentColor",viewBox:"0 0 20 20"},[e("title",null,"خطأ"),e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.763-1.36 2.683-1.36 3.446 0l6.518 11.636c.75 1.34-.213 3.01-1.723 3.01H3.462c-1.51 0-2.473-1.67-1.723-3.01L8.257 3.1zM11 13a1 1 0 10-2 0 1 1 0 002 0zm-1-6a1 1 0 00-.993.883L9 8v3a1 1 0 001.993.117L11 11V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),t[4]||(t[4]=e("p",{class:"font-semibold"},"حدث خطأ أثناء تحميل الملف.",-1)),e("p",$,g(s.value),1),t[5]||(t[5]=B(" {/* Display user-friendly error */} ")),e("button",{onClick:v,class:"mt-4 button-secondary text-sm"}," إعادة المحاولة ")])):a.value?(u(),c("iframe",{key:2,src:a.value,class:"w-full h-full border-none flex-grow",frameborder:"0",title:`عارض PDF لـ ${f.bookTitle||"المستند"}`,allow:"fullscreen",sandbox:"allow-scripts allow-same-origin allow-popups"},t[6]||(t[6]=[e("p",{class:"p-4 text-center text-gray-600 dark:text-gray-400"},"متصفحك لا يدعم عرض PDF في إطار. حاول استخدام زر التنزيل.",-1)]),8,H)):(u(),c("div",I,t[7]||(t[7]=[e("p",null,"لم يتم تحديد ملف لعرضه.",-1)])))]),e("div",K,[a.value&&!s.value?(u(),c("a",{key:0,href:a.value,target:"_blank",download:"",class:"button-primary",rel:"noopener noreferrer"},t[8]||(t[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-5 h-5 me-2",fill:"currentColor",viewBox:"0 0 20 20"},[e("title",null,"تنزيل"),e("path",{"fill-rule":"evenodd",d:"M3 14.25A2.25 2.25 0 015.25 12h9.5A2.25 2.25 0 0117 14.25v1.5A2.25 2.25 0 0114.75 18h-9.5A2.25 2.25 0 013 15.75v-1.5zM10 3a.75.75 0 01.75.75v6.19l2.22-2.22a.75.75 0 111.06 1.06l-3.5 3.5a.75.75 0 01-1.06 0l-3.5-3.5a.75.75 0 111.06-1.06l2.22 2.22V3.75A.75.75 0 0110 3z","clip-rule":"evenodd"})],-1),e("span",null,"تنزيل الملف",-1)]),8,O)):z("",!0)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])]),_:1})}}}),Z=S(J,[["__scopeId","data-v-ac07dbfb"]]);export{Z as default};
