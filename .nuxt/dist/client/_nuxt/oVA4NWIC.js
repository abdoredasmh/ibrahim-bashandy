import{_ as we}from"./CEyFpblA.js";import{e as fe,u as be,r as d,A as ke,g as ie,l as de,p as ce,w as F,h as A,o as r,b as C,a as e,d as z,t as v,v as $e,c as n,i as b,x as M,y as X,a6 as T,F as Y,j as H,_ as _e,k as Ce,a7 as Se,T as se,n as De}from"./CaF1xe-H.js";import{L as re}from"./CpjGp_h0.js";import{h as ye,G as Me,V as Ee,Y as Ve,S as Le}from"./vWwLff75.js";import{_ as Fe}from"./D3bMg26Z.js";import{u as Ne}from"./C0vmt3Ib.js";import{u as Ae}from"./C6ZBagnb.js";const Ue={class:"fixed inset-0 overflow-y-auto"},Ie={class:"flex min-h-full items-center justify-center p-4 text-center"},je={key:0,class:"form-error",id:"title-error"},Be={key:0,class:"form-error",id:"youtube-error"},Oe={key:0,class:"form-loading-text"},ze=["value"],Te={key:0,disabled:""},qe={key:0,class:"form-loading-text"},Pe=["value"],Re={key:0,disabled:""},Ze={key:0,class:"space-y-4 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700"},Ge={key:0,class:"form-loading-text"},Je={key:1,class:"form-hint bg-yellow-50 dark:bg-yellow-900/30 p-2 rounded border border-yellow-200 dark:border-yellow-700"},Ye={key:2,class:"form-error bg-red-100 dark:bg-red-900/30 p-2 rounded"},He=["value"],We={key:4,class:"admin-input bg-gray-100 dark:bg-gray-600 cursor-not-allowed italic text-gray-500 dark:text-gray-400"},Qe={class:"form-hint"},Ke={key:1,class:"form-error p-2 bg-red-100 dark:bg-red-900/30 rounded"},Xe={class:"mt-6 pt-4 border-t dark:border-gray-700 flex justify-end space-x-3 rtl:space-x-reverse"},et=["disabled"],tt={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},lt=fe({__name:"AdminLessonModal",props:{show:{type:Boolean},lessonData:{},preselectedCourseId:{}},emits:["close","saved"],setup(ve,{emit:q}){const c=ve,U=q,w=be(),k=d(!1),_=d(null),g=ke({title:"",youtube_url:""}),o=d({title:"",description:null,youtube_url:"",category_id:null,course_id:null,module_number:null,lesson_order:null}),$=d([]),S=d([]),x=d([]),E=d(!1),h=d(!1),m=d(!1),y=d(null),V=ie(()=>{var u;return!!((u=c.lessonData)!=null&&u.id)});async function L(u){if(!u){x.value=[],m.value=!1,y.value=null,console.log("No course ID provided, clearing modules.");return}console.log(`Fetching modules for course ID: ${u}`),m.value=!0,y.value=null,x.value=[];try{const{data:l,error:i}=await w.from("course_modules").select("id, title, module_number").eq("course_id",u).order("module_number",{ascending:!0});if(i)throw i;x.value=l||[],console.log(`Fetched ${x.value.length} modules for course ${u}`)}catch(l){console.error(`Error fetching modules for course ${u}:`,l),y.value=l.message||"فشل تحميل وحدات الدورة."}finally{m.value=!1}}const P=(u=null)=>{console.log("Resetting form. Initial Course ID:",u),o.value={title:"",description:null,youtube_url:"",category_id:null,course_id:u,module_number:null,lesson_order:null},_.value=null,g.title="",g.youtube_url="",x.value=[],m.value=!1,y.value=null,u&&L(u)};async function R(){if($.value.length>0&&S.value.length>0||E.value||h.value){console.log("[fetchStaticDropdownData] Skipping fetch (already loaded or loading).");return}console.log("[fetchStaticDropdownData] Starting..."),E.value=!0,h.value=!0,_.value=null;try{const[u,l]=await Promise.all([w.from("categories").select("id, name").order("name"),w.from("study_courses").select("id, title").order("title")]);if(u.error)throw new Error(`فشل تحميل الفئات: ${u.error.message}`);if($.value=u.data??[],l.error)throw new Error(`فشل تحميل الدورات: ${l.error.message}`);S.value=l.data??[],console.log(`[fetchStaticDropdownData] ${$.value.length} categories, ${S.value.length} courses loaded.`)}catch(u){console.error("Error in fetchStaticDropdownData:",u),$.value=[],S.value=[],_.value=u.message||"فشل تحميل بيانات القوائم."}finally{E.value=!1,h.value=!1}}function W(){const u=o.value.course_id;console.log("Course changed to:",u),o.value.module_number=null,o.value.lesson_order=null,L(u)}de(()=>c.show,(u,l)=>{var i;if(u&&!l){if(console.log("Modal opened. Fetching static data and initializing form."),R(),(i=c.lessonData)!=null&&i.id){console.log("Watcher (show=true): Initializing for edit");const{id:f,title:j,description:B,youtube_url:Z,category_id:G,course_id:Q,module_number:oe,lesson_order:ae}=c.lessonData;o.value={id:f,title:j,description:B,youtube_url:Z,category_id:G,course_id:Q,module_number:oe,lesson_order:ae},Q?L(Q):x.value=[]}else console.log("Watcher (show=true): Initializing for add with preselected:",c.preselectedCourseId),P(c.preselectedCourseId??null);_.value=null,g.title="",g.youtube_url=""}else!u&&l&&console.log("Modal closed.")},{immediate:!0});function I(){k.value||U("close")}const le=()=>{var l,i;let u=!0;if(g.title="",g.youtube_url="",_.value=null,(l=o.value.title)!=null&&l.trim()||(g.title="حقل العنوان مطلوب.",u=!1),!((i=o.value.youtube_url)!=null&&i.trim()))g.youtube_url="حقل رابط يوتيوب مطلوب.",u=!1;else try{const f=new URL(o.value.youtube_url);["www.youtube.com","youtube.com","youtu.be"].includes(f.hostname)||(g.youtube_url="رابط يوتيوب غير صالح.",u=!1)}catch{g.youtube_url="صيغة الرابط غير صحيحة.",u=!1}return u};async function N(){var l,i;if(console.log("Attempting to save lesson..."),!le()){console.log("Validation failed.");return}k.value=!0,_.value=null;const u={title:o.value.title,description:((l=o.value.description)==null?void 0:l.trim())||null,youtube_url:o.value.youtube_url,category_id:o.value.category_id?Number(o.value.category_id):null,course_id:o.value.course_id?Number(o.value.course_id):null,module_number:o.value.course_id&&o.value.module_number?Number(o.value.module_number):null,lesson_order:o.value.course_id&&o.value.lesson_order?Number(o.value.lesson_order):null};u.course_id===null&&(u.module_number=null,u.lesson_order=null),console.log("Payload to send:",JSON.stringify(u,null,2));try{let f=null,j=null;if(V.value&&o.value.id){console.log(`Attempting UPDATE for lesson ID: ${o.value.id}`);const{id:B,...Z}=u,G=await w.from("lessons").update(Z).eq("id",o.value.id).select();f=G.error,j=G.data}else{console.log("Attempting INSERT for new lesson");const B=await w.from("lessons").insert(u).select();f=B.error,j=B.data}if(console.log("Supabase response error:",JSON.stringify(f,null,2)),console.log("Supabase response data:",JSON.stringify(j,null,2)),f)throw f;console.log("Save successful, emitting saved event."),U("saved"),I()}catch(f){console.error("Error during save operation:",JSON.stringify(f,null,2)),(i=f.message)!=null&&i.includes("violates foreign key constraint")?_.value="فشل الحفظ: الفئة أو الدورة المحددة غير موجودة.":f.code==="23505"?_.value=`فشل الحفظ: ${f.message}`:_.value=`فشل حفظ الدرس: ${f.message||"خطأ غير متوقع"}`}finally{k.value=!1,console.log("saveLesson finished.")}}return(u,l)=>(r(),ce(A(Le),{appear:"",show:u.show,as:"template"},{default:F(()=>[C(A(Ve),{as:"div",onClose:I,class:"relative z-50"},{default:F(()=>[C(A(ye),{as:"div",class:"fixed inset-0 bg-black/30 backdrop-blur-sm",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"}),e("div",Ue,[e("div",Ie,[C(A(ye),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:F(()=>[C(A(Me),{class:"w-full max-w-2xl transform overflow-hidden rounded-2xl bg-white dark:bg-gray-800 p-6 text-right shadow-xl transition-all"},{default:F(()=>[C(A(Ee),{as:"h3",class:"admin-modal-title"},{default:F(()=>[z(v(V.value?"تعديل الدرس":"إضافة درس جديد"),1)]),_:1}),e("form",{onSubmit:$e(N,["prevent"]),class:"space-y-4"},[e("div",null,[l[7]||(l[7]=e("label",{for:"title",class:"admin-label"},"العنوان *",-1)),M(e("input",{type:"text",id:"title","onUpdate:modelValue":l[0]||(l[0]=i=>o.value.title=i),required:"",class:"admin-input","aria-describedby":"title-error"},null,512),[[X,o.value.title]]),g.title?(r(),n("p",je,v(g.title),1)):b("",!0)]),e("div",null,[l[8]||(l[8]=e("label",{for:"description",class:"admin-label"},"الوصف",-1)),M(e("textarea",{id:"description",rows:"4","onUpdate:modelValue":l[1]||(l[1]=i=>o.value.description=i),class:"admin-textarea"},null,512),[[X,o.value.description]])]),e("div",null,[l[9]||(l[9]=e("label",{for:"youtube_url",class:"admin-label"},"رابط يوتيوب *",-1)),M(e("input",{type:"url",id:"youtube_url","onUpdate:modelValue":l[2]||(l[2]=i=>o.value.youtube_url=i),required:"",placeholder:"https://...",class:"admin-input","aria-describedby":"youtube-error"},null,512),[[X,o.value.youtube_url]]),g.youtube_url?(r(),n("p",Be,v(g.youtube_url),1)):b("",!0)]),e("div",null,[l[11]||(l[11]=e("label",{for:"category_id",class:"admin-label"},"الفئة",-1)),E.value?(r(),n("div",Oe,"جار تحميل الفئات...")):M((r(),n("select",{key:1,id:"category_id","onUpdate:modelValue":l[3]||(l[3]=i=>o.value.category_id=i),class:"admin-select"},[l[10]||(l[10]=e("option",{value:null},"-- اختر فئة (اختياري) --",-1)),(r(!0),n(Y,null,H($.value,i=>(r(),n("option",{key:i.id,value:i.id},v(i.name),9,ze))),128)),!E.value&&$.value.length===0?(r(),n("option",Te,"-- لا توجد فئات متاحة --")):b("",!0)],512)),[[T,o.value.category_id]])]),e("div",null,[l[13]||(l[13]=e("label",{for:"course_id",class:"admin-label"},"الدورة الدراسية (اختياري)",-1)),h.value?(r(),n("div",qe,"جار تحميل الدورات...")):M((r(),n("select",{key:1,id:"course_id","onUpdate:modelValue":l[4]||(l[4]=i=>o.value.course_id=i),onChange:W,class:"admin-select"},[l[12]||(l[12]=e("option",{value:null},"-- درس عام (لا يتبع دورة) --",-1)),(r(!0),n(Y,null,H(S.value,i=>(r(),n("option",{key:i.id,value:i.id},v(i.title),9,Pe))),128)),!h.value&&S.value.length===0?(r(),n("option",Re,"-- لا توجد دورات متاحة --")):b("",!0)],544)),[[T,o.value.course_id]])]),o.value.course_id?(r(),n("div",Ze,[e("div",null,[l[15]||(l[15]=e("label",{for:"module_number",class:"admin-label"},"الوحدة داخل الدورة",-1)),m.value?(r(),n("div",Ge,"جار تحميل الوحدات...")):!m.value&&x.value.length===0&&!y.value?(r(),n("p",Je,' لم يتم تعريف وحدات لهذه الدورة بعد. يمكنك إضافتها من شاشة "تعديل الدورة". ')):y.value?(r(),n("p",Ye,"خطأ تحميل الوحدات: "+v(y.value),1)):x.value.length>0?M((r(),n("select",{key:3,id:"module_number","onUpdate:modelValue":l[5]||(l[5]=i=>o.value.module_number=i),class:"admin-select"},[l[14]||(l[14]=e("option",{value:null},"-- درس بدون وحدة (عام داخل الدورة) --",-1)),(r(!0),n(Y,null,H(x.value,i=>(r(),n("option",{key:i.module_number,value:i.module_number}," #"+v(i.module_number)+" - "+v(i.title),9,He))),128))],512)),[[T,o.value.module_number,void 0,{number:!0}]]):!m.value&&x.value.length===0?(r(),n("div",We,"لا توجد وحدات")):b("",!0)]),e("div",null,[l[16]||(l[16]=e("label",{for:"lesson_order",class:"admin-label"},"ترتيب الدرس",-1)),M(e("input",{type:"number",id:"lesson_order","onUpdate:modelValue":l[6]||(l[6]=i=>o.value.lesson_order=i),min:"1",class:"admin-input",placeholder:"اتركه فارغًا للترتيب التلقائي/الأخير"},null,512),[[X,o.value.lesson_order,void 0,{number:!0}]]),e("p",Qe," ترتيب الدرس "+v(o.value.module_number?`داخل الوحدة #${o.value.module_number}`:"العام داخل الدورة")+". (مثال: 1 هو الأول) ",1)])])):b("",!0),_.value?(r(),n("p",Ke," خطأ: "+v(_.value),1)):b("",!0),e("div",Xe,[e("button",{type:"button",onClick:I,class:"button-secondary"},"إلغاء"),e("button",{type:"submit",disabled:k.value||E.value||h.value||m.value,class:"button-primary"},[k.value?(r(),n("svg",tt,l[17]||(l[17]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):b("",!0),z(" "+v(k.value?"جاري الحفظ...":V.value?"حفظ التعديلات":"إضافة الدرس"),1)],8,et)])],32)]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}}),ot=_e(lt,[["__scopeId","data-v-e95ed032"]]),at={class:"container mx-auto px-4 py-8 md:py-12"},st={class:"flex flex-wrap justify-between items-center gap-4 mb-6 pb-4 border-b border-gray-200 dark:border-gray-700"},rt={class:"text-2xl font-semibold text-gray-800 dark:text-gray-100"},nt={class:"text-gray-500 dark:text-gray-400 text-lg"},ut=["disabled"],it={class:"mb-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 bg-gray-50 dark:bg-gray-800/50 p-4 rounded-lg border dark:border-gray-700"},dt=["disabled"],ct=["disabled"],vt={key:0,disabled:""},mt=["value"],gt={key:1,disabled:""},pt=["disabled"],yt={key:0,disabled:""},ft=["value"],bt={key:1,disabled:""},_t={class:"flex gap-2"},ht=["disabled"],xt=["disabled"],wt={key:0,class:"text-center py-16"},kt={key:1,class:"error-box",role:"alert"},$t={class:"block sm:inline"},Ct={key:0,class:"my-4 p-3 bg-green-100 border border-green-300 text-green-800 dark:bg-green-900/40 dark:border-green-700 dark:text-green-200 rounded text-sm font-medium shadow-sm"},St={key:0,class:"my-4 p-3 bg-red-100 border border-red-300 text-red-700 dark:bg-red-900/40 dark:border-red-700 dark:text-red-200 rounded text-sm font-medium shadow-sm"},Dt={key:2,class:"bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg border dark:border-gray-700 relative"},Mt={key:0,class:"absolute inset-0 bg-white/60 dark:bg-gray-800/60 flex items-center justify-center z-10 backdrop-blur-sm rounded-lg"},Et={class:"overflow-x-auto"},Vt={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Lt={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},Ft={class:"px-3 py-2 whitespace-nowrap text-center"},Nt=["onClick","title","disabled"],At=["src","alt"],Ut={key:1,class:"w-20 h-12 bg-gray-200 dark:bg-gray-700 rounded-md flex items-center justify-center text-gray-400 dark:text-gray-500 text-xs italic mx-auto"},It={class:"px-4 py-3"},jt=["title"],Bt={class:"text-xs text-gray-500 dark:text-gray-400 lg:hidden mt-1"},Ot={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},zt={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},Tt={key:1,class:"text-gray-400 dark:text-gray-500 italic"},qt={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 hidden md:table-cell"},Pt={key:0,class:"font-mono text-xs bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded"},Rt={key:1,class:"text-gray-400 dark:text-gray-500 text-xs italic"},Zt={key:2,class:"text-xs"},Gt={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400 hidden lg:table-cell"},Jt={class:"px-4 py-3 whitespace-nowrap text-left text-sm font-medium"},Yt={class:"flex justify-end items-center gap-2"},Ht=["onClick","disabled"],Wt=["onClick","disabled"],Qt={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},Kt={key:3,class:"text-center py-16 text-gray-500 dark:text-gray-400 border border-dashed dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800/20"},Xt={key:0},el={key:1},tl={key:4,class:"mt-6 flex justify-center items-center space-x-2 rtl:space-x-reverse"},ll=["disabled"],ol={class:"text-sm text-gray-700 dark:text-gray-300 px-2 font-medium"},al={class:"text-gray-500 dark:text-gray-400"},sl=["disabled"],ne=15,rl=400,ue=-1,nl=fe({__name:"lessons",setup(ve){Ne({title:"إدارة الدروس"});const q=be(),c=d(!0),U=d(null),w=d(null),k=d(0),_=d(""),g=d(null),o=d(null),$=d("created_at"),S=d("desc"),x=d([]),E=d([]),h=d(!0),m=d(1),y=d(null),V=d(null),L=d(null),P=d(!1),R=d(null),W=d(!1),I=d(null),le=ie(()=>o.value!==null&&o.value!==ue?o.value:null),N=ie(()=>!k.value||k.value<=0?1:Math.ceil(k.value/ne)),u=async()=>{console.log("[fetchFilterOptions] Fetching categories and courses..."),h.value=!0,L.value=null;try{const[a,t]=await Promise.allSettled([q.from("categories").select("id, name").order("name"),q.from("study_courses").select("id, title").order("title")]);a.status==="fulfilled"&&!a.value.error?x.value=a.value.data||[]:(console.error("Error fetching categories:",a.status==="rejected"?a.reason:a.value.error),ee("فشل تحميل قائمة التصنيفات.")),t.status==="fulfilled"&&!t.value.error?E.value=t.value.data||[]:(console.error("Error fetching courses:",t.status==="rejected"?t.reason:t.value.error),ee("فشل تحميل قائمة الدورات.")),console.log(`[fetchFilterOptions] Fetched ${x.value.length} categories, ${E.value.length} courses.`)}catch(a){console.error("Unexpected error in fetchFilterOptions:",a),ee("خطأ غير متوقع في تحميل بيانات الفلاتر.")}finally{h.value=!1}},l=async(a=m.value)=>{c.value=!0,U.value=null,te(!1),console.log(`[fetchLessons] Fetching page ${a}, Filters: Cat=${g.value}, Course=${o.value}, Search='${_.value}', Sort=${$.value} ${S.value}`);const t=(a-1)*ne,D=t+ne-1;try{let p=q.from("lessons").select("id, title, description, youtube_url, category_id, course_id, created_at, module_number, lesson_order, categories ( name ), study_courses ( title )",{count:"exact"});g.value!==null&&(p=p.eq("category_id",g.value)),o.value!==null&&(p=o.value===ue?p.is("course_id",null):p.eq("course_id",o.value));const s=_.value.trim();s&&(p=p.ilike("title",`%${s}%`)),p=p.order($.value,{ascending:S.value==="asc",nullsFirst:!1}),$.value!=="created_at"&&(p=p.order("created_at",{ascending:!1})),p=p.range(t,D),console.log("[fetchLessons] Executing query...");const{data:O,error:J,count:K}=await p;if(console.log(`[fetchLessons] Query executed. Error: ${!!J}, Count: ${K}, Data received: ${(O==null?void 0:O.length)??0}`),J)throw J;w.value=O,k.value=K??0,m.value=a,a>N.value&&N.value>0&&(console.log(`[fetchLessons] Current page ${a} out of bounds. Fetching last page.`),await l(N.value))}catch(p){console.error("[fetchLessons] Error fetching lessons:",p),U.value=p,w.value=null,k.value=0}finally{c.value=!1}},i=Ae(()=>{m.value!==1?m.value=1:l(1)},rl),f=a=>{a>=1&&a<=N.value&&a!==m.value&&!c.value&&(m.value=a)},j=()=>{!c.value&&y.value===null&&(R.value=null,P.value=!0,te())},B=a=>{!c.value&&y.value===null&&(R.value={...a},P.value=!0,te())},Z=()=>{P.value=!1,R.value=null},G=a=>{a&&!y.value&&(I.value=a,W.value=!0)},Q=()=>{W.value=!1,I.value=null},oe=async()=>{Z(),pe("تم حفظ الدرس بنجاح."),await l(m.value)},ae=async a=>{if(!(y.value!==null||c.value)&&window.confirm(`هل أنت متأكد أنك تريد حذف الدرس "${a.title}"؟ لا يمكن التراجع عن هذا الإجراء.`)){y.value=a.id,te();try{console.log(`[confirmDelete] Deleting lesson ID: ${a.id}`);const{error:t}=await q.from("lessons").delete().eq("id",a.id);if(t)throw t;console.log(`[confirmDelete] Lesson ID: ${a.id} deleted successfully.`),pe("تم حذف الدرس بنجاح."),await l(m.value)}catch(t){console.error(`[confirmDelete] Error deleting lesson ID: ${a.id}:`,t),ee(`فشل حذف الدرس: ${t.message||"خطأ غير معروف"}.`)}finally{y.value=null}}},me=(a,t=!1)=>{if(!a)return"-";try{const D=new Date(a);if(isNaN(D.getTime()))return"تاريخ غير صالح";const p=t?{year:"numeric",month:"short",day:"numeric"}:{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"};return D.toLocaleDateString("ar-EG",p)}catch{return"خطأ تنسيق"}},he=a=>{if(!a)return null;const t=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:watch\?v=|embed\/|v\/|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})(?:\S+)?/,D=a.match(t);return(D==null?void 0:D[1])||null},ge=a=>{const t=he(a);return t?`https://img.youtube.com/vi/${t}/mqdefault.jpg`:null},pe=a=>{V.value=a,L.value=null,setTimeout(()=>{V.value=null},4e3)},ee=a=>{L.value=a,V.value=null},te=(a=!0)=>{V.value=null,a&&(L.value=null)},xe=a=>a.course_id?`/study/courses/${a.course_id}/lessons/${a.id}`:"#";return de([g,o,$,S],()=>{m.value!==1?m.value=1:l(1)},{deep:!0}),de(m,(a,t)=>{a!==t&&l(a)}),Ce(async()=>{console.log("[onMounted] Initializing data..."),c.value=!0,h.value=!0,await Promise.all([l(1),u()]),console.log("[onMounted] Initial data fetch complete.")}),(a,t)=>{var p;const D=we;return r(),n("div",at,[e("div",st,[e("h1",rt,[t[9]||(t[9]=z("إدارة الدروس ")),e("span",nt,"("+v(k.value)+")",1)]),e("button",{onClick:j,class:"button-primary inline-flex items-center",disabled:c.value||y.value!==null},t[10]||(t[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5 me-1.5","aria-hidden":"true"},[e("path",{d:"M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"})],-1),z(" إضافة درس جديد ")]),8,ut)]),e("div",it,[e("div",null,[t[11]||(t[11]=e("label",{for:"search-term",class:"admin-label"},"بحث بالعنوان:",-1)),M(e("input",{id:"search-term",type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>_.value=s),disabled:c.value,placeholder:"ابحث...",onInput:t[1]||(t[1]=(...s)=>A(i)&&A(i)(...s)),class:"admin-input"},null,40,dt),[[X,_.value]])]),e("div",null,[t[13]||(t[13]=e("label",{for:"filter-category",class:"admin-label"},"التصنيف:",-1)),M(e("select",{id:"filter-category","onUpdate:modelValue":t[2]||(t[2]=s=>g.value=s),disabled:c.value||h.value,class:"admin-select"},[t[12]||(t[12]=e("option",{value:null},"الكل",-1)),h.value?(r(),n("option",vt,"جاري التحميل...")):b("",!0),(r(!0),n(Y,null,H(x.value,s=>(r(),n("option",{key:s.id,value:s.id},v(s.name),9,mt))),128)),!h.value&&x.value.length===0?(r(),n("option",gt,"لا توجد تصنيفات")):b("",!0)],8,ct),[[T,g.value]])]),e("div",null,[t[15]||(t[15]=e("label",{for:"filter-course",class:"admin-label"},"الدورة الدراسية:",-1)),M(e("select",{id:"filter-course","onUpdate:modelValue":t[3]||(t[3]=s=>o.value=s),disabled:c.value||h.value,class:"admin-select"},[t[14]||(t[14]=e("option",{value:null},"الكل",-1)),e("option",{value:ue},"-- دروس عامة (بلا دورة) --"),h.value?(r(),n("option",yt,"جاري التحميل...")):b("",!0),(r(!0),n(Y,null,H(E.value,s=>(r(),n("option",{key:s.id,value:s.id},v(s.title),9,ft))),128)),!h.value&&E.value.length===0?(r(),n("option",bt,"لا توجد دورات")):b("",!0)],8,pt),[[T,o.value]])]),e("div",null,[t[18]||(t[18]=e("label",{for:"sort-by",class:"admin-label"},"ترتيب حسب:",-1)),e("div",_t,[M(e("select",{id:"sort-by","onUpdate:modelValue":t[4]||(t[4]=s=>$.value=s),disabled:c.value,class:"admin-select flex-grow"},t[16]||(t[16]=[Se('<option value="created_at" data-v-045606d4>تاريخ الإنشاء</option><option value="title" data-v-045606d4>العنوان</option><option value="course_id" data-v-045606d4>الدورة</option><option value="category_id" data-v-045606d4>التصنيف</option><option value="module_number" data-v-045606d4>الوحدة</option><option value="lesson_order" data-v-045606d4>الترتيب</option>',6)]),8,ht),[[T,$.value]]),M(e("select",{"aria-label":"Sort order","onUpdate:modelValue":t[5]||(t[5]=s=>S.value=s),disabled:c.value,class:"admin-select w-24 flex-shrink-0"},t[17]||(t[17]=[e("option",{value:"desc"},"تنازلي",-1),e("option",{value:"asc"},"تصاعدي",-1)]),8,xt),[[T,S.value]])])])]),c.value&&!((p=w.value)!=null&&p.length)?(r(),n("div",wt,[C(re,{class:"w-10 h-10"}),t[19]||(t[19]=e("p",{class:"mt-3 text-gray-500 dark:text-gray-400"},"جاري تحميل الدروس...",-1))])):U.value?(r(),n("div",kt,[t[20]||(t[20]=e("strong",{class:"font-bold"},"خطأ في جلب البيانات!",-1)),e("span",$t,v(U.value.message||"حدث خطأ أثناء جلب الدروس."),1),e("button",{onClick:t[6]||(t[6]=()=>l(1)),class:"ml-2 mt-2 sm:mt-0 underline text-sm font-medium text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300"},"إعادة المحاولة")])):b("",!0),C(se,{name:"fade"},{default:F(()=>[V.value?(r(),n("div",Ct,v(V.value),1)):b("",!0)]),_:1}),C(se,{name:"fade"},{default:F(()=>[L.value?(r(),n("div",St,v(L.value),1)):b("",!0)]),_:1}),w.value&&w.value.length>0?(r(),n("div",Dt,[C(se,{name:"fade"},{default:F(()=>[c.value||y.value!==null?(r(),n("div",Mt,[C(re,{class:"w-8 h-8 text-primary-500"})])):b("",!0)]),_:1}),e("div",Et,[e("table",Vt,[t[25]||(t[25]=e("thead",{class:"bg-gray-50 dark:bg-gray-700/50"},[e("tr",null,[e("th",{scope:"col",class:"w-24 px-3 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," معاينة "),e("th",{scope:"col",class:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"}," العنوان "),e("th",{scope:"col",class:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider whitespace-nowrap"}," التصنيف "),e("th",{scope:"col",class:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider whitespace-nowrap"}," الدورة "),e("th",{scope:"col",class:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider hidden md:table-cell whitespace-nowrap"}," الوحدة/الترتيب "),e("th",{scope:"col",class:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider hidden lg:table-cell whitespace-nowrap"}," تاريخ الإنشاء "),e("th",{scope:"col",class:"relative px-4 py-3"},[e("span",{class:"sr-only"},"الإجراءات")])])],-1)),e("tbody",Lt,[(r(!0),n(Y,null,H(w.value,s=>{var O,J;return r(),n("tr",{key:s.id,class:De(["hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors duration-150 group",{"opacity-40 pointer-events-none":y.value===s.id}])},[e("td",Ft,[s.youtube_url&&ge(s.youtube_url)?(r(),n("button",{key:0,onClick:K=>G(s.youtube_url),class:"w-20 h-12 overflow-hidden rounded-md group/thumb relative focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 block mx-auto shadow-sm",title:`معاينة فيديو: ${s.title}`,disabled:y.value===s.id,"aria-label":"معاينة الفيديو"},[e("img",{src:ge(s.youtube_url),alt:`معاينة درس ${s.title}`,class:"w-full h-full object-cover transition-transform duration-200 ease-in-out group-hover/thumb:scale-110",loading:"lazy"},null,8,At),t[21]||(t[21]=e("div",{class:"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover/thumb:opacity-100 transition-opacity duration-200"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-6 h-6 text-white/80"},[e("path",{"fill-rule":"evenodd",d:"M2 10a8 8 0 1 1 16 0 8 8 0 0 1-16 0Zm6.39-2.908a.75.75 0 0 1 .766.027l3.5 2.25a.75.75 0 0 1 0 1.262l-3.5 2.25A.75.75 0 0 1 8 12.25v-4.5a.75.75 0 0 1 .39-.658Z","clip-rule":"evenodd"})])],-1))],8,Nt)):(r(),n("div",Ut," بلا فيديو "))]),e("td",It,[e("div",{class:"text-sm font-medium text-gray-900 dark:text-gray-100 max-w-xs",title:s.title},[C(D,{to:xe(s),target:"_blank",class:"hover:text-primary-600 dark:hover:text-primary-400 transition-colors group-hover:underline underline-offset-2"},{default:F(()=>[z(v(s.title)+" ",1),t[22]||(t[22]=e("span",{class:"text-xs text-gray-400 dark:text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity inline-block ms-1","aria-hidden":"true"}," (مشاهدة)",-1))]),_:2},1032,["to"])],8,jt),e("div",Bt,v(me(s.created_at,!0)),1)]),e("td",Ot,v(((O=s.categories)==null?void 0:O.name)||"-"),1),e("td",zt,[s.course_id&&((J=s.study_courses)!=null&&J.title)?(r(),ce(D,{key:0,to:`/study/courses/${s.course_id}`,target:"_blank",class:"hover:text-primary-600 dark:hover:text-primary-400 transition-colors"},{default:F(()=>[z(v(s.study_courses.title),1)]),_:2},1032,["to"])):(r(),n("span",Tt,"عام"))]),e("td",qt,[s.module_number?(r(),n("span",Pt,"#"+v(s.module_number),1)):(r(),n("span",Rt,"عام")),s.lesson_order?(r(),n("span",Zt," / "+v(s.lesson_order),1)):b("",!0)]),e("td",Gt,v(me(s.created_at)),1),e("td",Jt,[e("div",Yt,[e("button",{onClick:K=>B(s),class:"admin-action-button text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-200",disabled:y.value===s.id||c.value,title:"تعديل الدرس","aria-label":"تعديل الدرس"},t[23]||(t[23]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5"},[e("path",{d:"m2.695 14.762-1.262 3.155a.5.5 0 0 0 .65.65l3.155-1.262a4 4 0 0 0 1.343-.886L17.5 5.501a2.121 2.121 0 0 0-3-3L3.58 13.42a4 4 0 0 0-.886 1.343Z"})],-1)]),8,Ht),e("button",{onClick:K=>ae(s),class:"admin-action-button text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-200",disabled:y.value===s.id||c.value,title:"حذف الدرس","aria-label":"حذف الدرس"},[y.value===s.id?(r(),ce(re,{key:0,class:"w-5 h-5"})):(r(),n("svg",Qt,t[24]||(t[24]=[e("path",{"fill-rule":"evenodd",d:"M8.75 1A2.75 2.75 0 0 0 6 3.75v.443c-.795.077-1.58.22-2.326.418C2.482 4.958 2 5.752 2 6.596v3.073c0 .844.482 1.638 1.274 2.014 1.106.527 2.283.9 3.476 1.146A6.997 6.997 0 0 0 10 18.25a6.997 6.997 0 0 0 3.25-.518c1.193-.246 2.37-.619 3.476-1.146C17.518 11.207 18 10.413 18 9.67V6.596c0-.844-.482-1.638-1.274-2.014-.746-.198-1.531-.341-2.326-.418V3.75A2.75 2.75 0 0 0 11.25 1h-2.5ZM7.5 3.75c0-.69.56-1.25 1.25-1.25h2.5c.69 0 1.25.56 1.25 1.25v.415c-.885.102-1.745.276-2.55.5a.75.75 0 0 1-.4 0c-.805-.224-1.665-.398-2.55-.5V3.75Z","clip-rule":"evenodd"},null,-1)])))],8,Wt)])])],2)}),128))])])])])):!c.value&&(!w.value||w.value.length===0)?(r(),n("div",Kt,[t[26]||(t[26]=e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-12 h-12 mx-auto mb-4 text-gray-400 dark:text-gray-500"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})],-1)),_.value||g.value!==null||o.value!==null?(r(),n("p",Xt,"لا توجد دروس تطابق معايير البحث أو الفلترة الحالية.")):(r(),n("p",el,"لا توجد دروس لعرضها حالياً. قم بإضافة درس جديد."))])):b("",!0),N.value>1?(r(),n("div",tl,[e("button",{onClick:t[7]||(t[7]=s=>f(m.value-1)),disabled:m.value===1||c.value,class:"pagination-button"}," السابق ",8,ll),e("span",ol,[z(" صفحة "+v(m.value)+" من "+v(N.value)+" ",1),e("span",al,"("+v(k.value)+" درس)",1)]),e("button",{onClick:t[8]||(t[8]=s=>f(m.value+1)),disabled:m.value===N.value||c.value,class:"pagination-button"}," التالي ",8,sl)])):b("",!0),C(ot,{show:P.value,"lesson-data":R.value,"preselected-course-id":le.value,onClose:Z,onSaved:oe},null,8,["show","lesson-data","preselected-course-id"]),C(Fe,{show:W.value,"video-url":I.value,onClose:Q},null,8,["show","video-url"])])}}}),pl=_e(nl,[["__scopeId","data-v-045606d4"]]);export{pl as default};
