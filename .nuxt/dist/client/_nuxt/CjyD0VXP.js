import{e as B,u as N,r as u,l as q,p as h,o as y,w as n,b as m,a as e,h as d,d as k,t as b,v as L,c as T,i as w,x as _,y as V}from"./CaF1xe-H.js";import{L as D}from"./CpjGp_h0.js";import{h as C,G as E,V as G,Y as O,S as U}from"./vWwLff75.js";const Y={class:"fixed inset-0 overflow-y-auto"},z={class:"flex min-h-full items-center justify-center p-4 text-center"},A={class:"mt-4 space-y-4"},F={key:0,class:"text-sm text-red-600 dark:text-red-400"},H={class:"mt-6 flex justify-start gap-3"},I=["disabled"],J=["disabled"],R=B({__name:"SendMessageModal",props:{user:{type:Object,required:!0},modelValue:{type:Boolean,default:!1}},emits:["close","sent","update:modelValue"],setup(g,{emit:M}){const c=g,f=M,S=N(),v=u(c.modelValue),o=u(""),l=u(""),a=u(!1),r=u(null);q(()=>c.modelValue,s=>{v.value=s,s&&(o.value="",l.value="",r.value=null,a.value=!1)});function p(){a.value||(v.value=!1,f("update:modelValue",!1),f("close"))}async function j(){if(!c.user||!o.value.trim()||!l.value.trim()||a.value){r.value="الرجاء ملء العنوان والمحتوى.";return}a.value=!0,r.value=null;try{const s={user_id:c.user.id,title:o.value.trim(),content:l.value.trim(),source:"admin_direct_message"},{error:t}=await S.from("user_private_messages").insert(s);if(t)throw t;f("sent",!0),p()}catch(s){console.error("Error sending private message:",s),r.value=s.message||"فشل إرسال الرسالة.",f("sent",!1,r.value)}finally{a.value=!1}}return(s,t)=>(y(),h(d(U),{appear:"",show:v.value,as:"template"},{default:n(()=>[m(d(O),{as:"div",onClose:p,class:"relative z-40"},{default:n(()=>[m(d(C),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:n(()=>t[2]||(t[2]=[e("div",{class:"fixed inset-0 bg-black/30 backdrop-blur-sm"},null,-1)])),_:1}),e("div",Y,[e("div",z,[m(d(C),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:n(()=>[m(d(E),{class:"w-full max-w-lg transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 p-6 text-right shadow-xl transition-all"},{default:n(()=>[m(d(G),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900 dark:text-gray-100 mb-4 border-b dark:border-gray-700 pb-3"},{default:n(()=>{var i,x;return[k(" إرسال رسالة خاصة إلى "+b(((i=g.user)==null?void 0:i.full_name)||((x=g.user)==null?void 0:x.auth_email)),1)]}),_:1}),e("form",{onSubmit:L(j,["prevent"])},[e("div",A,[e("div",null,[t[3]||(t[3]=e("label",{for:"message-title",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"عنوان الرسالة *",-1)),_(e("input",{type:"text",id:"message-title","onUpdate:modelValue":t[0]||(t[0]=i=>o.value=i),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[V,o.value]])]),e("div",null,[t[4]||(t[4]=e("label",{for:"message-content",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"محتوى الرسالة *",-1)),_(e("textarea",{id:"message-content","onUpdate:modelValue":t[1]||(t[1]=i=>l.value=i),rows:"6",required:"",placeholder:"اكتب رسالتك هنا...",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white"},null,512),[[V,l.value]])]),r.value?(y(),T("p",F,b(r.value),1)):w("",!0)]),e("div",H,[e("button",{type:"submit",disabled:a.value||!o.value.trim()||!l.value.trim(),class:"inline-flex justify-center rounded-md border border-transparent bg-indigo-600 px-6 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:opacity-50"},[a.value?(y(),h(D,{key:0,class:"w-5 h-5 text-white -ml-1 mr-2"})):w("",!0),k(" "+b(a.value?"جارٍ الإرسال...":"إرسال الرسالة"),1)],8,I),e("button",{type:"button",class:"inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800",onClick:p,disabled:a.value}," إلغاء ",8,J)])],32)]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}});export{R as default};
