const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./C-SHCdix.js","./CaF1xe-H.js","./entry.DgcQJhFP.css","./CpjGp_h0.js","./LoadingSpinner.Dre-g5PP.css","./CourseAddEditModal.gLS3J19P.css"])))=>i.map(i=>d[i]);
import{e as H,u as O,r as d,f as w,l as u,c as o,a as r,i as C,p as R,b as U,d as A,t as f,F as W,j as X,h as J,o as s,W as K,X as Q,_ as Y}from"./CaF1xe-H.js";import{L as ee}from"./CpjGp_h0.js";import{u as E}from"./CqvecxAQ.js";const te={class:"flex justify-between items-center mb-6"},re=["disabled"],ae={key:0},se={key:1},oe={key:0,class:"text-center py-10"},ne={key:1,class:"text-center py-10 px-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg max-w-md mx-auto"},le={class:"mt-1 text-xs text-left bg-red-100 dark:bg-red-800/30 p-2 rounded border border-red-200 dark:border-red-700 text-red-700 dark:text-red-300 whitespace-pre-wrap"},ie={key:2,class:"text-center py-10 text-gray-500 dark:text-gray-400"},de={key:3,class:"overflow-x-auto shadow ring-1 ring-black ring-opacity-5 dark:ring-gray-700 rounded-lg"},ce={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},ue={class:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700"},ge={class:"px-4 py-2 whitespace-nowrap"},me=["src","alt"],ve={key:1,class:"h-10 w-16 bg-gray-100 dark:bg-gray-700 rounded flex items-center justify-center text-gray-400"},he={class:"table-cell font-medium text-gray-900 dark:text-white"},ye={class:"table-cell"},pe={class:"table-cell text-center"},fe=["onClick","title"],_e={key:0,class:"badge-green"},xe={key:1,class:"badge-red"},be={class:"table-cell"},ke={class:"table-cell text-right font-medium space-x-2 rtl:space-x-reverse whitespace-nowrap"},we=["onClick"],Ce=["onClick"],Ae={key:4},Ee=H({__name:"study-courses",async setup(De){let n,g;const D=K(()=>Q(()=>import("./C-SHCdix.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)),m=O(),l=d([]),v=d([]),c=d(!0),h=d(null),y=d(!1),p=d(null),_=d(!0),{data:$,pending:M,error:j,refresh:x}=([n,g]=w(async()=>E("adminCourses",async()=>{console.log("Fetching courses via useAsyncData...");const{data:e,error:t}=await m.from("study_courses").select("*").order("created_at",{ascending:!1});if(t)throw console.error("Error fetching courses (useAsyncData):",t.message),t;return console.log("Courses fetched (useAsyncData):",e==null?void 0:e.length),e||[]},{default:()=>[]})),n=await n,g(),n),{data:B,pending:S,error:$e,refresh:V}=([n,g]=w(async()=>E("adminCourseCategories",async()=>{console.log("Fetching categories via useAsyncData...");const{data:e,error:t}=await m.from("categories").select("id, name").order("name");if(t)throw console.error("Error fetching categories (useAsyncData):",t.message),t;return console.log("Categories fetched (useAsyncData):",e==null?void 0:e.length),e||[]},{default:()=>[]})),n=await n,g(),n);u(M,e=>{c.value=e},{immediate:!0}),u(j,e=>{h.value=e},{immediate:!0}),u($,e=>{l.value=e||[]},{immediate:!0}),u(S,e=>{_.value=e},{immediate:!0}),u(B,e=>{v.value=e||[]},{immediate:!0});function F(e){if(!e||!Array.isArray(v.value))return null;const t=v.value.find(a=>a.id===e);return t?t.name:`فئة #${e}`}function L(e){if(!e)return"-";try{return new Date(e).toLocaleDateString("ar-EG",{day:"numeric",month:"short",year:"numeric"})}catch{return"تاريخ غير صالح"}}function N(e){return e||"/images/placeholder-course.jpg"}async function P(e){const t=!e.is_active,a=t?`هل أنت متأكد من تفعيل الدورة "${e.title}"؟ ستصبح مرئية للطلاب.`:`هل أنت متأكد من إلغاء تفعيل الدورة "${e.title}"؟ لن تكون مرئية للطلاب.`;if(confirm(a))try{const{error:i}=await m.from("study_courses").update({is_active:t}).eq("id",e.id).select("id").single();if(i)throw i;const k=l.value.findIndex(G=>G.id===e.id);k!==-1&&(l.value[k].is_active=t),alert(`تم ${t?"تفعيل":"إلغاء تفعيل"} الدورة بنجاح.`)}catch(i){console.error("Error toggling course status:",i.message),alert(`فشل تغيير حالة الدورة: ${i.message}`)}}function Z(){p.value=null,y.value=!0}function q(e){p.value={...e},y.value=!0}function b(){y.value=!1,p.value=null}async function I(){b(),await x()}async function T(e){if(confirm(`هل أنت متأكد من حذف الدورة "${e.title}"؟ سيتم فك ارتباط جميع دروسها واختباراتها (لن يتم حذف الدروس/الاختبارات نفسها).`))try{const{error:t}=await m.from("study_courses").delete().eq("id",e.id);if(t)throw t;alert("تم حذف الدورة بنجاح."),await x()}catch(t){console.error("Error deleting course:",t.message),alert(`فشل حذف الدورة: ${t.message}`)}}async function z(){await Promise.all([x(),V()])}return(e,t)=>(s(),o("div",null,[r("div",te,[t[0]||(t[0]=r("h1",{class:"text-2xl font-semibold"},"إدارة الدورات الدراسية",-1)),r("button",{onClick:Z,class:"button-primary",disabled:_.value},[_.value?(s(),o("span",ae,"تحميل...")):(s(),o("span",se,"إضافة دورة جديدة"))],8,re)]),c.value?(s(),o("div",oe,[U(ee),t[1]||(t[1]=r("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"جارٍ تحميل قائمة الدورات...",-1))])):h.value?(s(),o("div",ne,[t[2]||(t[2]=r("p",{class:"text-red-600 dark:text-red-400 font-semibold mb-2"},[r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-5 h-5 inline-block align-middle me-1","aria-hidden":"true"},[r("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-8-5a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-1.5 0v-4.5A.75.75 0 0 1 10 5Zm0 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z","clip-rule":"evenodd"})]),A(" خطأ تحميل الدورات ")],-1)),r("pre",le,f(h.value.message),1),r("button",{onClick:z,class:"mt-4 px-4 py-1.5 bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-300 rounded hover:bg-red-200 dark:hover:bg-red-900 transition-colors text-sm font-medium"}," إعادة المحاولة ")])):!c.value&&Array.isArray(l.value)&&l.value.length===0?(s(),o("div",ie,t[3]||(t[3]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-10 h-10 mx-auto mb-2 text-gray-400"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"})],-1),A(" لا توجد دورات دراسية مضافة حتى الآن. ")]))):!c.value&&Array.isArray(l.value)&&l.value.length>0?(s(),o("div",de,[r("table",ce,[t[5]||(t[5]=r("thead",{class:"bg-gray-50 dark:bg-gray-800"},[r("tr",null,[r("th",{scope:"col",class:"table-header"}),r("th",{scope:"col",class:"table-header"},"العنوان"),r("th",{scope:"col",class:"table-header"},"الفئة"),r("th",{scope:"col",class:"table-header text-center"},"الحالة"),r("th",{scope:"col",class:"table-header"},"تاريخ الإضافة"),r("th",{scope:"col",class:"relative px-6 py-3"},[r("span",{class:"sr-only"},"إجراءات")])])],-1)),r("tbody",ue,[(s(!0),o(W,null,X(l.value,a=>(s(),o("tr",{key:a.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800/50"},[r("td",ge,[a.image_url?(s(),o("img",{key:0,src:N(a.image_url),alt:a.title??"صورة الدورة",class:"h-10 w-16 object-cover rounded border border-gray-200 dark:border-gray-700"},null,8,me)):(s(),o("div",ve,t[4]||(t[4]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm16.5-5.818V18"})],-1)])))]),r("td",he,f(a.title),1),r("td",ye,f(F(a.category_id)||"-"),1),r("td",pe,[r("button",{onClick:i=>P(a),title:a.is_active?"إلغاء تفعيل الدورة":"تفعيل الدورة"},[a.is_active?(s(),o("span",_e,"نشط")):(s(),o("span",xe,"غير نشط"))],8,fe)]),r("td",be,f(L(a.created_at)),1),r("td",ke,[r("button",{onClick:i=>q(a),class:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-200"},"تعديل",8,we),r("button",{onClick:i=>T(a),class:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200"},"حذف",8,Ce)])]))),128))])])])):!c.value&&!h.value?(s(),o("div",Ae,t[6]||(t[6]=[r("p",{class:"text-center py-10 text-gray-400"},"حالة غير متوقعة.",-1)]))):C("",!0),y.value?(s(),R(J(D),{key:5,"course-data":p.value,categories:v.value,onClose:b,onSaved:I},null,8,["course-data","categories"])):C("",!0)]))}}),Se=Y(Ee,[["__scopeId","data-v-566fa94c"]]);export{Se as default};
